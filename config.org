#+TITLE: Emacs é…ç½®æ–‡æ¡£
#+AUTHOR: ManJack
#+DATE: \today
#+LATEX_COMPILER: xelatex
#+LATEX_CLASS: article
#+LATEX_HEADER: \usepackage[margin=2.5cm]{geometry}
#+LATEX_HEADER: \usepackage{ctex}
#+LATEX_HEADER: \usepackage{tikz}
#+LATEX_HEADER: \usepackage{xcolor}
#+LATEX_HEADER: \definecolor{boxblue}{RGB}{136,192,208} % Nord ä¸»é¢˜è“è‰²
#+LATEX_HEADER: \usepackage{minted}
#+LATEX_HEADER: \usepackage{amsmath, amssymb, amsfonts}  % åŸºç¡€æ•°å­¦åŒ…
#+LATEX_HEADER: \usepackage{bm}                           % ç²—ä½“æ•°å­¦ç¬¦å·
#+LATEX_HEADER: \usepackage{mathtools}                    % amsmath çš„å¢å¼º
#+LATEX_HEADER: \setminted{
#+LATEX_HEADER:   breaklines=true,
#+LATEX_HEADER:   breakanywhere=true,
#+LATEX_HEADER:   frame=leftline,
#+LATEX_HEADER:   framerule=2pt,
#+LATEX_HEADER:   rulecolor=\color{boxblue},
#+LATEX_HEADER:   bgcolor=boxback,
#+LATEX_HEADER:   fontsize=\small,
#+LATEX_HEADER:   baselinestretch=1.2
#+LATEX_HEADER: }
#+LATEX_HEADER: \usepackage{tcolorbox}
#+LATEX_HEADER: \tcbuselibrary{listings,skins,breakable}
#+LATEX_HEADER: \setcounter{secnumdepth}{2}

#+LATEX_HEADER: % è¶…ç¾ä»£ç æ¡†é¢œè‰²
#+LATEX_HEADER: \definecolor{boxblue}{RGB}{70, 130, 180}
#+LATEX_HEADER: \definecolor{boxgreen}{RGB}{34, 139, 34}
#+LATEX_HEADER: \definecolor{boxpurple}{RGB}{148, 0, 211}
#+LATEX_HEADER: \definecolor{boxgray}{RGB}{108, 117, 125}
#+LATEX_HEADER: \definecolor{boxback}{RGB}{252, 252, 252}
#+LATEX_HEADER: \definecolor{boxframe}{RGB}{220, 220, 220}

#+LATEX_HEADER: \usepackage{graphicx}
#+LATEX_HEADER: \usepackage{float}
#+LATEX_HEADER: \usepackage{caption}

#+LATEX_HEADER: % å®šä¹‰æ³¨æ„äº‹é¡¹æ¡†
#+LATEX_HEADER: \newtcolorbox{NOTE}{
#+LATEX_HEADER:     enhanced,
#+LATEX_HEADER:     colback=blue!5!white,
#+LATEX_HEADER:     colframe=blue!50!black,
#+LATEX_HEADER:     arc=3pt,
#+LATEX_HEADER:     boxrule=0.5pt,
#+LATEX_HEADER:     left=8pt,
#+LATEX_HEADER:     right=8pt,
#+LATEX_HEADER:     title={\textbf{æ³¨æ„}},
#+LATEX_HEADER:     fonttitle=\sffamily\bfseries,
#+LATEX_HEADER:     coltitle=blue!80!black,
#+LATEX_HEADER:     colbacktitle=blue!20!white
#+LATEX_HEADER: }

#+LATEX_HEADER: \newtcolorbox{WARNING}{
#+LATEX_HEADER:     enhanced,
#+LATEX_HEADER:     colback=red!5!white,
#+LATEX_HEADER:     colframe=red!50!black,
#+LATEX_HEADER:     arc=3pt,
#+LATEX_HEADER:     boxrule=0.5pt,
#+LATEX_HEADER:     left=8pt,
#+LATEX_HEADER:     right=8pt,
#+LATEX_HEADER:     title={\textbf{è­¦å‘Š}},
#+LATEX_HEADER:     fonttitle=\sffamily\bfseries,
#+LATEX_HEADER:     coltitle=red!80!black,
#+LATEX_HEADER:     colbacktitle=red!20!white
#+LATEX_HEADER: }

#+LATEX_HEADER: \newtcolorbox{TIP}{
#+LATEX_HEADER:     enhanced,
#+LATEX_HEADER:     colback=green!5!white,
#+LATEX_HEADER:     colframe=green!50!black,
#+LATEX_HEADER:     arc=3pt,
#+LATEX_HEADER:     boxrule=0.5pt,
#+LATEX_HEADER:     left=8pt,
#+LATEX_HEADER:     right=8pt,
#+LATEX_HEADER:     title={\textbf{æç¤º}},
#+LATEX_HEADER:     fonttitle=\sffamily\bfseries,
#+LATEX_HEADER:     coltitle=green!80!black,
#+LATEX_HEADER:     colbacktitle=green!20!white
#+LATEX_HEADER: }
#+OPTIONS: toc:2 num:t
#+PROPERTY: header-args:emacs-lisp :tangle config.el
#+LATEX: \newpage


* è‡ªå®šä¹‰å‡½æ•°è„šæœ¬

æœ¬èŠ‚åŒ…å«æ‰€æœ‰è‡ªå®šä¹‰çš„å®ç”¨å‡½æ•°ï¼Œç”¨äºå¢å¼º Emacs çš„åŠŸèƒ½å’Œä¾¿åˆ©æ€§ã€‚

** Toggle Deer
*** ä»‹ç»
å¿«é€Ÿåˆ‡æ¢ deer æ–‡ä»¶æµè§ˆæ¨¡å¼çš„å¼€å…³å‡½æ•°ã€‚

*** é…ç½®
#+begin_src emacs-lisp
(defun my-toggle-deer ()
  "Toggle deer mode on/off."
  (interactive)
  (if (derived-mode-p 'ranger-mode)
      (ranger-close)
    (deer)))

(when-let ((zsh-path (executable-find "zsh")))
  (setq explicit-shell-file-name zsh-path)
  (setq shell-file-name zsh-path)
  (setq-default explicit-shell-file-name zsh-path)
  (setq-default shell-file-name zsh-path))
#+end_src

*** ä½¿ç”¨æ–¹æ³•
- è°ƒç”¨ =my-toggle-deer= åˆ‡æ¢ deer æ¨¡å¼

** æ‰“å¼€ PDF æ–‡ä»¶çš„å‡½æ•°
*** ä»‹ç»
ä½¿ç”¨å¤–éƒ¨ Sioyek PDF é˜…è¯»å™¨æ‰“å¼€å½“å‰ buffer ä¸­çš„ PDF æ–‡ä»¶ã€‚

*** é…ç½®
#+begin_src emacs-lisp
(defun open-in-sioyek ()
  "Open the PDF file of the current buffer in Sioyek."
  (interactive)
  (let ((pdf-file (buffer-file-name)))
    (if (and pdf-file (string-match-p "\\.pdf\\'" pdf-file))
        (start-process "sioyek" nil "sioyek" pdf-file)
      (message "The current buffer is not a PDF file"))))
#+end_src

*** ä½¿ç”¨æ–¹æ³•
- åœ¨ PDF buffer ä¸­è°ƒç”¨ =open-in-sioyek=
- ä¼šåœ¨ Sioyek é˜…è¯»å™¨ä¸­æ‰“å¼€å½“å‰ PDF æ–‡ä»¶


** çª—å£è°ƒæ•´å‡½æ•°
*** ä»‹ç»
ä½¿ç”¨ h/j/k/l é”®è¿ç»­è°ƒæ•´çª—å£å¤§å°çš„äº¤äº’å¼å‡½æ•°ã€‚

*** é…ç½®
#+begin_src emacs-lisp
(defun my-window-resize ()
  "çª—å£è°ƒæ•´æ¨¡å¼ï¼Œè¿æŒ‰ h/j/k/l"
  (interactive)
  (message "ä½¿ç”¨ h/j/k/l è°ƒæ•´çª—å£å¤§å°")
  (set-transient-map
   (let ((map (make-sparse-keymap)))
     (define-key map "h" (lambda () (interactive) (shrink-window-horizontally 3) (my-window-resize)))
     (define-key map "j" (lambda () (interactive) (shrink-window 3) (my-window-resize)))
     (define-key map "k" (lambda () (interactive) (enlarge-window 3) (my-window-resize)))
     (define-key map "l" (lambda () (interactive) (enlarge-window-horizontally 3) (my-window-resize)))
     map)))

(global-set-key (kbd "C-c w") 'my-window-resize)
#+end_src

*** ä½¿ç”¨æ–¹æ³•
- é”®ç»‘å®š: =C-c w= 
- æŒ‰ä¸‹åä½¿ç”¨ =h/j/k/l= è°ƒæ•´çª—å£å¤§å°
- å…¶ä»–é”®é€€å‡ºè°ƒæ•´æ¨¡å¼

** ç»ˆç«¯åˆ‡æ¢å‡½æ•°
*** ä»‹ç»
å¿«é€Ÿåˆ‡æ¢åˆ° eat ç»ˆç«¯å¹¶åœ¨å†æ¬¡è°ƒç”¨æ—¶è¿”å›ä¹‹å‰çš„ç¼“å†²åŒºã€‚

*** é…ç½®
#+begin_src emacs-lisp
(defun toggle-eat ()
  "Toggle between eat terminal and previous buffer. Create eat terminal if not exists."
  (interactive)
  (let ((eat-buffer (get-buffer "*eat*")))
    (if (and eat-buffer (eq (current-buffer) eat-buffer))
        ;; Currently in eat buffer, switch back to previous
        (if (and (boundp 'eat-previous-buffer) 
                 (buffer-live-p eat-previous-buffer))
            (switch-to-buffer eat-previous-buffer)
          (previous-buffer))
      ;; Store current buffer before switching
      (setq eat-previous-buffer (current-buffer))
      ;; Switch to eat or create if not exists  
      (if eat-buffer
          (switch-to-buffer eat-buffer)
        (eat)))))
#+end_src

*** ä½¿ç”¨æ–¹æ³•
- é”®ç»‘å®š: =C-/=
- é¦–æ¬¡æŒ‰ä¸‹åˆ‡æ¢åˆ°ç»ˆç«¯ï¼Œå†æ¬¡æŒ‰ä¸‹è¿”å›åŸç¼“å†²åŒº


** PDF æ¸²æŸ“é¢œè‰²
*** ä»‹ç»
å°† PDFTools çš„é…è‰²å›ºå®šä¸º doom-one ä¸»é¢˜é£æ ¼ï¼Œæä¾›æ›´å¥½çš„é˜…è¯»ä½“éªŒã€‚

*** é…ç½®
#+begin_src emacs-lisp
;; PDFTools å›ºå®šä½¿ç”¨ doom-one é…è‰²
(with-eval-after-load 'pdf-view
  ;; è®¾ç½® doom-one é£æ ¼çš„é¢œè‰²
  (setq pdf-view-midnight-colors '("#FFFFFF" . "#282c34"))
  
  ;; æ‰“å¼€ PDF æ—¶è‡ªåŠ¨å¯ç”¨é…è‰²
  (add-hook 'pdf-view-mode-hook
            (lambda ()
              (pdf-view-midnight-minor-mode 1))))

;; å¯é€‰ï¼šæ‰‹åŠ¨åˆ‡æ¢å¼€å…³ï¼ˆå¦‚æœå¶å°”éœ€è¦åŸå§‹é¢œè‰²ï¼‰
(defun pdf-toggle-colors ()
  "Toggle PDF midnight mode on/off."
  (interactive)
  (pdf-view-midnight-minor-mode 'toggle)
  (when (derived-mode-p 'pdf-view-mode)
    (pdf-view-redisplay t)))
#+end_src

*** ä½¿ç”¨è¯´æ˜
- è‡ªåŠ¨åº”ç”¨ doom-one ä¸»é¢˜é…è‰²
- å¯é€‰æ‰‹åŠ¨åˆ‡æ¢é…è‰²æ¨¡å¼
  

  
** ä¸»é¢˜è‡ªåŠ¨åˆ‡æ¢å‡½æ•°
*** ä»‹ç»
æ ¹æ®å½“å‰æ—¶é—´è‡ªåŠ¨åˆ‡æ¢ Modus ä¸»é¢˜çš„æ·±è‰²å’Œæµ…è‰²æ¨¡å¼ã€‚

*** é…ç½®
#+begin_src emacs-lisp
(defun my/auto-switch-modus-theme ()
  "æ ¹æ®æ—¶é—´è‡ªåŠ¨åˆ‡æ¢ Modus ä¸»é¢˜"
  (let ((hour (string-to-number (format-time-string "%H"))))
    (if (or (>= hour 22) (< hour 6))
        (load-theme 'modus-vivendi-tinted t)
      (load-theme 'modus-operandi-tinted t))))
#+end_src

*** ä½¿ç”¨è¯´æ˜
- 22:00-06:00 è‡ªåŠ¨åˆ‡æ¢ä¸ºæ·±è‰²ä¸»é¢˜ (modus-vivendi-tinted)
- 06:00-22:00 è‡ªåŠ¨åˆ‡æ¢ä¸ºæµ…è‰²ä¸»é¢˜ (modus-operandi-tinted)
- é…åˆ modus-themes åŒ…ä½¿ç”¨





** Org æ•°å­¦é¢„è§ˆå‡½æ•°
*** ä»‹ç»
åœ¨ä¿å­˜å’Œæ‰“å¼€ Org æ–‡ä»¶æ—¶è‡ªåŠ¨é¢„è§ˆæ•°å­¦å…¬å¼ï¼Œæ’é™¤ config.org ä»¥é¿å…æ€§èƒ½é—®é¢˜ã€‚

*** é…ç½®
#+begin_src emacs-lisp
(defun my/org-math-preview-on-save ()
  "åœ¨ä¿å­˜ Org æ–‡ä»¶æ—¶è‡ªåŠ¨æ‰§è¡Œ math-preview-allï¼Œæ’é™¤ config.org."
  (when (and (eq major-mode 'org-mode)
             (not (string-equal (file-name-nondirectory (or buffer-file-name "")) "config.org")))
    (math-preview-all)))

;; æ‰“å¼€ Org æ–‡ä»¶æ—¶æ‰§è¡Œ
(defun my/org-math-preview-on-open ()
  "æ‰“å¼€ Org æ–‡ä»¶æ—¶è‡ªåŠ¨æ‰§è¡Œ math-preview-allï¼Œæ’é™¤ config.org."
  (when (not (string-equal (file-name-nondirectory (or buffer-file-name "")) "config.org"))
    (math-preview-all)))

(add-hook 'org-mode-hook #'my/org-math-preview-on-open)
(add-hook 'before-save-hook #'my/org-math-preview-on-save)
#+end_src

*** ä½¿ç”¨è¯´æ˜
- æ‰“å¼€ org æ–‡ä»¶æ—¶è‡ªåŠ¨é¢„è§ˆæ•°å­¦å…¬å¼
- ä¿å­˜æ—¶è‡ªåŠ¨æ›´æ–°é¢„è§ˆ
- config.org è¢«æ’é™¤åœ¨å¤–ï¼Œé¿å…å¹²æ‰°é…ç½®æ–‡ä»¶



** é€æ˜åº¦è®¾ç½®å‡½æ•°
*** ä»‹ç»
æ ¹æ®ä¸åŒæ“ä½œç³»ç»Ÿè®¾ç½®çª—å£é€æ˜åº¦ï¼Œæä¾›è·¨å¹³å°æ”¯æŒã€‚

*** é…ç½®
#+begin_src emacs-lisp
;; å…¨å±€é€æ˜åº¦è®¾ç½®
;; 0 = å®Œå…¨é€æ˜ï¼Œ100 = ä¸é€æ˜
(cond
 ;; macOS
 ((eq system-type 'darwin)
  (set-frame-parameter (selected-frame) 'alpha '(95 . 95))
  (add-to-list 'default-frame-alist '(alpha . (95 . 95))))
 ;; Linux
 ((eq system-type 'gnu/linux)
  (set-frame-parameter (selected-frame) 'alpha '(100 . 100)) ; æ´»åŠ¨çª—å£ 90%ï¼Œéæ´»åŠ¨çª—å£ 85%
  (add-to-list 'default-frame-alist '(alpha . (100 . 100)))))
#+end_src


*** ä½¿ç”¨è¯´æ˜
- macOS: 95% é€æ˜åº¦
- Linux: æ´»åŠ¨çª—å£ 90%ï¼Œéæ´»åŠ¨çª—å£ 85%
- å€¼èŒƒå›´: 0 (å®Œå…¨é€æ˜) - 100 (ä¸é€æ˜)



** Copilot æ¨¡å¼åˆ‡æ¢å‡½æ•°
*** ä»‹ç»
å¿«é€Ÿå¯ç”¨æˆ–ç¦ç”¨ Copilot AI ä»£ç è¡¥å…¨åŠŸèƒ½ã€‚

*** é…ç½®
#+begin_src emacs-lisp
(defun toggle-copilot-mode ()
  "Toggle copilot-mode on or off."
  (interactive)
  (if (bound-and-true-p copilot-mode)
      (progn
        (copilot-mode -1)
        (message "Copilot mode disabled"))
    (copilot-mode 1)
    (message "Copilot mode enabled")))
#+end_src

*** ä½¿ç”¨æ–¹æ³•
- é”®ç»‘å®š: =SPC a c t=
- æ˜¾ç¤ºå½“å‰çŠ¶æ€æ¶ˆæ¯


** Org LaTeX é¢„è§ˆå¿«æ·é”®
*** ä»‹ç»
ä¸º Org æ¨¡å¼æ·»åŠ æ•°å­¦å…¬å¼é¢„è§ˆå’Œæ¸…é™¤çš„ä¾¿æ·å¿«æ·é”®ã€‚

*** é…ç½®
#+begin_src emacs-lisp
;; æ·»åŠ åˆ°é…ç½®ä¸­
(with-eval-after-load 'org
  ;; å…¨å±€æ•°å­¦å…¬å¼é¢„è§ˆ
  (define-key org-mode-map (kbd "C-c C-p")
    (lambda () (interactive) (math-preview-all)))

  ;; æ¸…é™¤æ‰€æœ‰æ•°å­¦å…¬å¼é¢„è§ˆ
  (define-key org-mode-map (kbd "C-c C-r")
    (lambda () (interactive) (math-preview-clear-all))))
#+end_src

*** ä½¿ç”¨æ–¹æ³•
- =C-c C-p= : é¢„è§ˆæ‰€æœ‰æ•°å­¦å…¬å¼
- =C-c C-r= : æ¸…é™¤æ‰€æœ‰é¢„è§ˆ



** è‡ªåŠ¨ Tangle é…ç½®å‡½æ•°
*** ä»‹ç»
ä¿å­˜ config.org æ—¶è‡ªåŠ¨æ‰§è¡Œ org-babel-tangle ç”Ÿæˆ config.elï¼Œæé«˜é…ç½®ç®¡ç†æ•ˆç‡ã€‚

*** é…ç½®
#+begin_src emacs-lisp
(defun my/auto-tangle-config ()
  "è‡ªåŠ¨åœ¨ä¿å­˜ config.org æ—¶æ‰§è¡Œ org-babel-tangleã€‚"
  (when (string-equal (buffer-file-name)
                      (expand-file-name "~/.emacs.d/config.org"))
    (let ((org-confirm-babel-evaluate nil)) ;; ä¸æç¤ºç¡®è®¤
      (org-babel-tangle))))

(add-hook 'after-save-hook #'my/auto-tangle-config)
#+end_src

*** ä½¿ç”¨è¯´æ˜
- ä¿å­˜ config.org æ—¶è‡ªåŠ¨ç”Ÿæˆ config.el
- æ— éœ€æ‰‹åŠ¨æ‰§è¡Œ =org-babel-tangle=
- ä¸ä¼šå¼¹å‡ºç¡®è®¤æç¤º



** æ–‡ä»¶è·¯å¾„å¤åˆ¶å‡½æ•°
*** ä»‹ç»
æä¾›å¤åˆ¶å½“å‰æ–‡ä»¶å®Œæ•´è·¯å¾„æˆ–æ–‡ä»¶ååˆ°å‰ªè´´æ¿çš„ä¾¿æ·å‡½æ•°ã€‚

*** é…ç½®
#+begin_src emacs-lisp
  (defun copy-file-path ()
  "Copy current file absolute path to clipboard."
  (interactive)
  (let ((file-path (buffer-file-name)))
    (if file-path
        (progn
          (kill-new (expand-file-name file-path))
          (message "Copied: %s" (expand-file-name file-path)))
      (error "Current buffer is not associated with a file"))))

;;;###autoload
(defun copy-file-name ()
  "Copy current file name to clipboard."
  (interactive)
  (let ((file-path (buffer-file-name)))
    (if file-path
        (let ((name (file-name-nondirectory file-path)))
          (kill-new name)
          (message "Copied: %s" name))
      (error "Current buffer is not associated with a file"))))
#+end_src

*** ä½¿ç”¨æ–¹æ³•
- =M-x copy-file-path= æˆ– =SPC c p= : å¤åˆ¶å®Œæ•´è·¯å¾„
- =M-x copy-file-name= : ä»…å¤åˆ¶æ–‡ä»¶å

** LSP UI ä¾§è¾¹æ åˆ‡æ¢å‡½æ•°
*** ä»‹ç»
åˆ‡æ¢ lsp-ui-imenu ä¾§è¾¹æ çš„æ˜¾ç¤ºå’Œéšè—ï¼Œæ–¹ä¾¿æŸ¥çœ‹ä»£ç ç»“æ„ã€‚

*** é…ç½®
#+begin_src emacs-lisp
  ;; LSP imenu åˆ‡æ¢å‡½æ•°
  (defun my/toggle-lsp-ui-imenu ()
    "Toggle lsp-ui-imenu sidebar."
    (interactive)
    (if (get-buffer-window "*lsp-ui-imenu*")
        (lsp-ui-imenu--kill)
      (lsp-ui-imenu)))
#+end_src

*** ä½¿ç”¨æ–¹æ³•
- é”®ç»‘å®š: =SPC c s=
- æ˜¾ç¤ºå½“å‰æ–‡ä»¶çš„ç¬¦å·æ ‘ç»“æ„


** LSP å‚æ•°å¯¼èˆªå‡½æ•°
*** ä»‹ç»
åŸºäº tree-sitter å®ç°å‡½æ•°å‚æ•°é—´çš„å¿«é€Ÿè·³è½¬åŠŸèƒ½ã€‚

*** é…ç½®
**** lsp-goto-prev-param
#+begin_src emacs-lisp
;; å‚æ•°å¯¼èˆªï¼ˆåŸºäº treesitterï¼‰
(defun lsp-goto-next-param ()
  "è·³è½¬åˆ°ä¸‹ä¸€ä¸ªå‚æ•°"
  (interactive)
  (when (bound-and-true-p tree-sitter-mode)
    (let ((node (tsc-get-node-at-point (treesit-node-start (treesit-node-at (point))))))
      (when node
        (treesit-search-forward node "parameter_declaration" t)))))
#+end_src


**** lsp-goto-next-param
#+begin_src emacs-lisp
(defun lsp-goto-prev-param ()
  "è·³è½¬åˆ°å‰ä¸€ä¸ªå‚æ•°"
  (interactive)
  (when (bound-and-true-p tree-sitter-mode)
    (let ((node (tsc-get-node-at-point (treesit-node-start (treesit-node-at (point))))))
      (when node
        (treesit-search-backward node "parameter_declaration" t)))))
#+end_src

*** ä½¿ç”¨è¯´æ˜
- éœ€è¦å¯ç”¨ tree-sitter æ¨¡å¼
- ç”¨äºåœ¨å‡½æ•°å‚æ•°ä¹‹é—´å¿«é€Ÿå¯¼èˆª


 

** æ™ºèƒ½ Tab é”®å‡½æ•°
*** ä»‹ç»
æ™ºèƒ½ TAB é”®å®ç°ï¼Œæ ¹æ®ä¸Šä¸‹æ–‡è‡ªåŠ¨é€‰æ‹©è¡Œä¸ºï¼šYASnippet å±•å¼€/è·³è½¬ > Copilot è¡¥å…¨ > Tabout > æ™®é€šç¼©è¿›ã€‚

*** é…ç½®
#+begin_src emacs-lisp
;; æ¸…ç©ºæ‰€æœ‰ Shift-TAB ç»‘å®š
(with-eval-after-load 'company
  (define-key company-active-map (kbd "S-TAB") nil)
  (define-key company-active-map (kbd "<backtab>") nil))
(with-eval-after-load 'yasnippet
  (define-key yas-minor-mode-map (kbd "S-TAB") nil)
  (define-key yas-minor-mode-map (kbd "<backtab>") nil))

;; æ¸…ç©º company çš„ TAB ç»‘å®š
(with-eval-after-load 'company
  (define-key company-active-map (kbd "TAB") nil)
  (define-key company-active-map (kbd "<tab>") nil))

;; æ¸…ç©º yasnippet çš„ TAB ç»‘å®š
(with-eval-after-load 'yasnippet
  (define-key yas-minor-mode-map (kbd "TAB") nil)
  (define-key yas-minor-mode-map (kbd "<tab>") nil))

;; Tabout åŠŸèƒ½ï¼šè·³å‡ºæ‹¬å·ã€å¼•å·ç­‰ï¼ˆä»…å½“å‰è¡Œï¼‰
(defun my-tabout ()
  "è·³å‡ºæ‹¬å·ã€å¼•å·ã€å°–æ‹¬å·ç­‰é…å¯¹ç¬¦å·ï¼ˆä»…å½“å‰è¡Œï¼‰"
  (interactive)
  (re-search-forward "[])}\"'>]" (line-end-position) t))

;; Tabout åå‘åŠŸèƒ½ï¼šè·³åˆ°å‰é¢çš„å·¦æ‹¬å·ã€å¼•å·ç­‰ï¼ˆä»…å½“å‰è¡Œï¼‰
(defun my-tabout-backward ()
  "åå‘è·³åˆ°æ‹¬å·ã€å¼•å·ã€å°–æ‹¬å·ç­‰é…å¯¹ç¬¦å·çš„å¼€å§‹ï¼ˆä»…å½“å‰è¡Œï¼‰"
  (interactive)
  (when (re-search-backward "[[({\"'<]" (line-beginning-position) t)
    (forward-char 1)
    t))

;; å®šä¹‰æ™ºèƒ½ Shift-TABï¼šYASnippet åå‘è·³è½¬ + åå‘ tabout
(defun smart-shift-tab ()
  "Shift-TABï¼šä¼˜å…ˆ YASnippet åå‘è·³è½¬ï¼Œå…¶æ¬¡åå‘ tabout"
  (interactive)
  (cond
   ;; 1. å¦‚æœæœ‰æ¿€æ´»çš„ snippetï¼Œåå‘è·³è½¬å­—æ®µ
   ((and (bound-and-true-p yas-minor-mode)
         (yas-active-snippets))
    (yas-prev-field))
   
   ;; 2. åå‘ taboutï¼šè·³åˆ°å‰é¢çš„å·¦æ‹¬å·å†…
   ((my-tabout-backward))
   
   ;; 3. å¦åˆ™æ‰§è¡Œé»˜è®¤è¡Œä¸º
   (t
    (indent-for-tab-command))))

;; ç»‘å®š Shift-TAB
(global-set-key (kbd "<backtab>") 'smart-shift-tab)

(defun smart-tab ()
  "æ™ºèƒ½ TAB é”®ï¼šä¼˜å…ˆ org è¡¨æ ¼ï¼Œå…¶æ¬¡å±•å¼€/è·³è½¬ YASnippetï¼Œå†æ¬¡ Copilotï¼Œç„¶å taboutï¼Œæœ€åæ­£å¸¸ TABã€‚"
  (interactive)
  (cond
   ;; 1. å¦‚æœåœ¨ org-mode è¡¨æ ¼ä¸­ï¼Œä½¿ç”¨ org è¡¨æ ¼çš„ TAB åŠŸèƒ½
   ((and (derived-mode-p 'org-mode)
         (org-at-table-p))
    (org-table-next-field))
   
   ;; 2. å¦‚æœå…‰æ ‡åœ¨ snippet ç¼©å†™è¯åï¼Œå°è¯•å±•å¼€
   ((and (bound-and-true-p yas-minor-mode)
         (yas-expand)))
   
   ;; 3. å¦‚æœæœ‰æ¿€æ´»çš„ snippetï¼Œå ä½ç¬¦è·³è½¬
   ((and (bound-and-true-p yas-minor-mode)
         (yas-active-snippets))
    (let ((field (yas--snippet-active-field (car (yas-active-snippets)))))
      (if (and field (yas--field-next field))
          (yas-next-field)
        (yas-exit-all-snippets))))
   
   ;; 4. å¦‚æœ Copilot æœ‰å»ºè®®ï¼Œæ¥å—å»ºè®®
   ((and (bound-and-true-p copilot-mode)
         (copilot--overlay-visible))
    (copilot-accept-completion))
   
   ;; 5. Taboutï¼šè·³å‡ºæ‹¬å·ã€å¼•å·ç­‰
   ((my-tabout))
   
   ;; 6. å¦åˆ™æ‰§è¡Œæ­£å¸¸çš„ TAB ç¼©è¿›
   (t
    (indent-for-tab-command))))
#+end_src




*** ä½¿ç”¨è¯´æ˜
- =TAB= : æ ¹æ®ä¸Šä¸‹æ–‡æ™ºèƒ½é€‰æ‹©è¡Œä¸º
  1. å¦‚æœæ˜¯ snippet ç¼©å†™ï¼Œåˆ™å±•å¼€
  2. å¦‚æœåœ¨ snippet ä¸­ï¼Œåˆ™è·³è½¬åˆ°ä¸‹ä¸€ä¸ªå­—æ®µ
  3. å¦‚æœ Copilot æœ‰å»ºè®®ï¼Œåˆ™æ¥å—å»ºè®®
  4. å¦åˆ™æ‰§è¡Œæ™®é€šç¼©è¿›
- =Shift-TAB= : YASnippet åå‘è·³è½¬



* åŒ…ç®¡ç†ç³»ç»Ÿ

æœ¬é…ç½®ä½¿ç”¨ straight.el ä½œä¸ºåŒ…ç®¡ç†å™¨ï¼Œé…åˆ use-package è¿›è¡Œå£°æ˜å¼é…ç½®ã€‚straight.el ç›´æ¥ä» Git ä»“åº“å…‹éš†åŒ…ï¼Œæ”¯æŒç‰ˆæœ¬é”å®šå’Œå¯é‡ç°æ„å»ºã€‚

** straight.el
*** ä»‹ç»
straight.el æ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„ç°ä»£åŒ–åŒ…ç®¡ç†å™¨ï¼Œä» Git ä»“åº“ç›´æ¥å…‹éš†å’Œæ„å»ºåŒ…ã€‚ç›¸æ¯”ä¼ ç»Ÿçš„ package.elï¼š
- æ”¯æŒç‰ˆæœ¬é”å®šï¼ˆlockfilesï¼‰ç¡®ä¿ç¯å¢ƒå¯é‡ç°
- å¯ä»¥ç›´æ¥ä¿®æ”¹åŒ…æºç 
- ä»ä»»ä½• Git ä»“åº“å®‰è£…åŒ…ï¼Œä¸é™äº ELPA
- å®Œå…¨é€æ˜ï¼Œæ‰€æœ‰åŒ…æºç éƒ½åœ¨ =~/.emacs.d/straight/repos/=

*** ç›¸å…³é“¾æ¥
- GitHub: https://github.com/radian-software/straight.el
- æ–‡æ¡£: https://github.com/radian-software/straight.el/blob/develop/README.md

*** ä½¿ç”¨æ–¹æ³•
#+begin_src emacs-lisp
  ;; straight.el å·²åœ¨ init.el ä¸­åˆå§‹åŒ–
  ;; è¿™é‡Œé…ç½® use-package çš„é»˜è®¤è¡Œä¸º

  (setq use-package-always-defer t)  ; å»¶è¿ŸåŠ è½½ï¼Œæé«˜å¯åŠ¨é€Ÿåº¦
#+end_src

*** å¸¸ç”¨å‘½ä»¤
- =M-x straight-pull-all= : æ›´æ–°æ‰€æœ‰åŒ…
- =M-x straight-rebuild-all= : é‡æ–°æ„å»ºæ‰€æœ‰åŒ…
- =M-x straight-freeze-versions= : åˆ›å»ºç‰ˆæœ¬é”å®šæ–‡ä»¶
- =M-x straight-check-all= : æ£€æŸ¥æ‰€æœ‰åŒ…çŠ¶æ€

** use-package
*** ä»‹ç»
use-package æ˜¯ä¸€ä¸ªå£°æ˜å¼åŒ…é…ç½®å®ï¼Œç®€åŒ–åŒ…çš„å®‰è£…ã€é…ç½®å’Œå»¶è¿ŸåŠ è½½ã€‚å®ƒæä¾›ç»Ÿä¸€çš„é…ç½®è¯­æ³•ï¼Œæ”¯æŒæ¡ä»¶åŠ è½½ã€é”®ç»‘å®šã€hooks ç­‰åŠŸèƒ½ã€‚

*** ç›¸å…³é“¾æ¥
- GitHub: https://github.com/jwiegley/use-package
- æ–‡æ¡£: https://github.com/jwiegley/use-package/blob/master/README.md

*** é…ç½®è¯´æ˜
æœ¬é…ç½®å·²è®¾ç½® =straight-use-package-by-default t= ï¼Œæ‰€æœ‰ use-package å£°æ˜ä¼šè‡ªåŠ¨ä½¿ç”¨ straight.el å®‰è£…åŒ…ã€‚


* ç•Œé¢ç¾åŒ–
æå‡ Emacs çš„è§†è§‰ä½“éªŒï¼ŒåŒ…æ‹¬ä¸»é¢˜ã€çŠ¶æ€æ ã€æ ‡ç­¾æ ã€å›¾æ ‡ç­‰ã€‚
** åŸºç¡€è®¾ç½®

*** å­—ä½“é…ç½®
#+begin_src emacs-lisp
;; è®¾ç½®ç¼–ç¨‹å­—ä½“
(set-face-attribute 'default nil
                    :font "Maple Mono NF"
                    :height 140)

;; Set Chinese font for Han script
(set-fontset-font t 'han "Noto Serif CJK SC")
#+end_src


*** UI å…ƒç´ é…ç½®
#+begin_src emacs-lisp
  ;; å…³é—­ä¸å¿…è¦çš„ UI å…ƒç´ 
  (tool-bar-mode -1)        ; å…³é—­å·¥å…·æ 
  (scroll-bar-mode -1)      ; å…³é—­æ»šåŠ¨æ¡
  (menu-bar-mode -1)        ; å…³é—­èœå•æ 

  ;; å¯ç”¨æœ‰ç”¨çš„ UI åŠŸèƒ½
  (global-display-line-numbers-mode 1)
  (global-hl-line-mode 1)

  (global-visual-line-mode t)
  (setq word-wrap t)
  (setq word-wrap-by-category t)
  ;; å¯åŠ¨é…ç½®
  (setq inhibit-startup-message t)      ; å…³é—­å¯åŠ¨ç”»é¢


#+end_src

** dirvish
*** ä»‹ç» 
dirvish æ˜¯ä¸€ä¸ªç°ä»£åŒ–çš„æ–‡ä»¶æµè§ˆå™¨ï¼ŒåŸºäº Dired æ¨¡å¼ï¼Œæä¾›å¢å¼ºçš„ç•Œé¢å’ŒåŠŸèƒ½ï¼Œå¦‚å¤šçª—æ ¼å¸ƒå±€ã€é¢„è§ˆã€å›¾æ ‡æ”¯æŒç­‰ã€‚
*** ç›¸å…³é“¾æ¥
- GitHub:https://github.com/akermu/emacs-dirvish
*** é…ç½®
#+begin_src emacs-lisp 
(use-package dirvish
  :init
  (dirvish-override-dired-mode)
  
  :config
  (setq dired-truncate-lines t)
  
  ;; è°ƒæ•´çª—å£å®½åº¦,ç»™æ›´å¤šç©ºé—´
  (setq dirvish-default-layout '(0.25 0.25 0.5))  ; å·¦:0 ä¸­:30% å³:70%
  ;; æˆ–è€…
  (setq dirvish-preview-dispatchers nil)  ; å…³é—­é¢„è§ˆ,ç»™çˆ¶çª—å£æ›´å¤šç©ºé—´
  
  (setq dirvish-attributes
        '(nerd-icons file-size collapse subtree-state vc-state git-msg)))


(use-package dired-narrow
  :bind (:map dired-mode-map ("/" . dired-narrow)))

(use-package dired-subtree
  :bind (:map dired-mode-map ("TAB" . dired-subtree-toggle)))

(use-package dired
  :straight nil
  :config
  ;; æˆªæ–­é•¿æ–‡ä»¶å
  (setq dired-truncate-lines t)
  
  ;; å…¶ä»–å®ç”¨è®¾ç½®
  (setq dired-listing-switches "-alh"      ; äººç±»å¯è¯»çš„æ–‡ä»¶å¤§å°
        dired-dwim-target t                 ; æ™ºèƒ½çŒœæµ‹å¤åˆ¶ç›®æ ‡
        dired-kill-when-opening-new-dired-buffer t)  ; æ‰“å¼€æ–°ç›®å½•æ—¶å…³é—­æ—§ buffer
  
  :hook
  (dired-mode . (lambda ()
                  (setq truncate-lines t)
                  (hl-line-mode 1))))  ; é«˜äº®å½“å‰è¡Œ

#+end_src

*** ä½¿ç”¨æ–¹æ³•
- æ‰“å¼€æ–‡ä»¶æµè§ˆå™¨: =M-x dirvish=
- æ”¯æŒå¤šçª—æ ¼å¸ƒå±€å’Œæ–‡ä»¶é¢„è§ˆ
- ä½¿ç”¨ =TAB= å±•å¼€/æŠ˜å å­ç›®å½•


** ultra-scroll
*** ä»‹ç»
ultra-scroll æä¾›å¹³æ»‘æ»šåŠ¨ä½“éªŒï¼Œé¿å…è·³è·ƒå¼æ»šåŠ¨ã€‚å®ƒé€šè¿‡å¾®è°ƒæ»šåŠ¨è¡Œä¸ºï¼Œä½¿å†…å®¹ç§»åŠ¨æ›´è‡ªç„¶ã€‚
*** ç›¸å…³é“¾æ¥
- GitHub: https://github.com/jdtsmith/ultra-scroll

*** é…ç½®
#+begin_src emacs-lisp :wrap ep
(use-package ultra-scroll
  ;:vc (:url "https://github.com/jdtsmith/ultra-scroll") ; if desired (emacs>=v30)
  :init
  (setq scroll-conservatively 3 ; or whatever value you prefer, since v0.4
        scroll-margin 0)        ; important: scroll-margin>0 not yet supported
  :config
  (ultra-scroll-mode 1))
#+end_src
*** ä½¿ç”¨æ–¹æ³•
- è‡ªåŠ¨å¯ç”¨å¹³æ»‘æ»šåŠ¨

** dashboard
:PROPERTIES:
:ID:       83bfbb2c-92ce-481f-ac5e-c1a764e7c123
:END:

#+begin_src emacs-lisp
(use-package dashboard
  :demand t
  :after (centaur-tabs nerd-icons evil)
  
  :custom
  ;; åŸºç¡€è®¾ç½®
  (dashboard-banner-logo-title (format "GNU Emacs %s" emacs-version))
  (dashboard-startup-banner 'logo)
  (dashboard-center-content t)
  (dashboard-show-shortcuts t)
  (dashboard-items-default-length 20)
  (initial-buffer-choice (lambda () (get-buffer-create "*dashboard*")))
  
  ;; æ˜¾ç¤ºé¡¹ç›®
  (dashboard-items '((recents . 5) 
                     (bookmarks . 5) 
                     (projects . 5) 
                     (agenda . 5)))
  (dashboard-item-shortcuts '((recents . "r") 
                              (bookmarks . "m") 
                              (agenda . "a") 
                              (projects . "p")))
  
  ;; Agenda
  (dashboard-week-agenda t)
  (dashboard-filter-agenda-entry 'dashboard-no-filter-agenda)
  
  ;; å›¾æ ‡
  (dashboard-set-heading-icons t)
  (dashboard-set-file-icons t)
  (dashboard-icon-type 'nerd-icons)
  (dashboard-display-icons-p t)
  
  ;; Footer
  (dashboard-set-init-info t)
  (dashboard-set-footer t)
  (dashboard-footer-messages '("Happy Hacking!"))
  (dashboard-footer-icon (nerd-icons-faicon "nf-fa-heart" 
                                           :height 1.1 
                                           :v-adjust -0.05 
                                           :face 'error))
  
  :init
  ;; å¯¼èˆªæŒ‰é’®
  (setq dashboard-navigator-buttons
        `(((,(nerd-icons-faicon "nf-fa-github" :height 1.1 :v-adjust 0.0)
            "GitHub" "Browse" 
            (lambda (&rest _) (browse-url "https://github.com")))
           
           (,(nerd-icons-octicon "nf-oct-gear" :height 1.1 :v-adjust 0.0)
            "Config" "Edit" 
            (lambda (&rest _) 
              (find-file (expand-file-name "config.org" user-emacs-directory))))
           
           (,(nerd-icons-faicon "nf-fa-refresh" :height 1.1 :v-adjust 0.0)
            "Update" "Packages" 
            (lambda (&rest _) (straight-pull-all))))))
  
  :config
  (setq dashboard-image-banner-max-height 300)
  (setq dashboard-image-banner-max-width 300)
  (setq dashboard-startup-banner "~/.emacs.d/berserk.png")
  (dashboard-setup-startup-hook)
  
  ;; éšè— centaur-tabs
  (add-to-list 'centaur-tabs-excluded-prefixes "*dashboard")
  
  ;; Evil é”®ç»‘å®š
  (evil-set-initial-state 'dashboard-mode 'normal)
  (evil-define-key 'normal dashboard-mode-map
    "r" #'dashboard-jump-to-recents
    "m" #'dashboard-jump-to-bookmarks
    "p" #'dashboard-jump-to-projects
    "a" #'dashboard-jump-to-agenda
    "g" #'dashboard-refresh-buffer
    "q" #'quit-window
    "{" #'dashboard-previous-section
    "}" #'dashboard-next-section
    "j" #'widget-forward
    "k" #'widget-backward
    (kbd "RET") #'widget-button-press))

;; Org-agenda åŸºç¡€é…ç½®
(use-package org
  :defer t
  :init
  (let ((org-dir (expand-file-name "~/.emacs.d/org")))
    (unless (file-directory-p org-dir) 
      (make-directory org-dir t)))
  
  :custom
 (org-agenda-custom-commands
        '(("v" "A better agenda view"
            ((tags "PRIORITY=\"A\""
                    ((org-agenda-skip-function '(org-agenda-skip-entry-if 'todo 'done))
                    (org-agenda-overriding-header "High-priority unfinished tasks:")))
            (tags "PRIORITY=\"B\""
                    ((org-agenda-skip-function '(org-agenda-skip-entry-if 'todo 'done))
                    (org-agenda-overriding-header "Medium-priority unfinished tasks:")))
            (tags "PRIORITY=\"C\""
                    ((org-agenda-skip-function '(org-agenda-skip-entry-if 'todo 'done))
                    (org-agenda-overriding-header "Low-priority unfinished tasks:")))
            (agenda "")
            (alltodo "")))))
  (org-agenda-files (list (expand-file-name "~/.emacs.d/org")))
  (org-agenda-start-on-weekday nil)
  (org-agenda-span 7))

#+end_src


** markdown-mode
*** ä»‹ç»
markdown-mode æ˜¯ Emacs ä¸­ç”¨äºç¼–è¾‘ Markdown æ–‡ä»¶çš„ä¸»æµæ¨¡å¼ï¼Œæ”¯æŒ GitHub Flavored Markdown (GFM) è¯­æ³•æ‰©å±•ã€‚å®ƒæä¾›è¯­æ³•é«˜äº®ã€é¢„è§ˆã€å¿«æ·é”®ç­‰åŠŸèƒ½ï¼Œæå‡ Markdown ç¼–è¾‘ä½“éªŒã€‚
*** ç›¸å…³é“¾æ¥
- GitHub:https://github.com/jrblevin/markdown-mode
*** é…ç½®
#+begin_src emacs-lisp
(use-package markdown-mode
  :commands (gfm-mode markdown-mode)
  :mode (("README\\.md\\'" . gfm-mode)
         ("\\.md\\'" . markdown-mode)
         ("\\.markdown\\'" . markdown-mode))
  :custom
  (markdown-header-scaling t)
  (markdown-hide-urls t)
  (markdown-fontify-code-blocks-natively t)
  :custom-face
  (markdown-header-delimiter-face ((t (:foreground "#616161" :height 0.9))))
  (markdown-header-face-1 ((t (:height 1.6 :foreground "#A3BE8C" :weight extra-bold :inherit markdown-header-face))))
  (markdown-header-face-2 ((t (:height 1.4 :foreground "#EBCB8B" :weight extra-bold :inherit markdown-header-face))))
  (markdown-header-face-3 ((t (:height 1.2 :foreground "#D08770" :weight extra-bold :inherit markdown-header-face))))
  (markdown-header-face-4 ((t (:height 1.15 :foreground "#BF616A" :weight bold :inherit markdown-header-face))))
  (markdown-header-face-5 ((t (:height 1.1 :foreground "#b48ead" :weight bold :inherit markdown-header-face))))
  (markdown-header-face-6 ((t (:height 1.05 :foreground "#5e81ac" :weight semi-bold :inherit markdown-header-face))))
  :config
  (defvar nb/current-line '(0 . 0)
    "(start . end) of current line in current buffer")
  (make-variable-buffer-local 'nb/current-line)
  
  (defun nb/unhide-current-line (limit)
    "Font-lock function"
    (let ((start (max (point) (car nb/current-line)))
          (end (min limit (cdr nb/current-line))))
      (when (< start end)
        (remove-text-properties start end
                                '(invisible t display "" composition ""))
        (goto-char limit)
        t)))
  
  (defun nb/refontify-on-linemove ()
    "Post-command-hook"
    (let* ((start (line-beginning-position))
           (end (line-beginning-position 2))
           (needs-update (not (equal start (car nb/current-line)))))
      (setq nb/current-line (cons start end))
      (when needs-update
        (font-lock-fontify-block 3))))
  
  (defun nb/markdown-unhighlight ()
    "Enable markdown concealling"
    (interactive)
    (markdown-toggle-markup-hiding 'toggle)
    (font-lock-add-keywords nil '((nb/unhide-current-line)) t)
    (add-hook 'post-command-hook #'nb/refontify-on-linemove nil t))
  
  :hook
  (markdown-mode . nb/markdown-unhighlight))
#+end_src
*** ä½¿ç”¨æ–¹æ³•
- è‡ªåŠ¨å¯ç”¨ markdown-mode ç¼–è¾‘ .md å’Œ .markdown æ–‡ä»¶
- ä½¿ç”¨ =M-x markdown-preview-mode= é¢„è§ˆ Markdown æ¸²æŸ“æ•ˆæœ

** colorful-mode
*** ä»‹ç»
colorful-mode åœ¨ä»£ç ä¸­ç›´æ¥æ˜¾ç¤ºé¢œè‰²å€¼çš„å®é™…é¢œè‰²ï¼Œæ”¯æŒ HEXã€RGBã€HSL ç­‰å¤šç§æ ¼å¼ã€‚å¯¹å‰ç«¯å¼€å‘å’Œä¸»é¢˜é…ç½®ç‰¹åˆ«æœ‰ç”¨ã€‚

*** ç›¸å…³é“¾æ¥
- GitHub: https://github.com/DevelopmentCool2449/colorful-mode

*** é…ç½®
#+begin_src emacs-lisp
(use-package colorful-mode
  :custom
  (colorful-use-prefix t)
  (colorful-only-strings nil)   ;; å…¨å±€æ˜¾ç¤ºé¢œè‰²ï¼Œä¸ä»…é™å­—ç¬¦ä¸²
  (css-fontify-colors nil)
  :init
  ;; æ¯æ¬¡ buffer åˆ‡æ¢æˆ–æ‰“å¼€éƒ½è‡ªåŠ¨å¯ç”¨ colorful-mode
  (add-hook 'after-change-major-mode-hook #'colorful-mode))
#+end_src




*** ä½¿ç”¨æ–¹æ³•
- åœ¨ä»£ç ä¸­è¾“å…¥é¢œè‰²å€¼ï¼ˆå¦‚ #FF5733ï¼‰ä¼šè‡ªåŠ¨æ˜¾ç¤ºé¢œè‰²
- æ”¯æŒç¼–ç¨‹æ¨¡å¼ä¸‹çš„å­—ç¬¦ä¸²å†…é¢œè‰²æ˜¾ç¤º

** doom-themes
*** ä»‹ç»
doom-themes æ˜¯ä¸€ä¸ªä¸°å¯Œçš„ä¸»é¢˜é›†åˆï¼ŒåŒ…å« 25+ ä¸ªç²¾å¿ƒè®¾è®¡çš„é«˜å¯¹æ¯”åº¦ä¸»é¢˜ã€‚æ”¯æŒæ·±è‰²å’Œæµ…è‰²æ¨¡å¼ï¼Œä¸º org-modeã€treemacsã€magit ç­‰å¸¸ç”¨æ¨¡å¼åšäº†ç‰¹åˆ«ä¼˜åŒ–ã€‚

*** ç›¸å…³é“¾æ¥
- GitHub: https://github.com/doomemacs/themes
- ä¸»é¢˜é¢„è§ˆ: https://github.com/doomemacs/themes/tree/screenshots

*** é…ç½®
#+begin_src emacs-lisp
(use-package doom-themes
  :init
  (add-to-list 'custom-theme-load-path "~/.emacs.d/themes/")
  (load-theme 'doom-everforest t)
  ;; (setq doom-themes-enable-bold t
  ;;       doom-themes-enable-italic t)
  ;; (load-theme 'doom-one t)

  ;; Enable flashing mode-line on errors
  (doom-themes-visual-bell-config)
  ;; Enable custom neotree theme (nerd-icons must be installed!)
  (doom-themes-neotree-config)
  ;; or for treemacs users
  (doom-themes-treemacs-config)
  ;; Corrects (and improves) org-mode's native fontification.
  (doom-themes-org-config))
#+end_src


*** ä½¿ç”¨æ–¹æ³•
- æ›´æ¢ä¸»é¢˜: =M-x load-theme RET doom-<ä¸»é¢˜å> RET=
- æ¨èä¸»é¢˜: doom-one, doom-molokai, doom-nord, doom-tomorrow-night

** modus-themes
*** ä»‹ç»
Modus æ˜¯ Emacs å†…ç½®çš„é«˜å¯¹æ¯”åº¦ä¸»é¢˜é›†ï¼Œç”± Protesilaos Stavrou å¼€å‘ã€‚æä¾›æ·±è‰² (vivendi) å’Œæµ…è‰² (operandi) ä¸¤ä¸ªå˜ä½“ï¼Œç¬¦åˆ WCAG AAA æ— éšœç¢æ ‡å‡†ï¼Œé€‚åˆé•¿æ—¶é—´é˜…è¯»å’Œç¼–ç¨‹ã€‚

*** ç›¸å…³é“¾æ¥
- å®˜ç½‘: https://protesilaos.com/emacs/modus-themes
- æ‰‹å†Œ: https://protesilaos.com/emacs/modus-themes

*** é…ç½®
#+begin_src emacs-lisp
;; (use-package modus-themes
;;   :straight t
;;   :init
;;   (my/auto-switch-modus-theme)
;;   (run-at-time "00:00" 3600 #'my/auto-switch-modus-theme)
;;   (run-at-time "06:00" 86400 #'my/auto-switch-modus-theme)  ; æ¯å¤©æ—©ä¸Š6ç‚¹
;;   (run-at-time "22:00" 86400 #'my/auto-switch-modus-theme)) ; æ¯å¤©æ™šä¸Š10ç‚¹
#+end_src

*** ä½¿ç”¨æ–¹æ³•
- è‡ªåŠ¨æ ¹æ®æ—¶é—´åˆ‡æ¢ä¸»é¢˜ï¼ˆ22:00-06:00 æ·±è‰²ï¼Œ06:00-22:00 æµ…è‰²ï¼‰
- æ‰‹åŠ¨åˆ‡æ¢: =M-x load-theme RET modus-vivendi RET= æˆ– =modus-operandi=





** keycast
*** ä»‹ç»
æ˜¾ç¤ºå®æ—¶æŒ‰é”®è¾“å…¥ï¼Œç”¨äºæ•™å­¦ã€å½•å±æˆ–è°ƒè¯•é”®ç»‘å®šã€‚

*** ç›¸å…³é“¾æ¥
- GitHub: https://github.com/tarsius/keycast

*** é…ç½®
#+begin_src emacs-lisp
  (use-package keycast
    :straight t
    :init
    (add-to-list 'global-mode-string '("" keycast-mode-line))
    (keycast-mode-line-mode t))
#+end_src

** doom-modeline
*** ä»‹ç»
doom-modeline æ˜¯ä¸€ä¸ªç°ä»£åŒ–çš„çŠ¶æ€æ ï¼ˆmode-lineï¼‰ï¼Œæ˜¾ç¤º Git åˆ†æ”¯ã€LSP çŠ¶æ€ã€æ–‡ä»¶ç¼–ç ã€è¡Œå·ç­‰ä¿¡æ¯ã€‚æ¯”å†…ç½® mode-line æ›´ç¾è§‚ï¼Œä¿¡æ¯å¯†åº¦æ›´é«˜ã€‚

*** ç›¸å…³é“¾æ¥
- GitHub: https://github.com/seagle0128/doom-modeline
- æ–‡æ¡£: https://github.com/seagle0128/doom-modeline/blob/master/README.md

*** é…ç½®
#+begin_src emacs-lisp
(use-package doom-modeline
  :hook (after-init . doom-modeline-mode)
  :config
  (setq doom-modeline-height 25         ; çŠ¶æ€æ é«˜åº¦
        doom-modeline-bar-width 3))     ; å·¦ä¾§æ¡å®½åº¦
#+end_src

*** ä½¿ç”¨æ–¹æ³•
çŠ¶æ€æ ä¼šè‡ªåŠ¨æ˜¾ç¤ºå½“å‰ç¼“å†²åŒºä¿¡æ¯ï¼Œæ— éœ€æ‰‹åŠ¨æ“ä½œã€‚

** centaur-tabs
*** ä»‹ç»
centaur-tabs æä¾›ç±»ä¼¼æµè§ˆå™¨çš„æ ‡ç­¾æ ï¼Œæ”¯æŒæ ‡ç­¾åˆ†ç»„ã€å›¾æ ‡æ˜¾ç¤ºã€è‡ªå®šä¹‰æ ·å¼ã€‚å¯ä»¥æŒ‰é¡¹ç›®æˆ–æ¨¡å¼åˆ†ç»„ç¼“å†²åŒºï¼Œæ–¹ä¾¿å¤šæ–‡ä»¶ç®¡ç†ã€‚

*** ç›¸å…³é“¾æ¥
- GitHub: https://github.com/ema2159/centaur-tabs

*** é…ç½®
#+begin_src emacs-lisp
(use-package centaur-tabs
  :init
  ;; ğŸ”‘ å…³é”®ï¼šdaemon æ¨¡å¼å…¼å®¹æ€§ä¿®å¤
  (if (daemonp)
      (add-hook 'server-after-make-frame-hook 'centaur-tabs-mode)
    (add-hook 'after-init-hook 'centaur-tabs-mode))
  :config
  ;; åŸºç¡€é…ç½®
  (setq centaur-tabs-set-bar 'left
        centaur-tabs-style "bar"
        centaur-tabs-set-icons t
        centaur-tabs-gray-out-icons 'buffer
        centaur-tabs-icon-type 'nerd-icons
        centaur-tabs-set-modified-marker t)
  
  ;; è®¡æ•°å‡½æ•°
  (defun my/count-file-buffers ()
    "è®¡ç®—æ‰“å¼€çš„æ–‡ä»¶ buffer æ•°é‡"
    (length (cl-remove-if-not 'buffer-file-name (buffer-list))))
  
  ;; æ›´æ–°æ˜¾ç¤º
  (defun my/update-tabs-visibility ()
    "2ä¸ªæˆ–ä»¥ä¸Šæ–‡ä»¶æ‰æ˜¾ç¤º tabs"
    (let ((count (my/count-file-buffers)))
      (if (>= count 2)
          (unless centaur-tabs-mode (centaur-tabs-mode 1))
        (when centaur-tabs-mode (centaur-tabs-mode -1)))))
  ;; ç›‘å¬ buffer å˜åŒ–
  (add-hook 'buffer-list-update-hook 'my/update-tabs-visibility)
  
  ;; åˆå§‹æ£€æŸ¥
  (run-with-idle-timer 0.5 nil 'my/update-tabs-visibility))
#+end_src

*** ä½¿ç”¨æ–¹æ³•
- åˆ‡æ¢æ ‡ç­¾: =H= (å‰ä¸€ä¸ª), =L= (åä¸€ä¸ª) - éœ€åœ¨ Evil æ¨¡å¼ä¸‹
- åˆ‡æ¢åˆ†ç»„: =SPC f t=

** indent-bars
*** ä»‹ç»
indent-bars åœ¨ä»£ç ä¸­æ˜¾ç¤ºç¼©è¿›å‚è€ƒçº¿ï¼Œæ”¯æŒ tree-sitterï¼Œå¸®åŠ©è¯†åˆ«ä»£ç å—å±‚çº§ã€‚å¯¹ Python ç­‰ç¼©è¿›æ•æ„Ÿçš„è¯­è¨€ç‰¹åˆ«æœ‰ç”¨ã€‚

*** ç›¸å…³é“¾æ¥
- GitHub: https://github.com/jdtsmith/indent-bars

*** é…ç½®
#+begin_src emacs-lisp
(use-package indent-bars
  :custom
  (indent-bars-no-descend-lists t)                    ; åˆ—è¡¨ä¸æ˜¾ç¤ºé¢å¤–ç¼©è¿›çº¿
  (indent-bars-treesit-support t)                     ; å¯ç”¨ tree-sitter æ”¯æŒ
  (indent-bars-treesit-ignore-blank-lines-types '("module"))
  (indent-bars-treesit-scope '((python function_definition class_definition 
                                       for_statement if_statement 
                                       with_statement while_statement)))
  :hook ((kdl-mode nix-ts-mode java-ts-mode python-ts-mode yaml-mode c++-ts-mode) . indent-bars-mode))
#+end_src

*** ä½¿ç”¨æ–¹æ³•
åœ¨æ”¯æŒçš„æ¨¡å¼ä¸‹è‡ªåŠ¨å¯ç”¨ï¼Œæ— éœ€æ‰‹åŠ¨æ“ä½œã€‚

** all-the-icons
*** ä»‹ç»
all-the-icons æä¾› 1000+ ä¸ªå›¾æ ‡ï¼Œç”¨äºç¾åŒ–æ–‡ä»¶æµè§ˆå™¨ã€diredã€mode-line ç­‰ã€‚æ˜¯è®¸å¤š UI æ’ä»¶çš„åŸºç¡€ä¾èµ–ã€‚

*** ç›¸å…³é“¾æ¥
- GitHub: https://github.com/domtronn/all-the-icons.el

*** é…ç½®
#+begin_src emacs-lisp
(use-package all-the-icons
  :if (display-graphic-p))
#+end_src

*** ä½¿ç”¨æ–¹æ³•
- é¦–æ¬¡ä½¿ç”¨éœ€å®‰è£…å­—ä½“: =M-x all-the-icons-install-fonts=

** nerd-icons
*** ä»‹ç»
nerd-icons æ˜¯ all-the-icons çš„ç°ä»£åŒ–ç‰ˆæœ¬ï¼Œæ”¯æŒæœ€æ–°çš„ Nerd Fonts å›¾æ ‡é›†ï¼Œæ€§èƒ½æ›´å¥½ï¼Œå›¾æ ‡æ›´ä¸°å¯Œã€‚

*** ç›¸å…³é“¾æ¥
- GitHub: https://github.com/rainstormstudio/nerd-icons.el

*** é…ç½®
#+begin_src emacs-lisp
(use-package nerd-icons
  :defer t
  :if (display-graphic-p))
#+end_src

*** ä½¿ç”¨æ–¹æ³•
- å®‰è£…å­—ä½“: =M-x nerd-icons-install-fonts=

** nerd-icons-completion
*** ä»‹ç»
ä¸ºè¡¥å…¨ç•Œé¢ï¼ˆå¦‚ Verticoï¼‰æ·»åŠ å›¾æ ‡æ”¯æŒï¼Œä½¿è¡¥å…¨åˆ—è¡¨æ›´åŠ ç›´è§‚ç¾è§‚ã€‚

*** ç›¸å…³é“¾æ¥
- GitHub: https://github.com/rainstormstudio/nerd-icons-completion

*** é…ç½®
#+begin_src emacs-lisp
(use-package nerd-icons-completion
  :after marginalia
  :hook (after-init . nerd-icons-completion-mode)
  :hook (marginalia-mode . nerd-icons-completion-marginalia-setup))
#+end_src

** neotree
*** ä»‹ç»
neotree æ˜¯ä¸€ä¸ªä¾§è¾¹æ–‡ä»¶æ ‘æµè§ˆå™¨ï¼Œç±»ä¼¼ VS Code çš„èµ„æºç®¡ç†å™¨ï¼Œæ”¯æŒ Git çŠ¶æ€å›¾æ ‡ã€æ–‡ä»¶æ“ä½œç­‰ã€‚

*** ç›¸å…³é“¾æ¥
- GitHub: https://github.com/jaypei/emacs-neotree

*** é…ç½®
#+begin_src emacs-lisp
(use-package neotree
  :hook (after-init . (lambda ()
                        (global-set-key [f3] 'neotree-toggle)))
  :config
  (setq neo-window-width 40)
  (setq neo-smart-open t)
  (setq neo-theme (if (display-graphic-p) 'nerd-icons 'arrow))
  (setq neo-window-fixed-size nil)
  
  (add-hook 'neo-after-create-hook
            (lambda (&rest _)
              (setq truncate-lines t)
              (setq word-wrap nil)
              (setq display-line-numbers nil)  ; å®Œå…¨ç¦ç”¨è¡Œå·æ˜¾ç¤º
              (display-line-numbers-mode -1))))  ; ç¡®ä¿å…³é—­è¡Œå·æ¨¡å¼
#+end_src

*** ä½¿ç”¨æ–¹æ³•
- æ‰“å¼€/å…³é—­: =F3= æˆ– =SPC e=
- åœ¨ neotree ä¸­:
  - =h= : ä¸Šä¸€çº§ç›®å½•
  - =l= : è¿›å…¥ç›®å½•æˆ–æ‰“å¼€æ–‡ä»¶
  - =q= : å…³é—­ neotree
  - =a= : åˆ›å»ºæ–‡ä»¶
  - =d= : åˆ é™¤æ–‡ä»¶
  - =r= : é‡å‘½åæ–‡ä»¶


* ç¼–è¾‘å¢å¼º

æå‡æ–‡æœ¬ç¼–è¾‘ä½“éªŒï¼ŒåŒ…æ‹¬ Vim æ¨¡æ‹Ÿã€è‡ªåŠ¨è¡¥å…¨ã€ä»£ç ç‰‡æ®µç­‰ã€‚

** åŸºç¡€ç¼–è¾‘è®¾ç½®
#+begin_src emacs-lisp
      ;; ç¼–è¾‘ä½“éªŒä¼˜åŒ–
      (auto-save-visited-mode 0)           ; è‡ªåŠ¨ä¿å­˜
      (show-paren-mode 1)                  ; é«˜äº®åŒ¹é…æ‹¬å·
      (global-auto-revert-mode 1)          ; è‡ªåŠ¨é‡æ–°åŠ è½½å¤–éƒ¨ä¿®æ”¹çš„æ–‡ä»¶
      (delete-selection-mode 1)            ; é€‰ä¸­æ–‡å­—åè¾“å…¥ä¼šæ›¿æ¢
      (recentf-mode 1)                     ; æœ€è¿‘æ–‡ä»¶åˆ—è¡¨

      ;; å¯ç”¨ç›¸å¯¹è¡Œå·
      (global-display-line-numbers-mode 1)
      (setq display-line-numbers-type 'relative)

      ;; å°† yes-or-no-p æ›¿æ¢ä¸º y-or-n-p
      (defalias 'yes-or-no-p 'y-or-n-p)
      ;; å…³é—­å¤‡ä»½æ–‡ä»¶
      (setq make-backup-files nil)         ; ä¸åˆ›å»º ~ å¤‡ä»½æ–‡ä»¶
      (setq auto-save-default nil)         ; ä¸åˆ›å»º # è‡ªåŠ¨ä¿å­˜æ–‡ä»¶
#+end_src


** sis-change-input-method
*** ä»‹ç»
sis (Smart Input Source) æ™ºèƒ½è¾“å…¥æ³•ç®¡ç†å·¥å…·ï¼Œè‡ªåŠ¨åœ¨ä¸åŒæ¨¡å¼å’Œä¸Šä¸‹æ–‡ä¸­åˆ‡æ¢è¾“å…¥æ³•ã€‚æ”¯æŒ macOS å’Œ Linux (fcitx5)ï¼Œæä¾› inlineã€contextã€respect ç­‰å¤šç§æ¨¡å¼ã€‚

*** ç›¸å…³é“¾æ¥
- GitHub: https://github.com/laishulu/emacs-smart-input-source

*** é…ç½®
#+begin_src emacs-lisp
(use-package sis
  :init
  ;; macOS é…ç½®
  (when (eq system-type 'darwin)
    (sis-ism-lazyman-config
     "com.apple.keylayout.ABC"
     "com.tencent.inputmethod.wetype.pinyin"
     'macOS))
  
  ;; Linux é…ç½®
  (when (eq system-type 'gnu/linux)
    (sis-ism-lazyman-config "1" "2" 'fcitx5))
  
  ;; å¯ç”¨åŠŸèƒ½
  (sis-global-cursor-color-mode t)
  (sis-global-respect-mode t)     ; ä¸ç”¨è¿™ä¸ªï¼Œä¼šå¼ºåˆ¶åˆ‡è‹±æ–‡
  (sis-global-context-mode t)        ; è¿™ä¸ªä¼šæ ¹æ®ä¸Šä¸‹æ–‡æ™ºèƒ½åˆ‡æ¢ï¼Œä¿æŒè¾“å…¥æ³•
  (sis-global-inline-mode t))
#+end_src

*** ä½¿ç”¨è¯´æ˜
- macOS é…ç½®ä¸º ABC è‹±æ–‡å’Œå¾®ä¿¡è¾“å…¥æ³•
- Linux é…ç½®ä¸º fcitx5
- å¯ç”¨å…‰æ ‡é¢œè‰²æ¨¡å¼ï¼šä¸åŒè¾“å…¥æ³•æ˜¾ç¤ºä¸åŒå…‰æ ‡é¢œè‰²
- respect æ¨¡å¼ï¼šåœ¨åˆ‡æ¢ buffer æ—¶ä¿æŒä¹‹å‰çš„è¾“å…¥æ³•çŠ¶æ€
- inline æ¨¡å¼ï¼šåœ¨è¡Œå†…è‡ªåŠ¨åˆ‡æ¢è¾“å…¥æ³•

** savehist
*** ä»‹ç»
savehist æ˜¯ Emacs å†…ç½®åŒ…ï¼Œç”¨äºä¿å­˜ minibuffer å†å²è®°å½•ã€‚è®©ä½ åœ¨é‡å¯ Emacs åä»èƒ½ä½¿ç”¨ä¹‹å‰çš„å‘½ä»¤å†å²ã€æœç´¢å†å²ç­‰ã€‚

*** é…ç½®
#+begin_src emacs-lisp
(use-package savehist
  :hook (after-init . savehist-mode)
  :config
  (setq history-length 1000                     ;; ä¿å­˜å†å²æ¡ç›®æ•°
        savehist-autosave-interval 300         ;; è‡ªåŠ¨ä¿å­˜é—´éš”ï¼ˆç§’ï¼‰
        savehist-additional-variables '(kill-ring search-ring regexp-search-ring)))                            ;; å¯ç”¨ savehist
#+end_src

*** ä½¿ç”¨è¯´æ˜
- ä¿å­˜æœ€è¿‘ 1000 æ¡å†å²è®°å½•
- æ¯ 5 åˆ†é’Ÿè‡ªåŠ¨ä¿å­˜ä¸€æ¬¡
- é¢å¤–ä¿å­˜ kill-ring å’Œæœç´¢å†å²



** saveplace
*** ä»‹ç»
saveplace æ˜¯ Emacs å†…ç½®åŒ…ï¼Œè®°ä½æ¯ä¸ªæ–‡ä»¶ä¸Šæ¬¡è®¿é—®æ—¶å…‰æ ‡çš„ä½ç½®ã€‚é‡æ–°æ‰“å¼€æ–‡ä»¶æ—¶è‡ªåŠ¨è·³è½¬åˆ°ä¸Šæ¬¡çš„ä½ç½®ã€‚

*** é…ç½®
#+begin_src emacs-lisp
(use-package saveplace
  :hook (after-init . save-place-mode)
  :config
  (setq save-place-file (expand-file-name "saveplace" user-emacs-directory)))                           ;; å¯ç”¨ saveplace
#+end_src

*** ä½¿ç”¨è¯´æ˜
- è‡ªåŠ¨ä¿å­˜æ¯ä¸ªæ–‡ä»¶çš„å…‰æ ‡ä½ç½®
- æ•°æ®ä¿å­˜åœ¨ ~/.emacs.d/saveplace æ–‡ä»¶ä¸­

** beacon
*** ä»‹ç»
beacon åœ¨å…‰æ ‡ç§»åŠ¨æ—¶é«˜äº®æ˜¾ç¤ºå…‰æ ‡ä½ç½®ï¼Œæ–¹ä¾¿å¿«é€Ÿå®šä½ã€‚ç‰¹åˆ«é€‚åˆå¤§å±å¹•æˆ–å¤šçª—å£ç¯å¢ƒã€‚
*** ç›¸å…³é“¾æ¥
- GitHub: https://github.com/Malabarba/beacon

*** é…ç½®
#+begin_src emacs-lisp
(use-package beacon
  :init
  (beacon-mode 1))
#+end_src
*** ä½¿ç”¨æ–¹æ³•
- è‡ªåŠ¨åœ¨å…‰æ ‡ç§»åŠ¨æ—¶é«˜äº®æ˜¾ç¤ºä½ç½®
- å¯è‡ªå®šä¹‰é«˜äº®é¢œè‰²å’ŒæŒç»­æ—¶é—´
  

** magit
*** ä»‹ç»
Magit æ˜¯ Emacs ä¸­æœ€å¼ºå¤§çš„ Git å®¢æˆ·ç«¯ï¼Œæä¾›å®Œæ•´çš„ Git åŠŸèƒ½ç•Œé¢ã€‚é€šè¿‡ç›´è§‚çš„èœå•å’Œå¿«æ·é”®ï¼Œå¯ä»¥æ‰§è¡Œæ‰€æœ‰ Git æ“ä½œï¼ŒåŒ…æ‹¬ commitã€branchã€mergeã€rebase ç­‰ã€‚

*** ç›¸å…³é“¾æ¥
- å®˜ç½‘: https://magit.vc/
- æ‰‹å†Œ: https://magit.vc/manual/

*** é…ç½®
#+begin_src emacs-lisp
(use-package magit
  :commands (magit-status magit-dispatch)  ;; æ˜ç¡®æŒ‡å®šè§¦å‘å‘½ä»¤
  :config
  ;; å¯é€‰é…ç½®
  (setq magit-display-buffer-function #'magit-display-buffer-same-window-except-diff-v1))
#+end_src

*** ä½¿ç”¨æ–¹æ³•
- é”®ç»‘å®š: =SPC g g= æ‰“å¼€ Magit çŠ¶æ€ç•Œé¢
- åœ¨ Magit ç•Œé¢ä¸­:
  - =s= : stage æ–‡ä»¶
  - =u= : unstage æ–‡ä»¶
  - =c= : commit èœå•
  - =P= : push èœå•
  - =F= : pull èœå•
  - =b= : branch èœå•
  - =l= : log èœå•
  - =?= : æ˜¾ç¤ºå¸®åŠ©


** blamer
*** ä»‹ç»
blamer.el åœ¨ä»£ç è¡Œå°¾æ˜¾ç¤º Git æäº¤ä¿¡æ¯ï¼ˆä½œè€…ã€æ—¶é—´ã€æäº¤æ‘˜è¦ï¼‰ã€‚å¸®åŠ©å¿«é€Ÿäº†è§£ä»£ç å˜æ›´å†å²ï¼Œç±»ä¼¼ VS Code çš„ GitLens æ’ä»¶ã€‚
*** ç›¸å…³é“¾æ¥
- GitHub: https://github.com/APRhum/blamer.el
*** é…ç½®

#+begin_src emacs-lisp
(use-package blamer
  :straight (:host github :repo "artawower/blamer.el")
  :custom
  (blamer-idle-time 0.3)
  (blamer-min-offset 70)
  :custom-face
  (blamer-face ((t :foreground "#7a88cf"
                    :background unspecified
                    :height 140
                    :italic t)))
  :init
  (setq blamer-commit-formatter " â— %s")
  (setq blamer-author-formatter "  âœ %s ")
  (global-blamer-mode 0))
#+end_src

*** ä½¿ç”¨æ–¹æ³•
- è‡ªåŠ¨åœ¨ä»£ç è¡Œå°¾æ˜¾ç¤º Git æäº¤ä¿¡æ¯
- =s-i= : æ˜¾ç¤ºå½“å‰è¡Œçš„å®Œæ•´æäº¤ä¿¡æ¯å¼¹çª—


** diff-hl
*** ä»‹ç»
diff-hl åœ¨ç¼–è¾‘å™¨è¾¹ç¼˜ï¼ˆfringeï¼‰æ˜¾ç¤º Git å·®å¼‚æ ‡è®°ï¼Œå®æ—¶æ˜¾ç¤ºæ–‡ä»¶çš„ä¿®æ”¹ã€æ·»åŠ ã€åˆ é™¤è¡Œã€‚æ”¯æŒä¸ Magit é›†æˆï¼Œæä¾›å³æ—¶çš„ç‰ˆæœ¬æ§åˆ¶åé¦ˆã€‚flydiff æ¨¡å¼å¯ä»¥åœ¨ç¼–è¾‘æ—¶å®æ—¶æ›´æ–°å·®å¼‚æ ‡è®°ã€‚

*** ç›¸å…³é“¾æ¥
- GitHub: https://github.com/dgutov/diff-hl

*** é…ç½®
#+begin_src emacs-lisp
(use-package diff-hl
  :init
  ;; åœ¨ diff-hl åˆå§‹åŒ–å‰å†æ¬¡ç¡®ä¿ shell è·¯å¾„æ­£ç¡®
  (when-let ((zsh-path (executable-find "zsh")))
    (setq shell-file-name zsh-path))
  (diff-hl-flydiff-mode)
  (global-diff-hl-mode))
#+end_src

*** ä½¿ç”¨æ–¹æ³•
- åœ¨ fringe è‡ªåŠ¨æ˜¾ç¤º Git å·®å¼‚æ ‡è®°
- ç»¿è‰²: æ–°å¢è¡Œ
- è“è‰²: ä¿®æ”¹è¡Œ
- çº¢è‰²: åˆ é™¤è¡Œ
- =M-x diff-hl-diff-goto-hunk= : è·³è½¬åˆ°å·®å¼‚å¤„
- =M-x diff-hl-revert-hunk= : è¿˜åŸå½“å‰ä¿®æ”¹å—

** pdf-tools
*** ä»‹ç»
pdf-tools æ˜¯ Emacs çš„å¼ºå¤§ PDF é˜…è¯»å™¨ï¼Œæä¾›æ¯” DocView æ›´å¥½çš„æ€§èƒ½å’ŒåŠŸèƒ½ã€‚æ”¯æŒæ³¨é‡Šã€æœç´¢ã€é“¾æ¥è·³è½¬ã€å¤œé—´æ¨¡å¼ç­‰ã€‚

*** ç›¸å…³é“¾æ¥
- GitHub: https://github.com/vedang/pdf-tools

*** é…ç½®
#+begin_src emacs-lisp
(use-package pdf-tools
  :mode ("\\.pdf\\'" . pdf-view-mode)
  :init
  (setq pdf-view-display-size 'fit-page
        pdf-view-incompatible-modes
        '(display-line-numbers-mode hl-line-mode visual-line-mode)
        ;; ç¦ç”¨ pdf-view çš„è­¦å‘Š
        warning-suppress-types '((pdf-view)))
  :config
  ;; è‡ªåŠ¨å®‰è£… pdf-toolsï¼ˆè‹¥ pdf-info æœªè¿è¡Œï¼‰
  (unless (pdf-info-running-p)
    (pdf-tools-install-noverify))

  ;; è¿›å…¥ pdf-view-mode æ—¶è‡ªåŠ¨è°ƒæ•´æ˜¾ç¤ºã€å…³é—­ä¸å…¼å®¹æ¨¡å¼
  (add-hook 'pdf-view-mode-hook
            (lambda ()
              (display-line-numbers-mode -1)
              (visual-line-mode -1)
              (hl-line-mode -1)
              (pdf-view-fit-page-to-window))))
#+end_src

*** ä½¿ç”¨æ–¹æ³•
- è‡ªåŠ¨å¤„ç† .pdf æ–‡ä»¶
- =n/p= : ä¸‹ä¸€é¡µ/ä¸Šä¸€é¡µ
- =+/-= : æ”¾å¤§/ç¼©å°
- =W= : è‡ªé€‚åº”å®½åº¦
- =H= : è‡ªé€‚åº”é«˜åº¦
- =C-s= : æœç´¢
- =o= : æ‰“å¼€ç›®å½•å¤§çº²



** super-save
*** ä»‹ç»
super-save æä¾›æ™ºèƒ½è‡ªåŠ¨ä¿å­˜åŠŸèƒ½ï¼Œåœ¨åˆ‡æ¢çª—å£ã€buffer æˆ–ç©ºé—²æ—¶è‡ªåŠ¨ä¿å­˜æ–‡ä»¶ã€‚æ¯” Emacs å†…ç½®çš„è‡ªåŠ¨ä¿å­˜æ›´åŠ æ™ºèƒ½å’Œå¯é ã€‚

*** ç›¸å…³é“¾æ¥
- GitHub: https://github.com/bbatsov/super-save

*** é…ç½®
#+begin_src emacs-lisp
(use-package super-save
  :hook (after-init . super-save-mode)
  :config
  (setq super-save-auto-save-when-idle t
        super-save-silent t
        auto-save-default nil))
#+end_src

*** ä½¿ç”¨è¯´æ˜
- ç©ºé—²æ—¶è‡ªåŠ¨ä¿å­˜
- é™é»˜æ¨¡å¼ï¼Œä¸æ˜¾ç¤ºä¿å­˜æ¶ˆæ¯
- ç¦ç”¨é»˜è®¤çš„è‡ªåŠ¨ä¿å­˜æœºåˆ¶

* ç»ˆç«¯å·¥å…·

** eat
*** ä»‹ç»
eat (Emulate A Terminal) æ˜¯ä¸€ä¸ªç°ä»£åŒ–çš„ç»ˆç«¯æ¨¡æ‹Ÿå™¨ï¼Œæ¯” term.el å’Œ ansi-term æ›´å¿«æ›´å®Œæ•´ã€‚å®Œå…¨åœ¨ Emacs Lisp ä¸­å®ç°ï¼Œæ”¯æŒå®Œæ•´çš„ ANSI è½¬ä¹‰åºåˆ—ã€çœŸå½©è‰²ã€é¼ æ ‡æ“ä½œç­‰ã€‚ä¸ eshell å®Œç¾é›†æˆã€‚

*** ç›¸å…³é“¾æ¥
- Codeberg: https://codeberg.org/akib/emacs-eat

*** é…ç½®
#+begin_src emacs-lisp
(use-package eat
  :straight (eat :type git
                 :host codeberg
                 :repo "akib/emacs-eat"
                 :files ("*.el" 
                         ("e" "e/*") 
                         "*.texi" 
                         "*.ti" 
                         ("terminfo/e" "e/*") 
                         "*.info"))
  :custom
  (eat-term-name "xterm-256color")

  :config
  (server-start)
  (add-hook 'eshell-first-time-mode-hook #'eat-eshell-mode)
  
  
  ;; Evil æ¨¡å¼é…ç½®
  (evil-set-initial-state 'eat-mode 'emacs)
  
  ;; eat-mode-hook é…ç½®
  (add-hook 'eat-mode-hook
            (lambda ()
              ;; å–æ¶ˆè¡Œå·æ˜¾ç¤º
              (display-line-numbers-mode -1)
              
              ;; Evil æ¨¡å¼é”®ç»‘å®š
              (evil-local-set-key 'normal (kbd "p") 'eat-yank)
              (evil-local-set-key 'normal (kbd "P") 'eat-yank)
              (local-set-key (kbd "C-S-v") 'eat-yank))))
#+end_src


*** ä½¿ç”¨æ–¹æ³•
- =M-x eat= : æ‰“å¼€æ–°çš„ç»ˆç«¯
- =M-x eshell= : æ‰“å¼€ eshell (è‡ªåŠ¨å¯ç”¨ eat)
- æ”¯æŒå®Œæ•´çš„ç»ˆç«¯åŠŸèƒ½ï¼ŒåŒ…æ‹¬ vimã€htop ç­‰ç¨‹åº
- åœ¨ eshell ä¸­æä¾›æ›´å¥½çš„å‘½ä»¤è¡Œä½“éªŒ

** vterm
*** ä»‹ç»
vterm æ˜¯åŸºäº libvterm çš„é«˜æ€§èƒ½ç»ˆç«¯æ¨¡æ‹Ÿå™¨ï¼Œæ¯” term.el å’Œ ansi-term æ›´å¿«æ›´å®Œæ•´ã€‚éœ€è¦ç¼–è¯‘ C æ¨¡å—ï¼Œæä¾›æ¥è¿‘åŸç”Ÿç»ˆç«¯çš„ä½“éªŒã€‚

*** ç›¸å…³é“¾æ¥
- GitHub: https://github.com/akermu/emacs-libvterm

*** é…ç½®
#+begin_src emacs-lisp
(use-package vterm
  :config
  (setq vterm-max-scrollback 10000))
#+end_src

*** ä½¿ç”¨æ–¹æ³•
- =M-x vterm= : æ‰“å¼€ vterm ç»ˆç«¯
- æœ€å¤§æ»šåŠ¨å›æº¯è¡Œæ•°è®¾ç½®ä¸º 10000
- æ”¯æŒå®Œæ•´çš„ ANSI è½¬ä¹‰åºåˆ—å’ŒçœŸå½©è‰²

** transient
*** ä»‹ç»
transient æ˜¯ä¸€ä¸ªç”¨äºåˆ›å»ºä¸´æ—¶å¼¹å‡ºèœå•çš„æ¡†æ¶ï¼Œç±»ä¼¼ Magit çš„èœå•ç³»ç»Ÿã€‚è®¸å¤šç°ä»£ Emacs åŒ…ä¾èµ–å®ƒæ¥æä¾›äº¤äº’å¼å‘½ä»¤ç•Œé¢ã€‚

*** ç›¸å…³é“¾æ¥
- GitHub: https://github.com/magit/transient

*** é…ç½®
#+begin_src emacs-lisp
(use-package transient
  :defer t)  ;; å»¶è¿ŸåŠ è½½ï¼Œmagit ç­‰åŒ…ä¼šè‡ªåŠ¨è§¦å‘
#+end_src

** which-key
*** ä»‹ç»
which-key åœ¨ä½ æŒ‰ä¸‹ä¸€ä¸ªå‰ç¼€é”®ï¼ˆå¦‚ =SPC=ã€=C-x= ç­‰ï¼‰åï¼Œè‡ªåŠ¨æ˜¾ç¤ºæ‰€æœ‰å¯ç”¨çš„é”®ç»‘å®šè¡¥å…¨å»ºè®®ã€‚å¸®åŠ©ä½ å‘ç°å’Œè®°å¿†å¤æ‚çš„é”®ç»‘å®šåºåˆ—ï¼Œéå¸¸é€‚åˆåˆå­¦è€…å’Œä½¿ç”¨ leader key çš„é…ç½®ã€‚

*** ç›¸å…³é“¾æ¥
- GitHub: https://github.com/justbur/emacs-which-key

*** é…ç½®
#+begin_src emacs-lisp
  (use-package which-key
  :hook (after-init . which-key-mode)
  :config
  ;; setting-tag
  (which-key-add-key-based-replacements "SPC a" "ai")
  (which-key-add-key-based-replacements "SPC b" "buffer")
  (which-key-add-key-based-replacements "SPC c" "lsp")
  (which-key-add-key-based-replacements "SPC f" "Find-file")
  (which-key-add-key-based-replacements "SPC s" "search")
  (which-key-add-key-based-replacements "SPC g" "git")
  (which-key-add-key-based-replacements "SPC m" "mark")
  (which-key-add-key-based-replacements "SPC o" "org")
  (which-key-add-key-based-replacements "SPC q" "quit")
  (which-key-add-key-based-replacements "SPC w" "window")
  (which-key-add-key-based-replacements "SPC x" "trouble")
  ;; å¿«é€Ÿæ˜¾ç¤ºï¼ˆ0.4 ç§’ï¼‰
  (setq which-key-idle-delay 0.1)
  ;; åœ¨å±å¹•åº•éƒ¨æ˜¾ç¤º
  (setq which-key-side-window-location 'bottom)
  ;; æ˜¾ç¤ºå®½åº¦
  (setq which-key-side-window-max-width 0.5))
#+end_src


*** ä½¿ç”¨æ–¹æ³•
- æŒ‰ä¸‹ä»»æ„å‰ç¼€é”®ï¼ˆå¦‚ =SPC=ï¼‰ï¼Œç¨ç­‰ç‰‡åˆ»å³å¯çœ‹åˆ°æ‰€æœ‰å¯ç”¨çš„åç»­æŒ‰é”®
- å¯ä»¥ç»§ç»­è¾“å…¥ç¼©å°èŒƒå›´ï¼Œæˆ–æŒ‰ =C-h= æŸ¥çœ‹åˆ†é¡µå¸®åŠ©

** evil
*** ä»‹ç»
evil æ˜¯ Emacs çš„ Vim æ¨¡æ‹Ÿå±‚ï¼Œæä¾›å®Œæ•´çš„ Vim æ¨¡å¼ç³»ç»Ÿï¼ˆnormalã€insertã€visual ç­‰ï¼‰ã€‚æ”¯æŒ Vim çš„æ ¸å¿ƒå‘½ä»¤å’Œæ“ä½œï¼Œé€‚åˆ Vim ç”¨æˆ·è¿ç§»åˆ° Emacsã€‚

*** ç›¸å…³é“¾æ¥
- GitHub: https://github.com/emacs-evil/evil
- æ–‡æ¡£: https://evil.readthedocs.io/

*** é…ç½®
#+begin_src emacs-lisp
  (use-package evil
    :straight t
    :demand t
    :init
    (setq evil-want-keybinding nil)  ; é¿å…é”®ç»‘å®šå†²çª
    (setq evil-want-C-u-scroll t)    ; C-u å‘ä¸Šæ»šåŠ¨
    (setq evil-undo-system 'undo-fu) ; è®¾ç½® undo ç³»ç»Ÿ
    :config
    (evil-mode 1)
    ;; å…è®¸ RET åœ¨ org-mode ä¸­è·Ÿéšé“¾æ¥
    (with-eval-after-load 'evil-maps
      (define-key evil-motion-state-map (kbd "RET") nil)))
#+end_src

*** ä½¿ç”¨æ–¹æ³•
- =i= : è¿›å…¥æ’å…¥æ¨¡å¼
- =ESC= : è¿”å› normal æ¨¡å¼
- =v= : è¿›å…¥ visual æ¨¡å¼
- æ”¯æŒæ‰€æœ‰æ ‡å‡† Vim å‘½ä»¤ï¼š=dd=, =yy=, =p=, =u=, =Ctrl-r= ç­‰

  
** evil-collection

*** ä»‹ç»
evil-collection æ˜¯ä¸€ä¸ª Evil æ¨¡å¼çš„æ‰©å±•åŒ…ï¼Œä¸º Emacs çš„å„ç§å†…ç½®æ¨¡å¼å’Œç¬¬ä¸‰æ–¹åŒ…æä¾›æ›´å¥½çš„ Vim å¿«æ·é”®æ”¯æŒã€‚ç®€å•è¯´ï¼Œå®ƒè®©ä½ åœ¨ä½¿ç”¨ Evil æ¨¡å¼æ—¶ï¼Œèƒ½åœ¨æ›´å¤šåœ°æ–¹ä½¿ç”¨ Vim é£æ ¼çš„å¿«æ·é”®ï¼Œè€Œä¸ä»…ä»…æ˜¯ç¼–è¾‘å™¨ã€‚
æ¯”å¦‚åœ¨ Diredï¼ˆæ–‡ä»¶ç®¡ç†å™¨ï¼‰ã€Magitï¼ˆGit å®¢æˆ·ç«¯ï¼‰ã€Help ç­‰åœ°æ–¹ï¼Œéƒ½èƒ½ç”¨ hjkl ç§»åŠ¨ï¼Œdd åˆ é™¤ç­‰ Vim å¿«æ·é”®ã€‚

*** ç›¸å…³é“¾æ¥
- GitHub: https://github.com/emacs-evil/evil-collection

*** é…ç½®
#+begin_src emacs-lisp
(use-package evil-collection
  :after evil
  :init
  (evil-collection-init))
#+end_src

*** ä½¿ç”¨æ–¹æ³•
- è‡ªåŠ¨ä¸º 100+ ä¸ª Emacs æ¨¡å¼æ·»åŠ  Vim é£æ ¼é”®ç»‘å®š
- åœ¨ Diredã€Magitã€Helpã€Ibuffer ç­‰æ¨¡å¼ä¸­éƒ½èƒ½ä½¿ç”¨ Vim æ“ä½œ


** evil-matchit
*** ä»‹ç»
evil-matchit å…è®¸åœ¨ Evil æ¨¡å¼ä¸‹å¿«é€Ÿè·³è½¬åˆ°åŒ¹é…çš„æ ‡ç­¾æˆ–æ‹¬å·ï¼Œç±»ä¼¼ Vim çš„ matchit æ’ä»¶ã€‚æ”¯æŒå¤šç§ç¼–ç¨‹è¯­è¨€å’Œæ ‡è®°è¯­è¨€ã€‚
*** ç›¸å…³é“¾æ¥
- GitHub: https://github.com/gregsexton/evil-matchit
*** é…ç½®
#+begin_src emacs-lisp
(use-package evil-matchit
  :config
  (global-evil-matchit-mode 1)
  )
#+end_src

*** ä½¿ç”¨æ–¹æ³•
- =%=: åœ¨å…‰æ ‡å¤„è·³è½¬åˆ°åŒ¹é…çš„æ ‡ç­¾æˆ–æ‹¬å·
** evil-anzu

*** ä»‹ç»
evil-anzu é›†æˆäº† anzu.el çš„æœç´¢å¢å¼ºåŠŸèƒ½åˆ° Evil æ¨¡å¼ä¸­ï¼Œæä¾›æ›´ç›´è§‚çš„æœç´¢åé¦ˆã€‚æ˜¾ç¤ºå½“å‰æœç´¢åŒ¹é…é¡¹çš„ä½ç½®å’Œæ€»æ•°ï¼Œæ”¯æŒå¢é‡æœç´¢ã€‚
*** ç›¸å…³é“¾æ¥
- GitHub: https://github.com/syohex/evil-anzu

*** é…ç½®
#+begin_src emacs-lisp
(use-package evil-anzu
  :after evil
  :diminish
  :hook (evil-mode . global-anzu-mode))  ;; evil åŠ è½½åå¯ç”¨ï¼Œæ— éœ€ :demand
#+end_src

*** ä½¿ç”¨æ–¹æ³•
- åœ¨ Evil æ¨¡å¼ä¸‹ä½¿ç”¨ =/= å’Œ =?= è¿›è¡Œæœç´¢æ—¶ï¼Œä¼šæ˜¾ç¤ºåŒ¹é…é¡¹è®¡æ•°
- æ”¯æŒå¢é‡æœç´¢ï¼Œå®æ—¶æ›´æ–°åŒ¹é…ç»“æœ

** evil-commentary
*** ä»‹ç»
evil-commentary ä¸º Evil æ¨¡å¼æä¾›å¿«é€Ÿæ³¨é‡Š/åæ³¨é‡ŠåŠŸèƒ½ï¼Œç±»ä¼¼ Vim çš„ commentary.vim æ’ä»¶ã€‚æ”¯æŒæŒ‰è¡Œæ³¨é‡Šã€æŒ‰å—æ³¨é‡Šå’Œè‡ªåŠ¨è¯†åˆ«æ³¨é‡Šç¬¦å·ã€‚

*** ç›¸å…³é“¾æ¥
- GitHub: https://github.com/linktohack/evil-commentary

*** é…ç½®
#+begin_src emacs-lisp
(use-package evil-commentary
  :after evil
  :init
  (evil-commentary-mode))
#+end_src

*** ä½¿ç”¨æ–¹æ³•
- =gcc= : æ³¨é‡Š/åæ³¨é‡Šå½“å‰è¡Œ
- =gc= + åŠ¨ä½œ : æ³¨é‡Šé€‰å®šèŒƒå›´ï¼ˆå¦‚ =gcap= æ³¨é‡Šä¸€ä¸ªæ®µè½ï¼‰
- åœ¨ Visual æ¨¡å¼ä¸‹é€‰ä¸­åæŒ‰ =gc= : æ³¨é‡Šé€‰ä¸­åŒºåŸŸ

** company
*** ä»‹ç»
company (Complete Anything) æ˜¯ä¸€ä¸ªæ¨¡å—åŒ–çš„è‡ªåŠ¨è¡¥å…¨æ¡†æ¶ï¼Œæ”¯æŒå¤šç§åç«¯ï¼ˆLSPã€Yasnippetã€Dabbrev ç­‰ï¼‰ã€‚æä¾›å¼¹å‡ºèœå•ã€å¿«é€Ÿé€‰æ‹©å’Œæ–‡æ¡£é¢„è§ˆã€‚

*** ç›¸å…³é“¾æ¥
- GitHub: https://github.com/company-mode/company-mode
- æ‰‹å†Œ: https://company-mode.github.io/

*** é…ç½®
#+begin_src emacs-lisp
   (use-package company
     :straight t
     :hook (after-init . global-company-mode)
     :config
  ;; è¿™ä¸ªé…ç½®ä¼šåŒæ—¶æ˜¾ç¤º yasnippetã€LSPã€ä»£ç è¯æ±‡ çš„è¡¥å…¨
   (setq company-backends
         '( (company-capf                  ; LSP/å®Œæˆç‚¹
            company-dabbrev-code          ; ä»£ç è¯æ±‡
            company-files)
           (company-abbrev                ; ç¼©å†™ï¼ˆå¤‡ç”¨ï¼‰
            company-dabbrev)))            ; æ–‡æœ¬è¯æ±‡ï¼ˆå¤‡ç”¨ï¼‰
   
   ;; å¯ç”¨ä»¥ä¸‹é€‰é¡¹ä»¥ä¼˜åŒ–å¤šç‚¹è¡¥å…¨ä½“éªŒ
   (setq company-idle-delay 0.2)
   (setq company-minimum-prefix-length 1)
   (setq company-show-quick-access t)
   (setq company-tooltip-align-annotations t)
   
   ;; å…è®¸å¤šä¸ªåç«¯åŒæ—¶è¡¥å…¨
   (setq company-backend-load-all-backends t)
   
   ;; æ˜¾ç¤ºè¡¥å…¨çš„æœ€å¤§é«˜åº¦
   (setq company-tooltip-limit 20)
   
   ;; åœ¨è¡¥å…¨èœå•ä¸­æ˜¾ç¤ºæ‰€æœ‰åç«¯çš„å€™é€‰é¡¹
   (setq company-selection-wrap-around t)
   
     :bind (:map company-active-map
                 ("C-n" . company-select-next)
                 ("C-p" . company-select-previous)
                 ("M-<" . company-select-first)
                 ("M->" . company-select-last)
		 ("C-<tab>" . company-complete-common-or-cycle)
                 ;; ("<tab>" . company-complete-selection)
                 ("RET" . company-complete-selection)))

#+end_src

*** ä½¿ç”¨æ–¹æ³•
- è¾“å…¥æ—¶è‡ªåŠ¨è§¦å‘è¡¥å…¨
- =C-n/C-p= : ä¸Šä¸‹é€‰æ‹©
- =TAB= æˆ– =RET= : ç¡®è®¤é€‰æ‹©
- =M-æ•°å­—= : ç›´æ¥é€‰æ‹©å¯¹åº”ç¼–å·çš„é¡¹

** yasnippet
*** ä»‹ç»
yasnippet æ˜¯ä¸€ä¸ªä»£ç ç‰‡æ®µç³»ç»Ÿï¼Œæ”¯æŒæ•°åƒä¸ªé¢„å®šä¹‰ç‰‡æ®µï¼ˆå¦‚ HTML æ ‡ç­¾ã€å‡½æ•°æ¨¡æ¿ï¼‰ã€‚å…è®¸è‡ªå®šä¹‰ç‰‡æ®µï¼Œæ”¯æŒå ä½ç¬¦å’ŒåŠ¨æ€å†…å®¹ã€‚

*** ç›¸å…³é“¾æ¥
- GitHub: https://github.com/joaotavora/yasnippet
- ç‰‡æ®µé›†åˆ: https://github.com/AndreaCrotti/yasnippet-snippets

*** é…ç½®
#+begin_src emacs-lisp
(use-package yasnippet
  :hook (prog-mode . yas-minor-mode)
  :config
  (yas-global-mode 1))
#+end_src

*** ä½¿ç”¨æ–¹æ³•
- è¾“å…¥ç‰‡æ®µç¼©å†™åæŒ‰ =TAB= å±•å¼€
- ä¾‹å¦‚åœ¨ Python ä¸­è¾“å…¥ =def= ç„¶å =TAB= å±•å¼€ä¸ºå‡½æ•°æ¨¡æ¿
- =C-c & C-n= : åˆ›å»ºæ–°ç‰‡æ®µ
- =C-c & C-v= : è®¿é—®ç‰‡æ®µæ–‡ä»¶

  #+begin_src emacs-lisp
(use-package yasnippet-snippets
  :after yasnippet)
  #+end_src


** undo-fu
*** ä»‹ç»
undo-fu æä¾›ç®€å•ã€çº¿æ€§çš„æ’¤é”€/é‡åšç³»ç»Ÿï¼Œæ›¿ä»£ Emacs å¤æ‚çš„é»˜è®¤ undo æœºåˆ¶ã€‚ç‰¹åˆ«é€‚åˆ Evil æ¨¡å¼ç”¨æˆ·ï¼Œæä¾›ç±»ä¼¼ Vim çš„ undo/redo ä½“éªŒã€‚

*** ç›¸å…³é“¾æ¥
- GitHub: https://codeberg.org/ideasman42/emacs-undo-fu
- GitLab é•œåƒ: https://gitlab.com/ideasman42/emacs-undo-fu

*** é…ç½®
#+begin_src emacs-lisp
  (use-package undo-fu
    :straight t
    :demand t
    :config
    ;; ç¡®ä¿ evil èƒ½æ‰¾åˆ° undo-fu çš„å‡½æ•°
    (global-unset-key (kbd "C-z"))

    ;; ä½¿ç”¨å†…ç½®çš„ undo æŒä¹…åŒ–ï¼ˆéœ€è¦ Emacs 28+ï¼‰
    (setq undo-no-redo t)
    ;; å¢å¤§ undo é™åˆ¶
    (setq undo-limit 67108864) ; 64mb
    (setq undo-strong-limit 100663296) ; 96mb
    (setq undo-outer-limit 1006632960)) ; 960mb
#+end_src

*** ä½¿ç”¨æ–¹æ³•
- åœ¨ Evil æ¨¡å¼ä¸‹ï¼š=u= æ’¤é”€ï¼Œ=C-r= é‡åš
- æä¾›çº¿æ€§çš„æ’¤é”€å†å²ï¼Œé¿å… Emacs é»˜è®¤çš„æ ‘çŠ¶ç»“æ„å¸¦æ¥çš„å›°æƒ‘



** undo-fu-session
*** ä»‹ç»
undo-fu-session æä¾›ç®€å•å¯é çš„ undo å†å²æŒä¹…åŒ–åŠŸèƒ½ã€‚ä¸ undohist ä¸åŒï¼Œå®ƒæ›´åŠ è½»é‡çº§ä¸”ç¨³å®šï¼Œèƒ½å¤Ÿåœ¨æ–‡ä»¶å…³é—­åä¿å­˜ undo å†å²ï¼Œé‡æ–°æ‰“å¼€æ—¶è‡ªåŠ¨æ¢å¤ã€‚

*** ç›¸å…³é“¾æ¥
- GitHub: https://github.com/emacsmirror/undo-fu-session

*** é…ç½®
#+begin_src emacs-lisp
(use-package undo-fu-session
  :after undo-fu
  :hook (after-init . global-undo-fu-session-mode)
  :config
  ;; è®¾ç½®ä¼šè¯ä¿å­˜ç›®å½•
  (setq undo-fu-session-directory 
        (expand-file-name "undo-fu-session/" user-emacs-directory))
  
  ;; å¿½ç•¥æŸäº›æ–‡ä»¶çš„æ’¤é”€å†å²
  (setq undo-fu-session-incompatible-files
        '("/tmp/" "/dev/shm/" "COMMIT_EDITMSG" ".gpg$"))
  
  ;; æ˜¾ç¤º undo-fu-session çš„æ—¥å¿—ä¿¡æ¯
  (setq undo-fu-session-linear nil))
#+end_src

*** ä½¿ç”¨æ–¹æ³•
- è‡ªåŠ¨ä¿å­˜å’Œæ¢å¤æ’¤é”€å†å²ï¼Œæ— éœ€æ‰‹åŠ¨æ“ä½œ
- æ’¤é”€å†å²ä¿å­˜åœ¨ `~/.emacs.d/undo-fu-session/` ç›®å½•
- ä¸ undo-fu å®Œå…¨å…¼å®¹




** vundo
*** ä»‹ç»
vundo æä¾›å¯è§†åŒ–çš„æ’¤é”€æ ‘æµè§ˆå™¨ï¼Œè®©ä½ èƒ½çœ‹åˆ°å®Œæ•´çš„ç¼–è¾‘å†å²åˆ†æ”¯ã€‚å¯ä»¥åœ¨æ’¤é”€æ ‘ä¸­è‡ªç”±å¯¼èˆªï¼Œæ¢å¤ä»»æ„å†å²çŠ¶æ€ï¼Œéå¸¸é€‚åˆéœ€è¦æ¢ç´¢ä¸åŒç¼–è¾‘è·¯å¾„çš„åœºæ™¯ã€‚

*** ç›¸å…³é“¾æ¥
- GitHub: https://github.com/casouri/vundo

*** é…ç½®
#+begin_src emacs-lisp
(use-package vundo
  :commands (vundo)
  :config
  (setq vundo-compact-display t))
#+end_src

*** ä½¿ç”¨æ–¹æ³•
- =M-x vundo= : æ‰“å¼€å¯è§†åŒ–æ’¤é”€æ ‘
- åœ¨ vundo ç•Œé¢ä¸­ï¼š=n/p= å‰åå¯¼èˆªï¼Œ=q= é€€å‡ºï¼Œ=RET= åº”ç”¨é€‰ä¸­çš„çŠ¶æ€



** smartparens
*** ä»‹ç»
smartparens æä¾›æ™ºèƒ½çš„æ‹¬å·é…å¯¹ã€è‡ªåŠ¨è¡¥å…¨å’Œå¯¼èˆªåŠŸèƒ½ã€‚è‡ªåŠ¨æ’å…¥ã€åˆ é™¤æˆå¯¹çš„æ‹¬å·ã€å¼•å·ç­‰ç¬¦å·ï¼Œæ”¯æŒè·³è¿‡å’ŒåŒ…è£¹é€‰åŒºï¼Œå¤§å¹…æå‡ç¼–ç æ•ˆç‡ã€‚

** ç›¸å…³é“¾æ¥
- GitHub: https://github.com/Fuco1/smartparens

*** é…ç½®
#+begin_src emacs-lisp
(use-package smartparens
  :hook (after-init . smartparens-global-mode)  ; å…¨å±€å¯ç”¨
  :config
  (require 'smartparens-config)
  (setq sp-autoskip-closing-pair 'always))
#+end_src



*** ä½¿ç”¨æ–¹æ³•
- è¾“å…¥å·¦æ‹¬å·è‡ªåŠ¨è¡¥å…¨å³æ‹¬å·
- åˆ é™¤å·¦æ‹¬å·æ—¶è‡ªåŠ¨åˆ é™¤é…å¯¹çš„å³æ‹¬å·
- å…‰æ ‡ä½äºå³æ‹¬å·å‰æ—¶è‡ªåŠ¨è·³è¿‡



** evil-surround
*** ä»‹ç»
evil-surround æ˜¯ Vim surround.vim çš„ Emacs ç§»æ¤ï¼Œç”¨äºå¿«é€Ÿæ·»åŠ ã€ä¿®æ”¹ã€åˆ é™¤æˆå¯¹ç¬¦å·ï¼ˆæ‹¬å·ã€å¼•å·ã€æ ‡ç­¾ç­‰ï¼‰ã€‚æå¤§ç®€åŒ–äº†å¤„ç†æ–‡æœ¬å‘¨å›´å­—ç¬¦çš„æ“ä½œã€‚

*** ç›¸å…³é“¾æ¥
- GitHub: https://github.com/emacs-evil/evil-surround

*** é…ç½®
#+begin_src emacs-lisp
(use-package evil-surround
  :after evil
  :config
  ;; å¯ç”¨å…¨å±€ evil-surround æ¨¡å¼
  (global-evil-surround-mode 1))
#+end_src

*** ä½¿ç”¨æ–¹æ³•
- =ys<motion><char>= : æ·»åŠ å‘¨å›´ç¬¦å·ï¼ˆå¦‚ =ysiw"= ç»™å•è¯åŠ åŒå¼•å·ï¼‰
- =cs<old><new>= : ä¿®æ”¹å‘¨å›´ç¬¦å·ï¼ˆå¦‚ =cs"'= å°†åŒå¼•å·æ”¹ä¸ºå•å¼•å·ï¼‰
- =ds<char>= : åˆ é™¤å‘¨å›´ç¬¦å·ï¼ˆå¦‚ =ds"= åˆ é™¤åŒå¼•å·ï¼‰
- åœ¨ Visual æ¨¡å¼ä¸‹ =S<char>= : ç»™é€‰ä¸­æ–‡æœ¬æ·»åŠ å‘¨å›´ç¬¦å·


** expand-region
*** ä»‹ç»
expand-region æä¾›æ™ºèƒ½çš„åŒºåŸŸæ‰©å±•åŠŸèƒ½ï¼Œæ ¹æ®è¯­æ³•ç»“æ„é€æ­¥æ‰©å¤§é€‰åŒºèŒƒå›´ã€‚ä»å…‰æ ‡ä½ç½®å¼€å§‹ï¼Œä¾æ¬¡é€‰æ‹©å•è¯ã€å¥å­ã€æ®µè½ã€å‡½æ•°ç­‰ï¼Œéå¸¸é€‚åˆå¿«é€Ÿé€‰æ‹©ä»£ç å—ã€‚

*** ç›¸å…³é“¾æ¥
- GitHub: https://github.com/magnars/expand-region.el

*** é…ç½®
#+begin_src emacs-lisp
  (use-package expand-region
  :bind ("C-SPC" . er/expand-region))
#+end_src

*** ä½¿ç”¨æ–¹æ³•
- =C-== : æ‰©å¤§é€‰åŒºï¼ˆè¿ç»­æŒ‰å¤šæ¬¡é€æ­¥æ‰©å¤§ï¼‰
- =C-- C-== : ç¼©å°é€‰åŒº





** evil-fringe-mark
*** ä»‹ç»
evil-fringe-mark åœ¨ç¼–è¾‘å™¨è¾¹ç¼˜ï¼ˆfringeï¼‰æ˜¾ç¤º Evil çš„æ ‡è®°ï¼ˆmarksï¼‰ï¼Œè®©æ ‡è®°ä½ç½®ä¸€ç›®äº†ç„¶ã€‚æ”¯æŒæ˜¾ç¤ºæ™®é€šæ ‡è®°å’Œç‰¹æ®Šæ ‡è®°ï¼Œæ–¹ä¾¿åœ¨å¤§æ–‡ä»¶ä¸­å¿«é€Ÿå®šä½ã€‚

*** ç›¸å…³é“¾æ¥
- GitHub: https://github.com/Andrew-William-Smith/evil-fringe-mark

*** é…ç½®
#+begin_src emacs-lisp
  (use-package evil-fringe-mark
    :after evil
    :config
    ;; æ–¹æ¡ˆ 1ï¼ševil æ ‡è®°åœ¨å³ fringeï¼Œbookmark åœ¨å·¦ fringe
;; å¢åŠ å·¦ fringe å®½åº¦ï¼Œç»™ bookmark å›¾æ ‡æ›´å¤šç©ºé—´
(setq-default left-fringe-width 40)
    (setq-default evil-fringe-mark-side 'right-fringe)

    ;; å¯é€‰ï¼šè°ƒæ•´ evil æ ‡è®°çš„æ ·å¼
    (setq-default evil-fringe-mark-show-special t)  ;; æ˜¾ç¤ºç‰¹æ®Šæ ‡è®°
    (global-evil-fringe-mark-mode))
#+end_src

*** ä½¿ç”¨æ–¹æ³•
- =m<letter>= : è®¾ç½®æ ‡è®°ï¼ˆå¦‚ =ma= è®¾ç½®æ ‡è®° aï¼‰
- ='<letter>= : è·³è½¬åˆ°æ ‡è®°ï¼ˆå¦‚ ='a= è·³è½¬åˆ°æ ‡è®° aï¼‰
- æ ‡è®°ä¼šåœ¨ fringe æ˜¾ç¤ºä¸ºå¯è§†åŒ–æŒ‡ç¤ºç¬¦






* å¯¼èˆªä¸æœç´¢

å¢å¼ºæ–‡ä»¶å’Œå†…å®¹çš„æŸ¥æ‰¾ã€å¯¼èˆªèƒ½åŠ›ã€‚

** vertico
*** ä»‹ç»
vertico æ˜¯ä¸€ä¸ªæç®€ã€é«˜æ€§èƒ½çš„å‚ç›´è¡¥å…¨ UIï¼ŒåŸºäº Emacs å†…ç½®è¡¥å…¨ç³»ç»Ÿã€‚æ”¯æŒå¾ªç¯å¯¼èˆªã€å†å²æ’åºï¼Œä¸ orderlessã€marginalia å®Œç¾é›†æˆã€‚

*** ç›¸å…³é“¾æ¥
- GitHub: https://github.com/minad/vertico

*** é…ç½®
#+begin_src emacs-lisp
(use-package vertico
  :hook (after-init . vertico-mode)
  :custom
  (vertico-scroll-margin 0)  ; æ»šåŠ¨è¾¹è·
  (vertico-count 20)         ; æ˜¾ç¤º 20 ä¸ªå€™é€‰é¡¹
  (vertico-resize t)         ; è‡ªåŠ¨è°ƒæ•´å¤§å°
  (vertico-cycle t))         ; å¾ªç¯å¯¼èˆª
#+end_src

*** ä½¿ç”¨æ–¹æ³•
- =M-x= : å‘½ä»¤è¡¥å…¨
- =C-x C-f= : æ–‡ä»¶æŸ¥æ‰¾
- =C-n/C-p= : ä¸Šä¸‹å¯¼èˆª
- =RET= : ç¡®è®¤é€‰æ‹©

** savehist
*** ä»‹ç»
ä¿å­˜ minibuffer å†å²è®°å½•ï¼Œè®©è¡¥å…¨ç³»ç»Ÿèƒ½æŒ‰å†å²é¢‘ç‡æ’åºç»“æœã€‚

*** é…ç½®
#+begin_src emacs-lisp
(use-package savehist
  :straight nil  ; å†…ç½®åŒ…
  :init
  (savehist-mode))
#+end_src

** emacs (minibuffer é…ç½®)
*** é…ç½®
#+begin_src emacs-lisp
(use-package emacs
  :straight nil
  :custom
  (context-menu-mode t)                    ; å¯ç”¨ä¸Šä¸‹æ–‡èœå•
  (enable-recursive-minibuffers t)         ; å…è®¸é€’å½’ minibuffer
  (read-extended-command-predicate 
   #'command-completion-default-include-p) ; åªæ˜¾ç¤ºå¯ç”¨å‘½ä»¤
  (minibuffer-prompt-properties
   '(read-only t cursor-intangible t face minibuffer-prompt)))
#+end_src

** orderless
*** ä»‹ç»
orderless æä¾›æ— åºã€çµæ´»çš„è¡¥å…¨é£æ ¼ï¼Œæ”¯æŒç©ºæ ¼åˆ†éš”çš„å¤šè¯åŒ¹é…ã€‚ä¾‹å¦‚æœç´¢ "buf list" å¯ä»¥åŒ¹é… "list-buffers"ã€‚

*** ç›¸å…³é“¾æ¥
- GitHub: https://github.com/oantolin/orderless

*** é…ç½®
#+begin_src emacs-lisp
(use-package orderless
  :custom
  (completion-styles '(orderless basic))
  (completion-category-overrides '((file (styles partial-completion))))
  (completion-category-defaults nil)
  (completion-pcm-leading-wildcard t))
#+end_src

*** ä½¿ç”¨æ–¹æ³•
- åœ¨ä»»ä½•è¡¥å…¨ç•Œé¢è¾“å…¥ç©ºæ ¼åˆ†éš”çš„å…³é”®è¯å³å¯æ¨¡ç³ŠåŒ¹é…

** marginalia
*** ä»‹ç»
åœ¨è¡¥å…¨å€™é€‰é¡¹æ—æ·»åŠ æ³¨è§£ï¼Œå¦‚æ–‡ä»¶å¤§å°ã€å‘½ä»¤æè¿°ã€å˜é‡å€¼ç­‰ï¼Œæä¾›æ›´ä¸°å¯Œçš„ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚

*** ç›¸å…³é“¾æ¥
- GitHub: https://github.com/minad/marginalia

*** é…ç½®
#+begin_src emacs-lisp
(use-package marginalia
  :init
  (marginalia-mode t))
#+end_src

  
** hl-todo
*** ä»‹ç»
hl-todo é«˜äº®ä»£ç ä¸­çš„ TODOã€FIXMEã€NOTE ç­‰å…³é”®è¯ï¼Œå¸®åŠ©ä½ å¿«é€Ÿè¯†åˆ«ä»£ç ä¸­çš„å¾…åŠäº‹é¡¹å’Œæ³¨é‡Šæ ‡è®°ã€‚æ”¯æŒè‡ªå®šä¹‰å…³é”®è¯å’Œé¢œè‰²ã€‚

*** ç›¸å…³é“¾æ¥
- GitHub: https://github.com/tarsius/hl-todo

*** é…ç½®
#+begin_src emacs-lisp
(use-package hl-todo
  :hook (prog-mode . hl-todo-mode)
  :custom
  (hl-todo-highlight-punctuation ":"))
#+end_src

*** ä½¿ç”¨æ–¹æ³•
- åœ¨ä»£ç æ³¨é‡Šä¸­ä½¿ç”¨ =TODO:=ã€=FIXME:=ã€=NOTE:= ç­‰å…³é”®è¯
- ä½¿ç”¨é”®ç»‘å®š =[ t= å’Œ =] t= åœ¨ TODO ä¹‹é—´è·³è½¬


** consult-todo
*** ä»‹ç»
consult-todo é›†æˆ hl-todo ä¸ consultï¼Œæä¾›å¿«é€Ÿæœç´¢å’Œå¯¼èˆªé¡¹ç›®ä¸­æ‰€æœ‰ TODO æ ‡è®°çš„åŠŸèƒ½ã€‚æ”¯æŒé¢„è§ˆå’Œè¿‡æ»¤ï¼Œæ–¹ä¾¿ç®¡ç†å¤§å‹é¡¹ç›®çš„å¾…åŠäº‹é¡¹ã€‚

*** ç›¸å…³é“¾æ¥
- GitHub: https://github.com/liuyinz/consult-todo

*** é…ç½®
#+begin_src emacs-lisp
  (use-package consult-todo
  :commands (consult-todo consult-todo-project))
#+end_src

*** ä½¿ç”¨æ–¹æ³•
- =SPC s t= : æœç´¢å½“å‰ç¼“å†²åŒºçš„ TODO
- =SPC s T= : æœç´¢æ•´ä¸ªé¡¹ç›®çš„ TODO


** embark
*** ä»‹ç»
embark æä¾›ä¸Šä¸‹æ–‡åŠ¨ä½œèœå•ï¼Œå¯¹é€‰ä¸­çš„æ–‡æœ¬ã€æ–‡ä»¶æˆ–ç¬¦å·æ‰§è¡Œå„ç§æ“ä½œã€‚ç±»ä¼¼å³é”®èœå•ï¼Œä½†æ›´å¼ºå¤§ã€‚

*** ç›¸å…³é“¾æ¥
- GitHub: https://github.com/oantolin/embark

*** é…ç½®
#+begin_src emacs-lisp
(use-package embark
  :bind
  (("C-;" . embark-act)
   ;; ("C-;" . embark-dwim)
   ("C-h B" . embark-bindings))
  :config
  (setq prefix-help-command 'embark-prefix-help-command))
#+end_src



*** ä½¿ç”¨æ–¹æ³•
- =C-.= : åœ¨å…‰æ ‡å¤„æ˜¾ç¤ºåŠ¨ä½œèœå•
- é€‰æ‹©æ–‡ä»¶åæŒ‰ =C-.= å¯ä»¥å¤åˆ¶ã€åˆ é™¤ã€é‡å‘½åç­‰

** wgrep
*** ä»‹ç»
wgrep å…è®¸ä½ ç›´æ¥åœ¨ grep/rgrep/ag çš„æœç´¢ç»“æœä¸­ç¼–è¾‘æ–‡æœ¬ï¼Œç¼–è¾‘ä¼šåŒæ­¥åˆ°æºæ–‡ä»¶ã€‚é…åˆ consult-ripgrep ç­‰æœç´¢å·¥å…·ä½¿ç”¨éå¸¸å¼ºå¤§ã€‚

*** ç›¸å…³é“¾æ¥
- GitHub: https://github.com/mhayashi1120/Emacs-wgrep

*** é…ç½®
#+begin_src emacs-lisp
(use-package wgrep
  :config
  (setq wgrep-change-readonly-file t)
  (setq wgrep-enable-key "e"))
(add-hook 'grep-mode-hook 'wgrep-setup)
#+end_src

*** ä½¿ç”¨æ–¹æ³•
- åœ¨æœç´¢ç»“æœ buffer ä¸­æŒ‰ =e= è¿›å…¥ç¼–è¾‘æ¨¡å¼
- ç›´æ¥ä¿®æ”¹æœç´¢ç»“æœ
- =C-c C-c= : åº”ç”¨ä¿®æ”¹åˆ°æ‰€æœ‰æ–‡ä»¶
- =C-c C-k= : å–æ¶ˆä¿®æ”¹

** consult
*** ä»‹ç»
consult æ˜¯ä¸€ä¸ªå¼ºå¤§çš„è¡¥å…¨å’Œå¯¼èˆªå·¥å…·ï¼Œæä¾›æ–‡ä»¶æŸ¥æ‰¾ã€buffer åˆ‡æ¢ã€å‘½ä»¤æ‰§è¡Œç­‰åŠŸèƒ½ã€‚ä¸ verticoã€orderlessã€marginalia å®Œç¾é›†æˆã€‚
*** ç›¸å…³é“¾æ¥
- GitHub: https://github.com/minad/consult
*** é…ç½®

#+begin_src emacs-lisp
(use-package consult
  :config
  ;; ç”¨ consult æ›¿æ¢é»˜è®¤çš„ xref æ˜¾ç¤º
  (setq xref-show-xrefs-function #'consult-xref
        xref-show-definitions-function #'consult-xref)
  ;; === æ­£å¸¸ buffer ===
  (defvar my/consult--source-normal-buffer
    (list :name     "Buffers"  ; åˆ†éš”çº¿æ ·å¼
          :narrow   ?b
          :category 'buffer
          :face     'consult-buffer
          :history  'buffer-name-history
          :state    #'consult--buffer-state
          :default  t
          :items
          (lambda ()
            (consult--buffer-query
             :sort 'visibility
             :as #'buffer-name
             :predicate
             (lambda (buf)
               (not (string-prefix-p "*" (buffer-name buf))))))))

  ;; === ç³»ç»Ÿ buffer ===
  (defvar my/consult--source-system-buffer
    (list :name     "System"
          :narrow   ?*
          :category 'buffer
          :face     'font-lock-comment-face
          :history  'buffer-name-history
          :state    #'consult--buffer-state
          :items
          (lambda ()
            (consult--buffer-query
             :sort 'visibility
             :as #'buffer-name
             :predicate
             (lambda (buf)
               (string-prefix-p "*" (buffer-name buf)))))))

  (setq consult-buffer-sources
        '(my/consult--source-normal-buffer
          my/consult--source-system-buffer
          consult--source-recent-file
          consult--source-bookmark)))
#+end_src


*** ä½¿ç”¨æ–¹æ³•
- =SPC SPC= : åˆ‡æ¢ buffer
- =SPC f f= : æŸ¥æ‰¾æ–‡ä»¶
- =SPC s g= : å…¨å±€æœç´¢
- =M-x= : å‘½ä»¤è¡¥å…¨

** embark-consult
*** ä»‹ç»
embark ä¸ consult çš„é›†æˆåŒ…ï¼Œæä¾›æ›´å¥½çš„ååŒä½“éªŒã€‚

*** é…ç½®
#+begin_src emacs-lisp
(use-package embark-consult
  :after (embark consult)
  :hook (embark-collect-mode . consult-preview-at-point-mode))
#+end_src


** windmove
*** ä»‹ç»
ä½¿ç”¨æ–¹å‘é”®æˆ–å¿«æ·é”®åœ¨çª—å£é—´å¿«é€Ÿåˆ‡æ¢ç„¦ç‚¹ã€‚

*** é…ç½®
#+begin_src emacs-lisp
(use-package windmove
  :straight nil)  ; å†…ç½®åŒ…
#+end_src

*** ä½¿ç”¨æ–¹æ³•
- =C-h/j/k/l= : Vim é£æ ¼çš„çª—å£åˆ‡æ¢ï¼ˆéœ€é…ç½®é”®ç»‘å®šï¼‰



** projectile
*** ä»‹ç»
projectile æ˜¯å¼ºå¤§çš„é¡¹ç›®ç®¡ç†å·¥å…·ï¼Œè‡ªåŠ¨è¯†åˆ«å’Œç®¡ç† Gitã€Mavenã€NPM ç­‰é¡¹ç›®ã€‚æä¾›é¡¹ç›®å†…æ–‡ä»¶æœç´¢ã€ç¼–è¯‘ã€æµ‹è¯•ç­‰åŠŸèƒ½ï¼Œæ”¯æŒé¡¹ç›®é—´å¿«é€Ÿåˆ‡æ¢ã€‚

*** ç›¸å…³é“¾æ¥
- GitHub: https://github.com/bbatsov/projectile
- æ–‡æ¡£: https://docs.projectile.mx/

*** é…ç½®
#+begin_src emacs-lisp :tangle yes
  (use-package projectile
    :straight t
    :hook (after-init . projectile-mode)
    :config
    (setq projectile-completion-system 'default))
#+end_src

*** ä½¿ç”¨æ–¹æ³•
- =SPC f p= : åœ¨é¡¹ç›®ä¸­æŸ¥æ‰¾æ–‡ä»¶
- =SPC f P= : åˆ‡æ¢é¡¹ç›®
- =SPC f d= : åœ¨é¡¹ç›®ä¸­æŸ¥æ‰¾ç›®å½•
- è‡ªåŠ¨è¯†åˆ«é¡¹ç›®æ ¹ç›®å½•ï¼ˆåŒ…å« .gitã€package.json ç­‰ï¼‰



** avy
*** ä»‹ç»
avy æä¾›åŸºäºå­—ç¬¦çš„å¿«é€Ÿè·³è½¬åŠŸèƒ½ï¼Œç±»ä¼¼ Vim çš„ EasyMotionã€‚è¾“å…¥ä¸€ä¸ªæˆ–å¤šä¸ªå­—ç¬¦åï¼Œavy ä¼šåœ¨æ‰€æœ‰åŒ¹é…ä½ç½®æ˜¾ç¤ºæç¤ºæ ‡è®°ï¼Œè¾“å…¥æ ‡è®°å³å¯è·³è½¬ã€‚

*** ç›¸å…³é“¾æ¥
- GitHub: https://github.com/abo-abo/avy

*** é…ç½®
#+begin_src emacs-lisp
(use-package avy
  :commands (avy-goto-char avy-goto-char-2 avy-goto-word-1 avy-goto-line)
  :config
  (setq avy-style 'at-full)
  (setq avy-all-windows t))
#+end_src

*** ä½¿ç”¨æ–¹æ³•
- =s= : è·³è½¬åˆ°å­—ç¬¦ï¼ˆavy-goto-charï¼‰
- =S= : è·³è½¬åˆ°å•è¯ï¼ˆavy-goto-word-1ï¼‰
- è¾“å…¥å­—ç¬¦åï¼Œå†è¾“å…¥é«˜äº®çš„æ ‡è®°å­—æ¯å³å¯è·³è½¬


* é”®ä½ç»‘å®š

è‡ªå®šä¹‰çš„é”®ä½ç»‘å®šé…ç½®ï¼Œä¸»è¦åŸºäº Evil æ¨¡å¼ã€‚
* Evil é”®ä½é…ç½®
#+begin_src emacs-lisp
(use-package general
  :config
  
  ;; ==================== åˆ›å»º Definer ====================
  
  ;; å…¨å±€ Leader key (SPC)
  (general-create-definer global-leader
    :states '(normal visual insert emacs)
    :prefix "SPC"
    :non-normal-prefix "C-SPC")
  
  ;; Normal æ¨¡å¼ä¸“ç”¨
  (general-create-definer normal-leader
    :states 'normal
    :prefix "SPC")
  
  ;; Visual æ¨¡å¼ä¸“ç”¨
  (general-create-definer visual-leader
    :states 'visual
    :prefix "SPC")
  
  ;; ==================== Normal æ¨¡å¼é”®ç»‘å®š ====================
  
  ;; å…¨å±€ Normal æ¨¡å¼é”®ï¼ˆä¸å¸¦ SPC å‰ç¼€ï¼‰
  (general-define-key
   :states 'normal
   "u" 'undo-only
   "C-r" 'undo-fu-only-redo
   "s" 'avy-goto-char-timer
   "S" 'avy-goto-word-1
   "B" 'blamer-show-commit-info
   "K" 'lsp-ui-doc-glance
   "H" 'centaur-tabs-backward-tab
   "L" 'centaur-tabs-forward-tab
   
   ;; çª—å£å¯¼èˆª
   "C-h" 'evil-window-left
   "C-j" 'evil-window-down
   "C-k" 'evil-window-up
   "C-l" 'evil-window-right
   "C-s" 'save-buffer
   "C-/" 'toggle-eat
   
   ;; LSP goto
   "g d" 'lsp-goto-type-definition
   "g r" 'lsp-ui-peek-find-references
   "g i" 'lsp-find-implementation
   "g s d" 'evil-surround-delete
   "g s r" 'evil-surround-change
   
   ;; Diagnostics navigation
   "[ d" 'flymake-goto-prev-error
   "] d" 'flymake-goto-next-error
   "[ t" 'hl-todo-previous
   "] t" 'hl-todo-next)
  
  ;; å¸¦ SPC å‰ç¼€çš„ Normal æ¨¡å¼é”®
  (normal-leader
    ;; å¿«é€Ÿè®¿é—®
    "SPC" 'consult-buffer
    
    ;; Org (o)
    "o" '(:ignore t :which-key "org")
    "op" 'org-latex-preview
    
    ;; Git (g)
    "g" '(:ignore t :which-key "git")
    "gg" 'magit
    "gd" 'magit-diff
    "gi" 'magit-info
    "gl" 'magit-log
    "gc" 'gptel-commit
    
    ;; AI (a & c)
    "a" '(:ignore t :which-key "ai")
    "ad" 'gptel-add
    "aa" 'gptel
    "am" 'gptel-menu
    "at" 'gptel-tools
    
    "c" '(:ignore t :which-key "code/ai")
    "ce" 'toggle-copilot-mode
    "ca" 'claude-code-ide
    "ct" 'claude-code-ide-stop
    "cr" 'claude-code-ide-resume
    "cc" 'claude-code-continue
    "cs" 'my/toggle-lsp-ui-imenu
    "cf" 'lsp-format-buffer
    "ca" 'lsp-execute-code-action
    "cr" 'lsp-rename
    "ci" 'describe-mode
    "cp" 'copy-file-path

    "ot" 'org-todo
    "oa" 'org-agenda
    "oc" 'org-capture
    "oT" 'org-tags-view
    
    ;; File (f)
    "f" '(:ignore t :which-key "file")
    "ff" 'find-file
    "fg" 'consult-fd
    "fn" 'consult-notes
    "fz" 'consult-dir
    "ft" 'centaur-tabs-switch-group
    "fd" 'project-find-dir
    "fp" 'project-find-file
    "fP" 'project-switch-project
    "fr" 'consult-recent-file
    
    ;; Buffer (b)
    "b" '(:ignore t :which-key "buffer")
    "bd" 'evil-delete-buffer
    
    ;; Window (w)
    "w" '(:ignore t :which-key "window")
    "-" 'split-window-below
    "|" 'split-window-right
    "wd" 'delete-window
    "wk" 'enlarge-window
    "wj" 'shrink-window
    "wl" 'enlarge-window-horizontally
    "wh" 'shrink-window-horizontally
    
    ;; File tree (e)
    "e" 'neotree-toggle
    "d" 'dirvish
    
    ;; Image (i)
    "i" '(:ignore t :which-key "image")
    "ip" 'org-download-clipboard
    "id" 'org-download-delete
    
    ;; Bookmark (m)
    "m" '(:ignore t :which-key "bookmark")
    "ms" 'bookmark-set
    "mj" 'bookmark-jump
    "md" 'bookmark-delete
    
    ;; Search (s)
    "s" '(:ignore t :which-key "search")
    "sf" 'describe-function
    "se" 'consult-flymake
    "sy" 'consult-yank-pop
    "sk" 'embark-bindings
    "st" 'hl-todo-occur
    "sT" 'hl-todo-rgrep
    "sb" 'consult-line
    "sg" 'consult-ripgrep
    "sG" 'consult-git-grep
    "sn" 'yas-visit-snippet-file
    "sm" 'consult-bookmark
    "sh" 'helpful-at-point
    "sS" 'imenu
    "ss" 'consult-imenu
    
    ;; Diagnostics (x)
    "x" '(:ignore t :which-key "diagnostics")
    "xx" 'lsp-treemacs-errors-list
    
    ;; Quit (q)
    "q" '(:ignore t :which-key "quit")
    "qq" 'save-buffers-kill-terminal
    "qQ" 'save-buffers-kill-emacs)
  
  ;; ==================== Visual æ¨¡å¼é”®ç»‘å®š ====================
  
  (general-define-key
   :states 'visual
   "C-l" 'evil-end-of-line
   "C-h" 'evil-beginning-of-line
   "g s a" 'evil-surround-region)
  
  (visual-leader
    ;; AI
    "a" '(:ignore t :which-key "ai")
    "ar" 'gptel-rewrite
    "ad" 'gptel-add
    "aa" 'gptel
    "am" 'gptel-menu
    "at" 'gptel-tools)
  
  ;; ==================== Insert æ¨¡å¼é”®ç»‘å®š ====================
  
  (general-define-key
   :states 'insert
   "C-/" 'toggle-eat
   "C-h" 'backward-char
   "C-l" 'forward-char
   "TAB" 'smart-tab)
  
  ;; ==================== PDF View æ¨¡å¼ ====================
  
  (general-define-key
   :keymaps 'pdf-view-mode-map
   "C-c C-t" 'pdf-toggle-colors)
  
  ;; ==================== Neotree æ¨¡å¼ ====================
  
  (defun my/neotree-collapse-or-up ()
    "æŠ˜å å½“å‰ç›®å½•æˆ–è¿›å…¥ä¸Šçº§ç›®å½•."
    (interactive)
    (let ((node (neo-buffer--get-filename-current-line)))
      (cond
       ;; å½“å‰èŠ‚ç‚¹æ˜¯ç›®å½•å¹¶å·²å±•å¼€ â†’ æŠ˜å 
       ((and node (file-directory-p node)
             (neo-buffer--expanded-node-p node))
        (neo-buffer--set-expand node nil)
        (neo-buffer--refresh t))
       ;; å¦åˆ™å›åˆ°ä¸Šçº§ç›®å½•
       (t (neotree-select-up-node)))))
  
  (defun my/neotree-open-or-expand ()
    "æ‰“å¼€æ–‡ä»¶æˆ–å±•å¼€ç›®å½•."
    (interactive)
    (let ((node (neo-buffer--get-filename-current-line)))
      (when node
        (if (file-directory-p node)
            (progn
              (neo-buffer--set-expand node t)
              (neo-buffer--refresh t)
              (neotree-next-line))
          (neotree-enter)))))
  
  (with-eval-after-load 'neotree
  (general-define-key
   :states 'normal
   :keymaps 'neotree-mode-map
   "h" 'my/neotree-collapse-or-up
   "l" 'my/neotree-open-or-expand
   "q" 'neotree-toggle
   "a" 'neotree-create-node
   "d" 'neotree-delete-node
   "r" 'neotree-rename-node
   "o" 'dired-jump
   "y" 'neotree-copy-node
   "RET" 'neotree-enter)))

;; ==================== Dirvish æ¨¡å¼ ====================

(with-eval-after-load 'dirvish
  (general-define-key
   :states 'normal
   :keymaps 'dirvish-mode-map
   "h" 'dired-up-directory
   "l" 'dired-find-file
   "j" 'dired-next-line
   "k" 'dired-previous-line
   "q" 'dirvish-quit
   "Q" 'kill-current-buffer
   "zh" 'dired-omit-mode
   "TAB" 'dirvish-subtree-toggle
   "gg" 'beginning-of-buffer
   "G" 'end-of-buffer
   "RET" 'dired-find-file))
#+end_src




* æ–‡æ¡£ç¼–å†™

Org-mode å’Œ LaTeX ç›¸å…³é…ç½®ã€‚

** org
*** ä»‹ç»
org-mode æ˜¯ Emacs çš„æ€æ‰‹çº§åŠŸèƒ½ï¼Œç”¨äºç¬”è®°ã€å¾…åŠäº‹é¡¹ã€æ–‡æ¡£ç¼–å†™ã€æ–‡å­¦ç¼–ç¨‹ç­‰ã€‚æ”¯æŒå¯¼å‡ºä¸º PDFã€HTMLã€Markdown ç­‰å¤šç§æ ¼å¼ã€‚

*** ç›¸å…³é“¾æ¥
- å®˜ç½‘: https://orgmode.org/
- æ‰‹å†Œ: https://orgmode.org/manual/

*** é…ç½®
#+begin_src emacs-lisp
(use-package org
  :mode ("\\.org\\'" . org-mode)
  :bind (("C-c a" . org-agenda)
         ("C-c c" . org-capture)
         ("C-c l" . org-store-link))
  :config
  ;; åŸºç¡€è®¾ç½®
  (setq org-directory "~/.emacs.d/org/"
        org-agenda-files '("~/.emacs.d/org/")  ; æ‰«ææ•´ä¸ª org ç›®å½•
        org-startup-indented t
        org-hide-emphasis-markers t
        org-startup-with-inline-images t
        org-image-align 'center
        org-image-actual-width '(800))
  
  ;; TODO é…ç½®
(setq org-todo-keywords
      '((sequence "TODO(t)" "DOING(i)" "WAITING(w)" "Buy(b)" "Plan(p)" "Book(k)"
                  "|" "DONE(d)" "CANCELLED(c)")))

(setq org-todo-keyword-faces
      '(("TODO" . (:foreground "#ff6c6b" :weight bold))
        ("DOING" . (:foreground "#ECBE7B" :weight bold))
        ("WAITING" . (:foreground "#da8548" :weight bold))
        ("DONE" . (:foreground "#98be65" :weight bold))
        ("CANCELLED" . (:foreground "#5B6268" :weight bold))
        ("Buy" . (:foreground "#51afef" :weight bold))   ; è“è‰²ï¼Œè¡¨ç¤ºè¡ŒåŠ¨æˆ–é‡‡è´­ä»»åŠ¡
        ("Book" . (:foreground "#51afef" :weight bold))   ; è“è‰²ï¼Œè¡¨ç¤ºè¡ŒåŠ¨æˆ–é‡‡è´­ä»»åŠ¡
        ("Plan" . (:foreground "#c678dd" :weight bold)))) ; ç´«è‰²ï¼Œè¡¨ç¤ºè§„åˆ’/å­¦ä¹ 

  (require 'org-checklist)
  ;; need repeat task and properties
  (setq org-log-done t)
  (setq org-log-into-drawer t)
  
  ;; æ—¥å¿—è®¾ç½®
  (setq org-log-done 'time
        org-log-into-drawer t)
  
  ;; ä¼˜å…ˆçº§
  (setq org-priority-faces
        '((?A . (:foreground "#ff6c6b" :weight bold))
          (?B . (:foreground "#ECBE7B" :weight bold))
          (?C . (:foreground "#51afef" :weight bold)))
	org-aenda-block-separator 8411)
  
  ;; org-babel é…ç½®
  (org-babel-do-load-languages
   'org-babel-load-languages
   '((emacs-lisp . t)
     (python . t)
     (shell . t)
     (C . t)
     (java . t)
     (js . t)
     (ruby . t)
     (perl . t)
     (css . t)
     (latex . t)
     (org . t)))
  
  (setq org-confirm-babel-evaluate nil
        org-src-fontify-natively t
        org-src-tab-acts-natively t
        org-src-preserve-indentation t
        org-edit-src-content-indentation 0)  ; æ·»åŠ è¿™ä¸ª
  
  ;; LaTeX é«˜äº®
  (setq org-highlight-latex-and-related '(latex script entities))
  
  ;; æ ‡é¢˜å­—ä½“å’Œé¢œè‰²ï¼ˆdoom-one é£æ ¼ï¼‰
  ;; (set-face-attribute 'org-level-1 nil 
  ;;                     :foreground "#51afef" 
  ;;                     :height 1.0 
  ;;                     :weight 'bold)
  ;; (set-face-attribute 'org-level-2 nil 
  ;;                     :foreground "#c678dd" 
  ;;                     :height 1.0)
  ;; (set-face-attribute 'org-level-3 nil 
  ;;                     :foreground "#98be65" 
  ;;                     :height 1.0)
  ;; (set-face-attribute 'org-level-4 nil 
  ;;                     :foreground "#da8548" 
  ;;                     :height 1.0)
  ;; (set-face-attribute 'org-level-5 nil 
  ;;                     :foreground "#5699af" 
  ;;                     :height 1.0)
  ;; (set-face-attribute 'org-level-6 nil 
  ;;                     :foreground "#a9a1e1" 
  ;;                     :height 1.0)
  
  ;; Agenda è§†å›¾è®¾ç½®
  (setq org-agenda-span 7
        org-agenda-start-on-weekday nil
        org-agenda-start-day nil
        org-agenda-skip-scheduled-if-done t
        org-agenda-skip-deadline-if-done t)
  
  ;; Capture æ¨¡æ¿
 (setq org-capture-templates
 '(("t" "Todo" entry
    (file+headline "~/.emacs.d/org/todo.org" "ï’   TASK")
    "** TODO %?\nSCHEDULED: %t\n%i\n")

    ("p" "Plan" entry
    (file+headline "~/.emacs.d/org/plan.org" "ï‡™a PLAN")
    "** Plan %?\nCREATED: %U\n%i\n")

    ("k" "Book" entry
    (file+headline "~/.emacs.d/org/book.org" "ï€­  BOOK")
    "** Book ?\nCREATED: %U\n%i\n")

    ("b" "Buy" entry
    (file+headline "~/.emacs.d/org/buy.org" "ïº  SHOP")
    "** Buy %?\nCREATED: %U\n%i\n"))))
#+end_src

** org-fancy-priorities
*** ä»‹ç»
org-fancy-priorities ç”¨äºåœ¨ org-mode ä¸­ä½¿ç”¨è‡ªå®šä¹‰ç¬¦å·æ˜¾ç¤ºä»»åŠ¡ä¼˜å…ˆçº§ï¼Œæå‡è§†è§‰æ•ˆæœå’Œå¯è¯»æ€§ã€‚
*** ç›¸å…³é“¾æ¥
- GitHub: https://github.com/harrybournis/org-fancy-priorities
*** é…ç½® 
#+begin_src emacs-lisp
(use-package org-fancy-priorities
  :hook
  (org-mode . org-fancy-priorities-mode)
  :config
  (setq org-fancy-priorities-list '("ó°¯¬ " "ó°¯¯ " "ó°¯² ")))
#+end_src
*** ä½¿ç”¨æ–¹æ³•
- åœ¨ org-mode ä¸­ä½¿ç”¨ =C-c , p= è®¾ç½®ä»»åŠ¡ä¼˜å…ˆçº§


** auctex

*** ä»‹ç»
AUCTeX æ˜¯ Emacs ä¸­åŠŸèƒ½å¼ºå¤§çš„ LaTeX ç¼–è¾‘ç¯å¢ƒï¼Œæä¾›è¯­æ³•é«˜äº®ã€è‡ªåŠ¨è¡¥å…¨ã€é¢„è§ˆã€ç¼–è¯‘ç­‰åŠŸèƒ½ã€‚æ”¯æŒå¤šç§ LaTeX å‘è¡Œç‰ˆå’Œå·¥å…·é“¾ã€‚
*** ç›¸å…³é“¾æ¥
- å®˜ç½‘: https://www.gnu.org/software/auctex/
- æ–‡æ¡£: https://www.gnu.org/software/auctex/manual/
*** é…ç½®
#+begin_src emacs-lisp
(use-package auctex
  :defer t
  :config
  ;; è‡ªåŠ¨ä¿å­˜æ—¶é‡æ–°ç”Ÿæˆæ–‡æ¡£
  (setq TeX-auto-save t)
  (setq TeX-parse-self t)
  ;; ä½¿ç”¨ PDF æ¨¡å¼è€Œä¸æ˜¯ DVI
  (setq TeX-PDF-mode t)
  ;; å¯ç”¨ RefTeX æ”¯æŒ
  (add-hook 'LaTeX-mode-hook 'turn-on-reftex)
  ;; è‡ªåŠ¨æŠ˜å ç¯å¢ƒ
  (add-hook 'LaTeX-mode-hook 'TeX-fold-mode)
  ;; è‡ªåŠ¨è¡¥å…¨æ•°å­¦ç¬¦å·
  (add-hook 'LaTeX-mode-hook 'LaTeX-math-mode)
  (setq TeX-source-correlate-start-server t))
#+end_src
*** ä½¿ç”¨æ–¹æ³•
- =C-c C-c= : ç¼–è¯‘ LaTeX æ–‡æ¡£
- =C-c C-v= : é¢„è§ˆç”Ÿæˆçš„ PDF
- =C-c= : æ’å…¥æ•°å­¦ç¬¦å·
- =M-n/M-p= : åœ¨ LaTeX ç¯å¢ƒé—´å¯¼èˆª

** math-preview

*** ä»‹ç»
math-preview æ˜¯ä¸€ä¸ª Emacs æ’ä»¶ï¼Œç”¨äºå®æ—¶é¢„è§ˆ LaTeX æ•°å­¦å…¬å¼ã€‚æ”¯æŒè¡Œå†…å…¬å¼å’Œå—çº§å…¬å¼ï¼Œç”Ÿæˆ SVG å›¾åƒå¹¶åµŒå…¥ç¼“å†²åŒºã€‚
*** ç›¸å…³é“¾æ¥
- GitLab: https://gitlab.com/matsievskiysv/math-preview
*** é…ç½®

#+begin_src emacs-lisp
(use-package math-preview
  :straight (:host gitlab :repo "matsievskiysv/math-preview")
  :config
  (setq math-preview-svg-postprocess-functions '())
  
  ;; å—çº§å…¬å¼å±…ä¸­å¯¹é½
  (advice-add 'math-preview--process-input :after
    (lambda (&rest _)
      (dolist (ov (overlays-in (point-min) (point-max)))
        (when (eq (overlay-get ov 'category) 'math-preview)
          (let* ((begin (overlay-start ov))
                 (end (overlay-end ov))
                 (text (buffer-substring-no-properties begin end))
                 (is-display (or (string-match-p "^\\\\\\[" text)
                                (string-match-p "^\\$\\$" text)))
                 (display (overlay-get ov 'display)))
            (when (and is-display display)
              (let* ((image-spec (if (and (listp display) (listp (cdr display)))
                                    (cadr display)
                                  display))
                     (img-size (condition-case nil
                                  (image-size image-spec t)
                                (error nil)))
                     (img-width (if img-size (car img-size) 400))
                     (window-width (window-body-width nil t))
                     (indent (max 0 (/ (- window-width img-width) 2))))
                (overlay-put ov 'before-string 
                            (propertize " " 'display `(space :width (,indent)))))))))))
  
  ;; çª—å£å¤§å°å˜åŒ–æ—¶è‡ªåŠ¨é‡æ–°å±…ä¸­
  (defvar-local math-preview--last-width nil)
  
  (defun math-preview--auto-recenter (frame)
    (dolist (window (window-list frame))
      (with-current-buffer (window-buffer window)
        (when (cl-some (lambda (ov) (eq (overlay-get ov 'category) 'math-preview))
                       (overlays-in (point-min) (point-max)))
          (let ((width (window-body-width window t)))
            (unless (equal width math-preview--last-width)
              (setq math-preview--last-width width)
              (with-selected-window window
                (math-preview-clear-all)
                (math-preview-all))))))))
  
  (add-to-list 'window-size-change-functions #'math-preview--auto-recenter)
  
  (math-preview-start-process))

     (defvar my/last-math-state nil
       "è®°å½•ä¸Šä¸€æ¬¡å…‰æ ‡æ˜¯å¦åœ¨æ•°å­¦ç¯å¢ƒä¸­")

     (defun my/auto-toggle-math-preview ()
       "å…‰æ ‡è¿›å…¥æ•°å­¦ç¯å¢ƒæ—¶æ¸…é™¤é¢„è§ˆï¼Œç¦»å¼€æ—¶é‡æ–°é¢„è§ˆæ‰€æœ‰å…¬å¼"
       (when (and (eq major-mode 'org-mode)
                  (not (string-equal (file-name-nondirectory (or buffer-file-name "")) "config.org")))
         (let ((in-math (texmathp)))  ; æ£€æŸ¥æ˜¯å¦åœ¨æ•°å­¦ç¯å¢ƒä¸­
           ;; åªåœ¨çŠ¶æ€å˜åŒ–æ—¶æ‰§è¡Œæ“ä½œ
           (unless (eq in-math my/last-math-state)
             (if in-math
                 ;; è¿›å…¥æ•°å­¦ç¯å¢ƒï¼šæ¸…é™¤å…‰æ ‡å¤„çš„é¢„è§ˆ
                 (math-preview-clear-at-point)
               ;; ç¦»å¼€æ•°å­¦ç¯å¢ƒï¼šé¢„è§ˆæ‰€æœ‰å…¬å¼
               (math-preview-all))
             ;; æ›´æ–°çŠ¶æ€
             (setq my/last-math-state in-math)))))

     ;; å°†å‡½æ•°æ·»åŠ åˆ° post-command-hook
     (add-hook 'org-mode-hook
               (lambda ()
                 (add-hook 'post-command-hook #'my/auto-toggle-math-preview nil t)))
#+end_src
*** ä½¿ç”¨æ–¹æ³•
- åœ¨ org-mode ä¸­è¾“å…¥ LaTeX æ•°å­¦å…¬å¼ï¼ˆè¡Œå†…ç”¨ $...$ï¼Œå—çº§ç”¨ $$...$$ æˆ– \[...\]ï¼‰
- å…‰æ ‡ç¦»å¼€å…¬å¼åï¼Œå…¬å¼ä¼šè‡ªåŠ¨æ¸²æŸ“ä¸º SVG å›¾åƒ
- å…‰æ ‡è¿›å…¥å…¬å¼æ—¶ï¼Œé¢„è§ˆä¼šè¢«æ¸…é™¤ï¼Œæ–¹ä¾¿ç¼–è¾‘


** org-latex-preview

#+begin_src emacs-lisp
;; è¿™äº›é…ç½®éœ€è¦åœ¨ org å®Œå…¨åŠ è½½åæ‰èƒ½æ‰§è¡Œ
(with-eval-after-load 'org
(setenv "PATH" (concat "/opt/homebrew/bin:" (getenv "PATH")))
(setq exec-path (cons "/opt/homebrew/bin" exec-path))

  ;; Retina ä¼˜åŒ– + è‡ªåŠ¨å±…ä¸­
  (plist-put org-format-latex-options :scale 2.0)
  
  (setq org-preview-latex-default-process 'imagemagick)
  (setq org-preview-latex-process-alist
        '((imagemagick
           :programs ("xelatex" "magick")
           :description "pdf > png"
           :message "éœ€è¦å®‰è£… xelatex å’Œ imagemagick"
           :image-input-type "pdf"
           :image-output-type "png"
           :image-size-adjust (1.0 . 1.0)
           :latex-compiler ("xelatex -interaction nonstopmode -output-directory %o %f")
           :image-converter ("convert -density 300 -trim %f -quality 100 %O"))))

;; ä½¿ç”¨ dvipng æ¸²æŸ“ LaTeX å…¬å¼
;; (setq org-preview-latex-default-process 'dvipng)

;; (setq org-preview-latex-process-alist
;;       '((dvipng
;;          :programs ("latex" "dvipng")                  ;; è°ƒç”¨ latex å’Œ dvipng
;;          :description "DVI > PNG"
;;          :message "éœ€è¦å®‰è£… latex å’Œ dvipng"
;;          :use-xcolor t                                  ;; æ”¯æŒå…¬å¼é¢œè‰²
;;          :image-input-type "dvi"                        ;; è¾“å…¥ç±»å‹ä¸º DVI
;;          :image-output-type "png"                       ;; è¾“å‡º PNG
;;          :image-size-adjust (1.0 . 1.0)                 ;; å›¾ç‰‡ç¼©æ”¾
;;          :latex-compiler ("latex -interaction=nonstopmode -output-directory=%o %f")
;;          :image-converter ("dvipng -D 300 -T tight -o %O %f")))) ;; DVI è½¬ PNG

;; (setq org-preview-latex-default-process 'dvisvgm)


  ;; è¡Œå†…å›¾ç‰‡ç¼©æ”¾
  (advice-add 'org--create-inline-image :filter-return
              (lambda (img) (image--set-property img :scale 0.5) img))
  
  ;; LaTeX é¢„è§ˆç¼©æ”¾ + å±…ä¸­
  (defun my/org-latex-preview-setup (beg end image &optional imagetype)
    "è®¾ç½® LaTeX é¢„è§ˆ:Retina ç¼©æ”¾ + ç‹¬ç«‹å…¬å¼å±…ä¸­"
    (let ((ov (car (overlays-at beg))))
      (when (eq (overlay-get ov 'org-overlay-type) 'org-latex-overlay)
        ;; è®¾ç½®ç¼©æ”¾
        (overlay-put ov 'display
                     `(image :type ,(or (and imagetype (intern imagetype)) 'png)
                            :file ,image :ascent center :scale 0.5))
        ;; ç‹¬ç«‹æˆè¡Œåˆ™å±…ä¸­
        (when (save-excursion
                (goto-char beg)
                (and (looking-back "^[[:space:]]*" (line-beginning-position))
                     (goto-char end)
                     (looking-at "[[:space:]]*$")))
          (overlay-put ov 'line-prefix 
                       `(space :align-to (- center (0.5 . ,(overlay-get ov 'display)))))))))
  
  (advice-add 'org--make-preview-overlay :after #'my/org-latex-preview-setup))
#+end_src

** ä½¿ç”¨æ–¹æ³•
- =C-c C-c= : æ‰§è¡Œä»£ç å—
- =C-c '= : ç¼–è¾‘ä»£ç å—
- =TAB= : æŠ˜å /å±•å¼€æ ‡é¢˜
- =C-c C-e= : å¯¼å‡ºèœå•


** org-sliced-images
*** ä»‹ç»
org-sliced-images ä¸º org-mode æä¾›å¹³æ»‘çš„å›¾ç‰‡æ»šåŠ¨ä½“éªŒï¼Œé€šè¿‡å°†å›¾ç‰‡åˆ‡ç‰‡æ˜¾ç¤ºæ¥å®ç°æµç•…æ»šåŠ¨ã€‚ç›¸æ¯” iscroll æ›´å¿«ä¸”æ›´åŸç”Ÿï¼Œä¸éœ€è¦é‡æ–°ç»‘å®šç§»åŠ¨é”®ã€‚
*** ç›¸å…³é“¾æ¥
- GitHub: https://github.com/jcfk/org-sliced-images
- å¯¹æ¯”: æ¯” iscroll æ›´å¿«ï¼Œæ¯” pixel-scroll æ›´çœèµ„æº
*** é…ç½®
#+begin_src emacs-lisp
(use-package org-sliced-images
  :after org
  :config
  ;; å¯ç”¨å…¨å±€æ¨¡å¼
  (org-sliced-images-mode 1)
  
  ;; è‡ªå®šä¹‰é€‰é¡¹
  ;; å¦‚æœä½¿ç”¨ org-indent-mode æˆ–è¡Œå·ï¼Œå»ºè®®å¯ç”¨è¿™ä¸ª
  (setq org-sliced-images-round-image-height t)
  
  ;; å¯é€‰ï¼šè‡ªåŠ¨æ¸…ç†å ä½ç¬¦è¡Œ
  (setq org-sliced-images-consume-dummies t))
#+end_src
*** ä½¿ç”¨æ–¹æ³•
- å¯ç”¨åè‡ªåŠ¨å¯¹ org-mode ä¸­çš„å†…è”å›¾ç‰‡è¿›è¡Œåˆ‡ç‰‡å¤„ç†
- ä½¿ç”¨æ­£å¸¸çš„ç§»åŠ¨å‘½ä»¤ (=j/k=, =C-n/C-p=, é¼ æ ‡æ»šè½®) å³å¯å¹³æ»‘æ»šåŠ¨å›¾ç‰‡
- åˆ‡æ¢å›¾ç‰‡æ˜¾ç¤º: =C-c C-x C-v= (org-toggle-inline-images)
- å»ºè®®é…åˆ =org-startup-with-inline-images= è‡ªåŠ¨æ˜¾ç¤ºå›¾ç‰‡
*** æ³¨æ„äº‹é¡¹
- å¦‚æœä½¿ç”¨ org-indent-mode æˆ–è¡Œå·ï¼Œå¿…é¡»è®¾ç½® =org-sliced-images-round-image-height= ä¸º =t=
- åªå½±å“ org-mode çš„å†…è”å›¾ç‰‡ï¼Œä¸å½±å“å…¶ä»–æ¨¡å¼

** org-superstar
*** ä»‹ç»
ç¾åŒ– org-mode çš„æ ‡é¢˜å’Œåˆ—è¡¨é¡¹ï¼Œä½¿ç”¨æ›´å¥½çœ‹çš„ç¬¦å·æ›¿ä»£æ˜Ÿå·ã€‚

*** ç›¸å…³é“¾æ¥
- GitHub: https://github.com/integral-dw/org-superstar-mode

*** é…ç½®
#+begin_src emacs-lisp
(use-package org-superstar
  :after org
  :hook (org-mode . org-superstar-mode)
  :config
  (setq org-superstar-headline-bullets-list
        '("â—‰" "â—‹" "âœ¸" "âœ¿" "âœ¦" "â€" "â¤" "â–¶"))
  
  (setq org-superstar-item-bullet-alist
        '((?* . ?â€¢) (?+ . ?â¤) (?- . ?â€¢)))
  
  (setq org-superstar-checkbox-bullet-alist
        '((?X . "â˜’") (?? . "â˜") (?\  . "â˜")))
  
  (setq org-superstar-item-indent-offset 2)
  (setq org-superstar-remove-leading-stars t)
  (setq org-superstar-use-with-org-bullets t))
#+end_src




** org-bars
*** ä»‹ç»
org-bars ä¸º org-mode æ ‡é¢˜æ·»åŠ æ¼‚äº®çš„å‚ç›´å½©è‰²æ¡ï¼Œå¢å¼ºè§†è§‰å±‚æ¬¡æ„Ÿã€‚æ”¯æŒè‡ªå®šä¹‰é¢œè‰²å’Œæ ·å¼ï¼Œè®© org æ–‡æ¡£æ›´åŠ ç¾è§‚æ˜“è¯»ã€‚

*** ç›¸å…³é“¾æ¥
- GitHub: https://github.com/tonyaldon/org-bars

*** é…ç½®
#+begin_src emacs-lisp
;; (use-package org-bars
;;   :straight (org-bars :type git :host github :repo "tonyaldon/org-bars")
;;   :after org
;;   :hook (org-mode . org-bars-mode)
;;   :config
;;   ;; æ˜Ÿå·ç¬¦å·é…ç½®
;;   (setq org-bars-stars '(:empty "â—‰"
;;                          :invisible "â–¶"
;;                          :visible "â–¼")))
;; æ–¹æ¡ˆ2: ç»Ÿä¸€çš„æ¬¡è¦é¢œè‰²
;; (setq org-bars-color-options '(:only-one-color t
;;                                :bar-color "#51afef")))  ;;
  ;; æ–¹æ³• 1: è®© bars è·Ÿéšæ ‡é¢˜é¢œè‰²ï¼ˆæ¨èï¼‰
  ;; é»˜è®¤å°±æ˜¯è¿™æ ·ï¼Œbars ä¼šç»§æ‰¿å„çº§æ ‡é¢˜çš„é¢œè‰²
 ;; (setq org-bars-color-options nil))
#+end_src

*** ä½¿ç”¨æ–¹æ³•
- åœ¨ org-mode ä¸­è‡ªåŠ¨æ˜¾ç¤ºï¼Œæ— éœ€æ‰‹åŠ¨æ“ä½œ
- æŠ˜å /å±•å¼€æ ‡é¢˜æ—¶å½©è‰²æ¡ä¼šè‡ªåŠ¨è°ƒæ•´


** auctex
*** ä»‹ç»
AUCTeX æ˜¯ Emacs ä¸­æœ€å¼ºå¤§çš„ LaTeX ç¼–è¾‘ç¯å¢ƒï¼Œæä¾›è¯­æ³•é«˜äº®ã€è‡ªåŠ¨è¡¥å…¨ã€PDF åŒæ­¥é¢„è§ˆç­‰åŠŸèƒ½ã€‚

*** ç›¸å…³é“¾æ¥
- å®˜ç½‘: https://www.gnu.org/software/auctex/
- GitHub: https://github.com/emacs-auctex/auctex

*** é…ç½®
#+begin_src emacs-lisp
(use-package auctex
  :mode (("\\.tex\\'" . LaTeX-mode)
         ("\\.ltx\\'" . LaTeX-mode)
         ("\\.cls\\'" . LaTeX-mode))
  :init
  (setq TeX-auto-save t
        TeX-parse-self t
        TeX-master nil)
  :config
  (require 'texmathp)
  (add-hook 'LaTeX-mode-hook 'LaTeX-math-mode)
  (add-hook 'LaTeX-mode-hook 'turn-on-reftex))
#+end_src

*** ä½¿ç”¨æ–¹æ³•
- =C-c C-c= : ç¼–è¯‘æ–‡æ¡£
- =C-c C-v= : æŸ¥çœ‹ PDF
- =C-c C-e= : æ’å…¥ç¯å¢ƒ
- =C-c C-m= : æ’å…¥å®

** org-latex å¯¼å‡ºé…ç½®
*** é…ç½®
#+begin_src emacs-lisp
(setq org-latex-compiler "xelatex")
(setq org-latex-pdf-process
      '("xelatex -shell-escape -interaction nonstopmode -output-directory %o %f"
        "xelatex -shell-escape -interaction nonstopmode -output-directory %o %f"
        "xelatex -shell-escape -interaction nonstopmode -output-directory %o %f"))

;; ä½¿ç”¨ minted
(setq org-latex-listings 'minted)

;; è¯­è¨€æ˜ å°„
(with-eval-after-load 'ox-latex
  (add-to-list 'org-latex-minted-langs '(emacs-lisp "common-lisp"))
  (add-to-list 'org-latex-minted-langs '(elisp "common-lisp")))

;; minted é€‰é¡¹
(setq org-latex-minted-options
      '(("fontsize" "\\small")
        ("breaklines" "true")
        ("breakanywhere" "true")
        ("bgcolor" "boxback")
        ("frame" "leftline")
        ("framerule" "2pt")
        ("rulecolor" "boxblue")
        ("baselinestretch" "1.2")))
#+end_src
** org-plus-contrib
*** ä»‹ç»
org-contrib æ˜¯ Org-mode çš„è´¡çŒ®æ¨¡å—é›†åˆï¼ŒåŒ…å«ä¸€äº›ç”±ç¤¾åŒºå’Œç»´æŠ¤è€…è´¡çŒ®çš„é¢å¤–åŠŸèƒ½å’Œæ‰©å±•ï¼Œè¿™äº›åŠŸèƒ½æ²¡æœ‰è¢«çº³å…¥ Org-mode çš„æ ¸å¿ƒã€‚
org-contrib åŒ…å«å“ªäº›åŠŸèƒ½ï¼Ÿ
ä¸€äº›ä¸»è¦çš„æ¨¡å—åŒ…æ‹¬ï¼š

org-annotate-fileï¼šä¸ºæ–‡ä»¶æ·»åŠ æ³¨é‡Š
org-attach-gitï¼šä½¿ç”¨ Git ç®¡ç†é™„ä»¶
org-bookmarkï¼šä¹¦ç­¾ç®¡ç†
org-elisp-symbolï¼šç¬¦å·é“¾æ¥æ”¯æŒ
org-evalï¼šä»£ç è¯„ä¼°
org-expiryï¼šè¿‡æœŸæ—¥æœŸå¤„ç†
org-git-linkï¼šGit é“¾æ¥æ”¯æŒ
org-mac-linkï¼šMac åº”ç”¨é“¾æ¥
org-manï¼šMan é¡µé¢æ”¯æŒ
ä»¥åŠå…¶ä»–ç¤¾åŒºè´¡çŒ®çš„æ¨¡å—

org-contrib vs org-plus-contrib çš„å…³ç³»ï¼š

orgï¼šæ ¸å¿ƒåŠŸèƒ½
org-contribï¼šé¢å¤–çš„è´¡çŒ®æ¨¡å—ï¼ˆç‹¬ç«‹åŒ…ï¼‰
org-plus-contribï¼šorg + org-contrib çš„ç»„åˆï¼ˆç°å·²å¼ƒç”¨ï¼‰

#+begin_src emacs-lisp
(use-package org-contrib
  :after org)
#+end_src

** org-download

*** ä»‹ç»
org-download ç®€åŒ–åœ¨ org-mode ä¸­æ’å…¥å›¾ç‰‡çš„æµç¨‹ï¼Œæ”¯æŒä»å‰ªè´´æ¿ã€URLã€æœ¬åœ°æ–‡ä»¶ç­‰å¤šç§æ–¹å¼æ’å…¥å›¾ç‰‡ã€‚è‡ªåŠ¨ç®¡ç†å›¾ç‰‡æ–‡ä»¶ï¼Œæ”¯æŒæˆªå›¾å’Œæ‹–æ”¾ã€‚

*** ç›¸å…³é“¾æ¥
- GitHub: https://github.com/abo-abo/org-download

*** é…ç½®
#+begin_src emacs-lisp
(use-package org-download
  :after org
  :hook (org-mode . org-download-enable)
  :config
  (setq org-download-image-dir "./images"
        org-download-heading-lvl nil
        org-download-timestamp "%Y%m%d-%H%M%S_"
        org-download-display-inline-images t
        org-download-image-attr-list '("#+ATTR_ORG: :width 600"))
  
  (setq org-download-screenshot-method
        (cond ((eq system-type 'darwin) "screencapture -i %s")
              ((and (eq system-type 'gnu/linux) (getenv "WAYLAND_DISPLAY"))
               "grim -g \"$(slurp)\" %s")
              (t "import %s")))
  
  ;; Wayland å‰ªè´´æ¿
  (when (and (eq system-type 'gnu/linux) (getenv "WAYLAND_DISPLAY"))
    (defun org-download-clipboard ()
      (interactive)
      (let* ((base (or (and (buffer-file-name) 
                            (file-name-directory (buffer-file-name)))
                       default-directory
                       "~/"))
             (dir (expand-file-name "images" base))
             (name (format-time-string (concat org-download-timestamp "screenshot.png")))
             (file (expand-file-name name dir)))
        (make-directory dir t)
        (with-temp-buffer
          (set-buffer-multibyte nil)
          (call-process "wl-paste" nil t nil "--type" "image/png")
          (write-region nil nil file nil 'silent))
        (insert (format "#+DOWNLOADED: clipboard @ %s\n#+ATTR_ORG: :width 600\n[[file:./images/%s]]\n"
                        (format-time-string "%Y-%m-%d %H:%M:%S") name))
        (org-display-inline-images t t)))))
#+end_src

*** ä½¿ç”¨æ–¹æ³•
- =SPC i p= : ä»å‰ªè´´æ¿æ’å…¥å›¾ç‰‡
- =SPC i d= : åˆ é™¤å…‰æ ‡å¤„çš„å›¾ç‰‡
- å›¾ç‰‡è‡ªåŠ¨ä¿å­˜åœ¨å½“å‰æ–‡ä»¶çš„ `./images/` ç›®å½•




** procress
*** ä»‹ç»
procress ä¸º AUCTeX æä¾›ç¼–è¯‘è¿›åº¦çš„å¯è§†åŒ–æ˜¾ç¤ºï¼Œåœ¨ LaTeX ç¼–è¯‘è¿‡ç¨‹ä¸­æ˜¾ç¤ºè¿›åº¦æ¡å’ŒçŠ¶æ€å›¾æ ‡ï¼Œè®©ä½ å®æ—¶äº†è§£ç¼–è¯‘è¿›åº¦ã€‚

*** ç›¸å…³é“¾æ¥
- GitHub: https://github.com/haji-ali/procress

*** é…ç½®
#+begin_src emacs-lisp
(use-package procress
  :straight (:host github :repo "haji-ali/procress")
  :commands procress-auctex-mode
  :init
  (add-hook 'LaTeX-mode-hook #'procress-auctex-mode)
  :config
  (procress-load-default-svg-images))
#+end_src

*** ä½¿ç”¨æ–¹æ³•
- LaTeX ç¼–è¯‘æ—¶è‡ªåŠ¨æ˜¾ç¤ºè¿›åº¦
- åœ¨ mode-line æ˜¾ç¤ºç¼–è¯‘çŠ¶æ€å›¾æ ‡

** helpful
*** ä»‹ç»
helpful æä¾›æ›´å‹å¥½ã€æ›´è¯¦ç»†çš„å¸®åŠ©æ–‡æ¡£ç•Œé¢ã€‚ç›¸æ¯”å†…ç½®çš„ describe-* å‘½ä»¤ï¼Œhelpful æ˜¾ç¤ºæ›´å¤šæœ‰ç”¨ä¿¡æ¯ï¼Œå¦‚æºä»£ç ã€å¼•ç”¨ä½ç½®ã€å¿«æ·é”®ç­‰ã€‚

*** ç›¸å…³é“¾æ¥
- GitHub: https://github.com/Wilfred/helpful

*** é…ç½®
#+begin_src emacs-lisp
(use-package helpful
  :defer 3
  :bind
  (([remap describe-function] . #'helpful-callable)
   ([remap describe-variable] . #'helpful-variable)
   ([remap describe-key] . #'helpful-key)
   ([remap describe-command] . #'helpful-command)
   ([remap describe-symbol] . #'helpful-symbol)
   ("C-h C-d" . #'helpful-at-point)
   ("C-h F" . #'helpful-function))
  :config
  (add-hook 'helpful-mode-hook 'visual-line-mode))
#+end_src

*** ä½¿ç”¨æ–¹æ³•
- æ›¿ä»£æ‰€æœ‰åŸç”Ÿçš„ describe-* å‘½ä»¤
- =C-h f= : æŸ¥çœ‹å‡½æ•°å¸®åŠ©
- =C-h v= : æŸ¥çœ‹å˜é‡å¸®åŠ©
- =C-h k= : æŸ¥çœ‹æŒ‰é”®ç»‘å®š
- =C-h C-d= : æŸ¥çœ‹å…‰æ ‡å¤„ç¬¦å·çš„å¸®åŠ©


** laas (LaTeX Auto-Activating Snippets)
*** ä»‹ç»
laas ä¸º LaTeX å’Œ Org æ¨¡å¼æä¾›è‡ªåŠ¨æ¿€æ´»çš„ä»£ç ç‰‡æ®µç³»ç»Ÿï¼Œæ— éœ€æŒ‰ TAB å±•å¼€ã€‚è¾“å…¥ç‰¹å®šå­—ç¬¦åºåˆ—åè‡ªåŠ¨æ›¿æ¢ï¼Œæå¤§æå‡æ•°å­¦å…¬å¼å’Œ LaTeX è¾“å…¥æ•ˆç‡ã€‚

*** ç›¸å…³é“¾æ¥
- GitHub: https://github.com/tecosaur/LaTeX-auto-activating-snippets

*** é…ç½®
#+begin_src emacs-lisp
(use-package laas
  :hook ((LaTeX-mode . laas-mode) (org-mode . laas-mode))
  :config
  (aas-set-snippets 'laas-mode
                    ;; set condition!
                    :cond #'texmathp ; expand only while in math
		    "qq" "\\quad"
		    "c.." "\\cdots"
		    "le" "\\leq"
                    "On" "O(n)"
		    "ra" " \\Rightarrow "
		    "oo"  "\\infty"
		    "int" "\\int"
		    "-oo"  "-\\infty"
                    "O1" "O(1)"
                    "Olog" "O(\\log n)"
		    ";;" "\&"
		    "\\" "\\\\"
                    "Olon" "O(n \\log n)"
                    ;; bind to functions!

                    "bc" (lambda () (interactive)
                            (yas-expand-snippet "($1)$0"))

                    "sum" (lambda () (interactive)
                            (yas-expand-snippet "\\sum\\limits_{$1}^{$2} $3"))

                    "bmat" (lambda () (interactive)
                            (yas-expand-snippet "\\begin{bmatrix} $1 \\end{bmatrix} $2"))

                    "l(" (lambda () (interactive)
                            (yas-expand-snippet "\\left( $1 \\right"))

                    "xsp" (lambda () (interactive)
                            (yas-expand-snippet "$1^{$2} + $1^{2*$2} + \\dots + $1^{n*$2}"))

                    "xas" (lambda () (interactive)
                            (yas-expand-snippet "$1_{1}$2_{1} + $1_{2}$2_{2} + \\dots + $1_{$3}$2_{$3}"))
                    "ff" (lambda () (interactive)
                            (yas-expand-snippet "\\frac{$1}{$2} $0"))

                    "prod" (lambda () (interactive)
                            (yas-expand-snippet "\\prod\\limits_{${1:i}^{${2:n}}${0:x}"))))

(defun my/simple-absorb (pattern replacement)
  "é€šç”¨çš„æ­£åˆ™å¸å–å‡½æ•°ï¼Œæ”¯æŒ YAS è·³è½¬
PATTERN: æ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼
REPLACEMENT: æ›¿æ¢å­—ç¬¦ä¸²ï¼Œç”¨ %s è¡¨ç¤ºåŒ¹é…å†…å®¹ï¼Œæ”¯æŒ $1, $2, $0 è·³è½¬ç‚¹"
  (cond
   ;; 1. å°è¯•æ­£åˆ™æ¨¡å¼åŒ¹é…å¸å–
   ((looking-back pattern (line-beginning-position))
    (let ((matched (match-string 1)))
      (replace-match "")
      (yas-expand-snippet (format replacement matched))))
   ;; 2. å°è¯• LAAS å¯¹è±¡åŒ…è£…ï¼ˆå¦‚æœå­˜åœ¨çš„è¯ï¼‰
   ((and (fboundp 'laas-object-on-left-condition)
         (laas-object-on-left-condition)
         (string-match "\\\\\\([a-z]+\\)" replacement))
    (laas-wrap-previous-object (match-string 1 replacement)))
   ;; 3. æ™®é€šæ’å…¥
   (t 
    (yas-expand-snippet (replace-regexp-in-string "%s" "" replacement)))))

;; æ ¸å¿ƒå¸å–å‡½æ•°
(defun my/absorb-sub ()
  "ä¸‹æ ‡å¸å–: xsub -> x_{} æ”¯æŒè·³è½¬"
  (interactive)
  (my/simple-absorb "\\([a-zA-Z]+\\)sub" "%s_{$1}$0"))


(defun my/absorb-pow ()
  "ä¸‹æ ‡å¸å–: xpow -> x^{} æ”¯æŒè·³è½¬"
  (interactive)
  (my/simple-absorb "\\([a-zA-Z]+\\)pow" "%s^{$1}$0"))


(defun my/absorb-brace ()
  "xbc -> x() æ”¯æŒè·³è½¬"
  (interactive)
  (my/simple-absorb "\\([a-zA-Z]+\\)bc" "%s($0)"))

(defun my/absorb-bb ()
  "é»‘æ¿ä½“å¸å–: Abb -> \\mathbb{A}"
  (interactive)
  (my/simple-absorb "\\([A-Z]\\)bb" "\\mathbb{$s}"))


(defun my/absorb-bf ()
  "é»‘æ¿ä½“å¸å–: Abb -> \\mathbb{A}"
  (interactive)
  (my/simple-absorb "\\([A-Z]\\)bf" "\\mathbf{$s}"))

(defun my/absorb-hat ()
  "å¸½å­å¸å–: xhat -> \\hat{x}"
  (interactive)
  (my/simple-absorb "\\([a-zA-Z]+\\)hat" "\\hat{$s}"))

;; æ³¨å†Œåˆ° LAAS
(with-eval-after-load 'laas
  (aas-set-snippets 'laas-mode
    :cond #'texmathp
    :cond #'laas-object-on-left-condition
    "qq" (lambda () (interactive) (laas-wrap-previous-object "sqrt"))
    "sub" #'my/absorb-sub
    "bb" #'my/absorb-bb
    "bf" #'my/absorb-bf
    "pow" #'my/absorb-pow
    "hat" #'my/absorb-hat))


(with-eval-after-load 'laas
  (aas-set-snippets 'laas-mode
                    :cond (lambda () (not (texmathp)))
                    "ii" (lambda () (interactive)
                            (yas-expand-snippet "\\\\( $1 \\\\) $0"))
                    "dd" (lambda () (interactive)
                            (yas-expand-snippet "\\[\n $1 \n\\] $0"))))


#+end_src

*** ä½¿ç”¨è¯´æ˜

*åŸºç¡€ snippetsï¼ˆåœ¨æ•°å­¦ç¯å¢ƒä¸­ï¼‰*
- =qq= : \quad
- =c..= : \cdots
- =le= : \leq
- =ra= : \Rightarrow
- =oo= : \infty
- =-oo= : -\infty
- =int= : \int
- =;;= : &
- =\\= : \\

*å¤§Oè®°å·*
- =On= : O(n)
- =O1= : O(1)
- =Olog= : O(\log n)
- =Olon= : O(n \log n)

*æ¨¡æ¿ snippets*
- =sum= : æ±‚å’Œç¬¦å·æ¨¡æ¿ \sum\limits_{$1}^{$2} $0
- =prod= : è¿ä¹˜ç¬¦å·æ¨¡æ¿ \prod\limits_{$1}^{$2} $0
- =ff= : åˆ†æ•°æ¨¡æ¿ \frac{$1}{$2} $0
- =lc= : æ‹¬å· \left( $1 \right) $0
- =bmat= : çŸ©é˜µ \begin{bmatrix} $1 \end{bmatrix} $0
- =xsp= : å¹‚çº§æ•°å±•å¼€æ¨¡æ¿
- =xas= : æ±‚å’Œå±•å¼€æ¨¡æ¿

*å¸å– snippetsï¼ˆä¼šå¸å–å‰é¢çš„å­—ç¬¦ï¼‰*
- =xsub= : è½¬æ¢ä¸ºä¸‹æ ‡ x_{$1}
- =xpow= : è½¬æ¢ä¸ºä¸Šæ ‡ x^{$1}
- =xbc= : æ·»åŠ æ‹¬å· x($0)
- =Abb= : é»‘æ¿ä½“ \mathbb{A}
- =Abf= : ç²—ä½“ \mathbf{A}
- =xhat= : å¸½å­ \hat{x}
- =qq= : å¯¹å‰é¢å†…å®¹åŒ…è£¹å¹³æ–¹æ ¹ \sqrt{x}

*éæ•°å­¦ç¯å¢ƒ*
- =ii= : è¡Œå†…å…¬å¼ \( $0 \)
- =dd= : ç‹¬ç«‹å…¬å¼ \[ $0 \]


* ç¼–ç¨‹å¼€å‘

LSPã€tree-sitter å’Œå„ç§ç¼–ç¨‹è¯­è¨€æ”¯æŒã€‚

** lsp-mode
*** ä»‹ç»
lsp-mode æ˜¯ Language Server Protocol çš„ Emacs å®ç°ï¼Œæä¾›æ™ºèƒ½è¡¥å…¨ã€ä»£ç å¯¼èˆªã€é‡æ„ã€è¯Šæ–­ç­‰ IDE çº§åˆ«çš„åŠŸèƒ½ã€‚æ”¯æŒå‡ åç§ç¼–ç¨‹è¯­è¨€ã€‚

*** ç›¸å…³é“¾æ¥
- GitHub: https://github.com/emacs-lsp/lsp-mode
- å®˜ç½‘: https://emacs-lsp.github.io/lsp-mode/

*** é…ç½®
#+begin_src emacs-lisp
(use-package lsp-mode
  :hook ((c-ts-mode . lsp)
         (c++-ts-mode . lsp)
         (python-ts-mode . lsp)
         (nix-ts-mode . lsp)
         ;; (java-ts-mode . lsp)
         (go-mode . lsp))
  :commands lsp
  :init
  (when (eq system-type 'darwin)
    (setq lsp-nix-nil-server-path "/Users/luoyaohui/.nix-profile/bin/nil"))
  :config
  (add-to-list 'lsp-disabled-clients 'semgrep-ls)
  (setq lsp-prefer-flymake nil)
  (setq lsp-enable-on-type-formatting nil)
  (setq lsp-format-on-save nil))

(defcustom my/warning-suppress-message-regexps '(".*semgrep/rulesRefreshed.*")
  "List of warning messages to suppress.
See also `warning-suppress-log-types'."
  :type '(repeat string)
  :group 'my-configuration)

(defun my/display-warning-advise (type message &optional level buffer-name)
  "Allow filtering Emacs warning messages using regexp.
See the varibale `my/warning-suppress-message-regexps'."
  (catch 'exit
    (dolist (regexp my/warning-suppress-message-regexps)
      (when (string-match-p regexp message)
        (throw 'exit nil)))
    (throw 'exit t)))

(add-function :before-while (symbol-function 'display-warning) #'my/display-warning-advise)
#+end_src




** eglot

#+begin_src emacs-lisp 
(use-package eglot
  :hook (java-ts-mode . eglot-ensure)
  :config
  ;; æ·»åŠ  jdtls é…ç½®
  (add-to-list 'eglot-server-programs
               '(java-ts-mode . ("jdtls"))))

;; åªåœ¨ java-ts-mode ä¸‹ç»‘å®šé”®ä½
(general-define-key
 :states 'normal
 :keymaps 'java-ts-mode-map
 :prefix "SPC c"
 "r" #'eglot-rename
 "a" #'eglot-code-actions)

(use-package consult-eglot
  :after (consult eglot))
#+end_src


*** ä½¿ç”¨æ–¹æ³•
- =g d= : è·³è½¬åˆ°å®šä¹‰
- =g r= : æŸ¥æ‰¾å¼•ç”¨
- =SPC c f= : æ ¼å¼åŒ–ä»£ç 
- =M-x lsp-rename= : é‡å‘½åç¬¦å·
- =M-x lsp-organize-imports= : æ•´ç†å¯¼å…¥

*** æ”¯æŒçš„è¯­è¨€
éœ€è¦å…ˆå®‰è£…å¯¹åº”çš„ language serverï¼š
- Python: =pip install python-lsp-server=
- C/C++: =clangd=
- Java: è‡ªåŠ¨ä¸‹è½½ï¼ˆé€šè¿‡ lsp-javaï¼‰
- Go: =go install golang.org/x/tools/gopls@latest=
- Rust: =rustup component add rust-analyzer=


** apheleia

*** ä»‹ç»
apheleia æ˜¯ä¸€ä¸ª Emacs ä»£ç æ ¼å¼åŒ–å·¥å…·ï¼Œæ”¯æŒå¤šç§ç¼–ç¨‹è¯­è¨€å’Œæ ¼å¼åŒ–å™¨ã€‚å®ƒå¯ä»¥åœ¨ä¿å­˜æ–‡ä»¶æ—¶è‡ªåŠ¨æ ¼å¼åŒ–ä»£ç ï¼Œæå‡ä»£ç ä¸€è‡´æ€§
*** ç›¸å…³é“¾æ¥
- GitHub: https://github.com/raxod502/apheleia
*** é…ç½®
#+begin_src emacs-lisp
(use-package apheleia
  :init
  (apheleia-global-mode +1)
  :config
  ;; å¯ç”¨è°ƒè¯•
  (setq apheleia-log-only-errors nil)
  (setq apheleia-log-debug-info t)
  ;; å¢åŠ è¶…æ—¶æ—¶é—´(é»˜è®¤æ˜¯ 10 ç§’)
  (setq apheleia-remote-algorithm 'cancel)
  
  ;; LSP æ ¼å¼åŒ–å‡½æ•°
  (cl-defun my/apheleia-lsp-format
      (&key buffer scratch callback &allow-other-keys)
    "Format BUFFER using LSP."
    (with-current-buffer buffer
      (if (and (bound-and-true-p lsp-mode)
               (lsp-feature? "textDocument/formatting"))
          (condition-case err
              (progn
                (lsp-format-buffer)
                (with-current-buffer scratch
                  (erase-buffer)
                  (insert-buffer-substring buffer))
                (funcall callback))
            (error
             (message "LSP format error: %S" err)
             (with-current-buffer scratch
               (erase-buffer)
               (insert-buffer-substring buffer))
             (funcall callback)))
        (with-current-buffer scratch
          (erase-buffer)
          (insert-buffer-substring buffer))
        (funcall callback))))
  
  ;; æ³¨å†Œæ‰€æœ‰æ ¼å¼åŒ–å™¨ï¼ˆä½¿ç”¨ push æˆ– setfï¼‰
  (setf (alist-get 'lsp apheleia-formatters)
        'my/apheleia-lsp-format)
  
  ;; æ³¨æ„ï¼škdlfmt ä½¿ç”¨å‘½ä»¤åˆ—è¡¨æ ¼å¼
  (setf (alist-get 'kdlfmt apheleia-formatters)
      '("kdlfmt" "format" "--stdin"))
  (setf (alist-get 'google-java-format apheleia-formatters)
      '("google-java-format" "-"))  
  
  (setf (alist-get 'nixpkgs-fmt apheleia-formatters)
        '("nixpkgs-fmt"))

  ;; é…ç½®æ¨¡å¼å…³è”
  (setf (alist-get 'c-ts-mode apheleia-mode-alist) 'clang-format)
  (setf (alist-get 'c++-ts-mode apheleia-mode-alist) 'clang-format)
  (setf (alist-get 'python-ts-mode apheleia-mode-alist) 'black)
  (setf (alist-get 'go-mode apheleia-mode-alist) 'gofmt)
  (setf (alist-get 'nix-ts-mode apheleia-mode-alist) 'nixpkgs-fmt)
  (setf (alist-get 'kdl-mode apheleia-mode-alist) 'kdlfmt))
#+end_src

*** ä½¿ç”¨æ–¹æ³•
- ä¿å­˜æ–‡ä»¶æ—¶è‡ªåŠ¨æ ¼å¼åŒ–
- =M-x apheleia-format-buffer= : æ‰‹åŠ¨æ ¼å¼åŒ–å½“å‰ç¼“å†²åŒº
  

** lsp-ui
*** ä»‹ç»
lsp-ui ä¸º lsp-mode æä¾› UI å¢å¼ºï¼ŒåŒ…æ‹¬æ‚¬æµ®æ–‡æ¡£ã€ä¾§è¾¹ä¿¡æ¯ã€ä»£ç é¢„è§ˆç­‰ã€‚

*** ç›¸å…³é“¾æ¥
- GitHub: https://github.com/emacs-lsp/lsp-ui

*** é…ç½®
#+begin_src emacs-lisp
  (use-package lsp-ui
    :straight t
    :hook (lsp-mode . lsp-ui-mode)
    :custom
    (lsp-ui-sideline-enable t)
    (lsp-ui-doc-position 'at-point)      ; åœ¨å…‰æ ‡ä½ç½®æ˜¾ç¤º
    (lsp-ui-sideline-show-code-actions t)
    (lsp-ui-sideline-show-diagnostics 0)
    (lsp-ui-sideline-show-hover t)
    (lsp-ui-sideline-ignore-duplicate t)
    (lsp-diagnostics-provider :flymake)  ; ç¡®ä¿ç”¨ flymake
    (lsp-ui-peek-enable t)
    (lsp-ui-peek-always-show t)
    (lsp-ui-peek-show-directory t))


;; 4. Java æ¨¡å¼ä¸“ç”¨ä¼˜åŒ–
(add-hook 'java-ts-mode-hook
          (lambda ()
            (setq-local apheleia-mode nil)))
#+end_src

*** ä½¿ç”¨æ–¹æ³•
- å…‰æ ‡æ‚¬åœæ˜¾ç¤ºæ–‡æ¡£
- ä¾§è¾¹æ æ˜¾ç¤ºç±»å‹å’Œè¯Šæ–­ä¿¡æ¯
- =g r= : ä½¿ç”¨ peek é¢„è§ˆå¼•ç”¨





** sideline
*** ä»‹ç»
sideline åœ¨ä»£ç è¡Œçš„å³ä¾§æ˜¾ç¤ºé¢å¤–ä¿¡æ¯ï¼Œå¦‚é”™è¯¯ã€è­¦å‘Šã€æ–‡æ¡£ç­‰ã€‚æä¾›å¯æ‰©å±•çš„åç«¯ç³»ç»Ÿï¼Œæ”¯æŒå¤šç§ä¿¡æ¯æºåŒæ—¶æ˜¾ç¤ºã€‚

*** ç›¸å…³é“¾æ¥
- GitHub: https://github.com/emacs-sideline/sideline

*** é…ç½®
#+begin_src emacs-lisp
  (use-package sideline
  :hook (flymake-mode . sideline-mode))
#+end_src

*** ä½¿ç”¨æ–¹æ³•
- è‡ªåŠ¨åœ¨ä»£ç è¡Œå³ä¾§æ˜¾ç¤º flymake è¯Šæ–­ä¿¡æ¯
- å…‰æ ‡ç§»åŠ¨åˆ°æœ‰é—®é¢˜çš„è¡Œæ—¶æ˜¾ç¤ºè¯¦ç»†é”™è¯¯ä¿¡æ¯




** eldoc-box
*** ä»‹ç»
eldoc-box ä¸º eldoc æä¾›å¼¹å‡ºæ¡†æ˜¾ç¤ºï¼Œæ”¯æŒå¤šè¡Œå†…å®¹å’Œæ»šåŠ¨ã€‚ç›¸æ¯”å†…ç½® eldocï¼Œæ›´åŠ ç¾è§‚å’Œå®ç”¨ã€‚
*** ç›¸å…³é“¾æ¥
- GitHub:https://github.com/alexmurray/eldoc-box
*** é…ç½®
#+begin_src emacs-lisp :wrap ep
;; eldoc-box
(use-package eldoc-box
  :config
  (setq eldoc-box-only-multi-line t
        eldoc-box-clear-with-C-g t
        eldoc-box-max-pixel-width 800
        eldoc-box-max-pixel-height 800)
  
  (general-define-key
   :states 'normal
   :keymaps 'eglot-mode-map
   :prefix "SPC c"
   "h" #'eldoc-box-help-at-point
   "k" #'eldoc-box-scroll-up
   "j" #'eldoc-box-scroll-down))
#+end_src

*** ä½¿ç”¨æ–¹æ³•
- =SPC c h= : æ˜¾ç¤º eldoc å¼¹å‡ºæ¡†
- =SPC c j/k= : å‘ä¸Š/ä¸‹æ»šåŠ¨ eldoc å†…å®¹

** flymake
*** ä»‹ç»
flymake æ˜¯ Emacs å†…ç½®çš„è¯­æ³•æ£€æŸ¥æ¡†æ¶ï¼Œæ”¯æŒå¼‚æ­¥æ£€æŸ¥ä»£ç é”™è¯¯ã€‚ä¸ lsp-mode é›†æˆåï¼Œå¯ä»¥æ˜¾ç¤º LSP æä¾›çš„è¯Šæ–­ä¿¡æ¯ã€‚
*** ç›¸å…³é“¾æ¥
- å®˜æ–¹æ–‡æ¡£: https://www.gnu.org/software/emacs/manual/html_node/flymake
*** é…ç½®
#+begin_src emacs-lisp
  (use-package flymake
  :straight nil
  :hook (prog-mode . flymake-mode))
#+end_src
*** ä½¿ç”¨æ–¹æ³•
- è‡ªåŠ¨åœ¨ç¼–ç¨‹æ¨¡å¼å¯ç”¨ flymake
- æ˜¾ç¤ºè¯­æ³•é”™è¯¯å’Œè­¦å‘Š
- ä¸ lsp-mode é›†æˆæ˜¾ç¤º LSP è¯Šæ–­ä¿¡æ¯


** flyover
*** ä»‹ç»
flyover åœ¨ä»£ç è¡Œæ—è¾¹æ˜¾ç¤ºè¯Šæ–­ä¿¡æ¯çš„è™šæ‹Ÿè¡Œï¼Œæ”¯æŒ flycheck å’Œ flymakeã€‚æä¾›ä¸°å¯Œçš„å¤–è§‚å’Œè¡Œä¸ºå®šåˆ¶é€‰é¡¹ã€‚
*** ç›¸å…³é“¾æ¥
- GitHub: https://github.com/gagbo/flyover
*** é…ç½®
#+begin_src emacs-lisp :wrap ep
(use-package flyover
  :hook ((flycheck-mode . flyover-mode)
         (flymake-mode . flyover-mode))
  :custom
  ;; Checker settings
  (flyover-checkers '(flycheck flymake))
  (flyover-levels '(error warning info))

  ;; Appearance
  (flyover-use-theme-colors t)
  (flyover-background-lightness 45)
  (flyover-percent-darker 40)
  (flyover-text-tint 'lighter)
  (flyover-text-tint-percent 50)

  ;; Icons
  (flyover-info-icon "ïš")
  (flyover-warning-icon "ï±")
  (flyover-error-icon "îª‡")

  ;; Display settings
  (flyover-hide-checker-name t)
  (flyover-show-virtual-line t)
  (flyover-virtual-line-type 'curved-dotted-arrow)
  (flyover-line-position-offset 1)

  ;; Message wrapping
  (flyover-wrap-messages t)
  (flyover-max-line-length 80)

  ;; Performance
  (flyover-debounce-interval 0.2))
#+end_src
*** ä½¿ç”¨æ–¹æ³•
- è‡ªåŠ¨åœ¨å¯ç”¨ flycheck/flymake æ—¶æ˜¾ç¤ºè™šæ‹Ÿè¡Œ
- æ˜¾ç¤ºé”™è¯¯ã€è­¦å‘Šå’Œä¿¡æ¯å›¾æ ‡

** lsp-kdl

*** ä»‹ç»
lsp-kdl ä¸º KDLï¼ˆKotlin Data Languageï¼‰æä¾› LSP æ”¯æŒï¼ŒåŸºäº tree-sitter è§£æå™¨ï¼Œæ”¯æŒè¯­æ³•é«˜äº®ã€ä»£ç è¡¥å…¨ç­‰åŠŸèƒ½ã€‚

*** ç›¸å…³é“¾æ¥
- GitHub:

*** é…ç½®
#+begin_src emacs-lisp
(use-package kdl-mode
  :straight t)
#+end_src

*** ä½¿ç”¨æ–¹æ³•
- åœ¨ KDL æ–‡ä»¶ä¸­è‡ªåŠ¨å¯åŠ¨ LSP
- éœ€è¦å…ˆå®‰è£… kdl-language-server:

** lsp-nix
#+begin_src emacs-lisp
(use-package nix-ts-mode
  :mode "\\.nix\\'"
  :hook (nix-ts-mode . lsp))
#+end_src


** lsp-pyright
*** ä»‹ç»
lsp-pyright ä¸º Python æä¾›åŸºäº Pyright çš„ LSP æ”¯æŒã€‚Pyright æ˜¯å¾®è½¯å¼€å‘çš„é«˜æ€§èƒ½ Python ç±»å‹æ£€æŸ¥å™¨ï¼Œæä¾›å¿«é€Ÿã€å‡†ç¡®çš„ä»£ç è¡¥å…¨å’Œç±»å‹æ£€æŸ¥ã€‚

*** ç›¸å…³é“¾æ¥
- GitHub: https://github.com/emacs-lsp/lsp-pyright
- Pyright å®˜æ–¹: https://github.com/microsoft/pyright

*** é…ç½®
#+begin_src emacs-lisp
  (use-package lsp-pyright
  :custom (lsp-pyright-langserver-command "pyright") ;; or basedpyright
  :hook (python-ts-mode . (lambda ()
                          (require 'lsp-pyright)
                          (lsp))))  ; or lsp-deferred
#+end_src

*** ä½¿ç”¨æ–¹æ³•
- åœ¨ Python æ–‡ä»¶ä¸­è‡ªåŠ¨å¯åŠ¨
- éœ€è¦å…ˆå®‰è£… Pyright: =npm install -g pyright=
- æä¾›ç±»å‹æ£€æŸ¥ã€è‡ªåŠ¨è¡¥å…¨ã€é‡æ„ç­‰åŠŸèƒ½

** lsp-java
*** ä»‹ç»
ä¸º Java å¼€å‘æä¾› LSP æ”¯æŒï¼ŒåŸºäº Eclipse JDT Language Serverï¼Œæ”¯æŒ Maven å’Œ Gradle é¡¹ç›®ã€‚

*** ç›¸å…³é“¾æ¥
- GitHub: https://github.com/emacs-lsp/lsp-java

*** é…ç½®
#+begin_src emacs-lisp
(use-package lsp-java
  :hook (java-mode . lsp-deferred)
  :config
(setq lsp-java-vmargs
        '("-noverify"
          "-Xmx4G"
          "-Xms1G"
          "-XX:+UseG1GC"
          "-XX:+UseStringDeduplication"
          "-XX:MaxMetaspaceSize=512m"
          "-XX:+ParallelRefProcEnabled"
          "-XX:+DisableExplicitGC")))

;; to enable the lenses
(add-hook 'lsp-mode-hook #'lsp-lens-mode)
(add-hook 'java-mode-hook #'lsp-java-boot-lens-mode)
#+end_src


*** ä½¿ç”¨æ–¹æ³•
- é¦–æ¬¡æ‰“å¼€ Java é¡¹ç›®ä¼šè‡ªåŠ¨ä¸‹è½½ language server
- æ”¯æŒ Maven/Gradle é¡¹ç›®å¯¼å…¥
- æ‰€æœ‰ LSP åŠŸèƒ½å¯ç”¨

** treesit-auto
*** ä»‹ç»
treesit-auto è‡ªåŠ¨ç®¡ç† tree-sitter è¯­æ³•è§£æå™¨ï¼Œæ— éœ€æ‰‹åŠ¨é…ç½®ã€‚tree-sitter æä¾›æ›´å‡†ç¡®çš„è¯­æ³•é«˜äº®å’Œä»£ç åˆ†æã€‚

*** ç›¸å…³é“¾æ¥
- GitHub: https://github.com/renzmann/treesit-auto
- Tree-sitter: https://tree-sitter.github.io/

*** é…ç½®
#+begin_src emacs-lisp
(use-package treesit-auto
  :hook (after-init . global-treesit-auto-mode)
  :config
  (setq treesit-auto-install 'prompt))  ; æç¤ºå®‰è£…è¯­æ³•
#+end_src

*** ä½¿ç”¨æ–¹æ³•
- æ‰“å¼€æ”¯æŒçš„æ–‡ä»¶æ—¶è‡ªåŠ¨å¯ç”¨ tree-sitter
- é¦–æ¬¡ä½¿ç”¨æŸè¯­è¨€æ—¶æç¤ºå®‰è£…è¯­æ³•
- =M-x treesit-auto-install-all= : å®‰è£…æ‰€æœ‰è¯­æ³•

*** æ”¯æŒçš„è¯­è¨€
50+ ç§è¯­è¨€ï¼ŒåŒ…æ‹¬ï¼š
- C, C++, Python, Java, Go, Rust, Ruby, PHP
- JavaScript, TypeScript, HTML, CSS
- Bash, JSON, YAML, Markdown
- ç­‰ç­‰...




** quickrun
*** ä»‹ç»
quickrun æä¾›å¿«é€Ÿè¿è¡Œä»£ç ç‰‡æ®µçš„åŠŸèƒ½ï¼Œæ”¯æŒå¤šç§ç¼–ç¨‹è¯­è¨€ã€‚å¯ä»¥åœ¨ Emacs ä¸­ç›´æ¥æ‰§è¡Œä»£ç å¹¶æŸ¥çœ‹è¾“å‡ºï¼Œé€‚åˆæµ‹è¯•å’Œè°ƒè¯•å°æ®µä»£ç ã€‚

#+begin_src emacs-lisp
(use-package quickrun
  :straight t)
#+end_src

*** ä½¿ç”¨æ–¹æ³•
- =M-x quickrun= : è¿è¡Œå½“å‰ç¼“å†²åŒºä»£ç 
- =M-x quickrun-region= : è¿è¡Œé€‰ä¸­ä»£ç 
- æ”¯æŒå¤šç§è¯­è¨€ï¼Œè‡ªåŠ¨é€‰æ‹©è¿è¡Œå™¨




** å¾…è¦å®‰è£…çš„æ’ä»¶


#+begin_src emacs-lisp
;; (use-package ai-code-interface
;;   :straight (:host github :repo "tninja/ai-code-interface.el")
;;   :after claude-code-ide
;;   :bind ("C-c a" . ai-code-menu)
;;   :config
;;   (ai-code-set-backend 'claude-code-ide)
  
;;   ;; å¯é€‰ï¼šMagit é›†æˆ
;;   (with-eval-after-load 'magit
;;     (ai-code-magit-setup-transients)))
#+end_src







* AI è¾…åŠ©ç¼–ç¨‹
AI ç›¸å…³å·¥å…·é…ç½®ï¼ŒåŒ…æ‹¬ GPTã€Copilot ç­‰æ™ºèƒ½ç¼–ç¨‹åŠ©æ‰‹ã€‚
** gptel
*** ä»‹ç»
gptel æ˜¯ Emacs çš„é€šç”¨ LLM å®¢æˆ·ç«¯ï¼Œæ”¯æŒ ChatGPTã€Claudeã€Gemini ç­‰å¤šç§ AI æ¨¡å‹ã€‚å¯ä»¥åœ¨ Emacs ä¸­ç›´æ¥ä¸ AI å¯¹è¯ã€é‡å†™ä»£ç ã€ç”Ÿæˆæäº¤ä¿¡æ¯ç­‰ã€‚

*** ç›¸å…³é“¾æ¥
- GitHub: https://github.com/karthink/gptel

*** é…ç½®
#+begin_src emacs-lisp
(use-package gptel
   :config
;; OPTIONAL configuration
;; (setq gptel-default-mode 'org-mode)
(setq gptel-model 'gpt-4o
      gptel-backend (gptel-make-gh-copilot "Copilot"))

(gptel-make-gh-copilot "Copilot"))

#+end_src

*** ä½¿ç”¨æ–¹æ³•
- =SPC a a= : æ‰“å¼€ gptel å¯¹è¯
- =SPC a m= : æ‰“å¼€ gptel èœå•
- =SPC a r= (Visual æ¨¡å¼): é‡å†™é€‰ä¸­çš„æ–‡æœ¬
- =SPC a d= : å°†é€‰ä¸­å†…å®¹æ·»åŠ åˆ°å¯¹è¯ä¸Šä¸‹æ–‡
- =SPC a t= : gptel å·¥å…·èœå•
- =SPC g c= : ç”Ÿæˆ Git æäº¤ä¿¡æ¯

** mcp (Model Context Protocol)
*** ä»‹ç»
MCP ä¸º AI æ¨¡å‹æä¾›æ ‡å‡†åŒ–çš„ä¸Šä¸‹æ–‡åè®®ï¼Œè®© AI èƒ½å¤Ÿæ›´å¥½åœ°ç†è§£é¡¹ç›®ç»“æ„å’Œä»£ç ä¸Šä¸‹æ–‡ã€‚

*** é…ç½®
#+begin_src emacs-lisp
(use-package mcp
  :straight t)

(require 'gptel-integrations)

(setq mcp-hub-servers
      '(("github"
         :command "github-mcp-server"
         :args ("stdio"))))
#+end_src

** gptel-commit
*** ä»‹ç»
gptel-commit é›†æˆ gptel å’Œ magitï¼Œä½¿ç”¨ AI è‡ªåŠ¨ç”Ÿæˆç¬¦åˆè§„èŒƒçš„ Git æäº¤ä¿¡æ¯ã€‚

*** é…ç½®
#+begin_src emacs-lisp
(use-package gptel-commit
  :after (gptel magit)
  :custom
  (gptel-commit-stream t))
#+end_src

*** ä½¿ç”¨æ–¹æ³•
- åœ¨ magit commit ç•Œé¢ä½¿ç”¨ =SPC g c= ç”Ÿæˆæäº¤ä¿¡æ¯
- AI ä¼šæ ¹æ® diff å†…å®¹ç”Ÿæˆåˆé€‚çš„æäº¤æè¿°

** copilot
*** ä»‹ç»
copilot.el æ˜¯ GitHub Copilot çš„ Emacs å®¢æˆ·ç«¯ï¼Œæ”¯æŒ AI è‡ªåŠ¨è¡¥å…¨ä»£ç ã€‚å®ƒå¯ä»¥åœ¨ç¼–ç¨‹æ¨¡å¼ä¸‹è‡ªåŠ¨æ¿€æ´»ï¼Œæä¾›æ™ºèƒ½ä»£ç å»ºè®®ï¼Œæå‡å¼€å‘æ•ˆç‡ã€‚

*** ç›¸å…³é“¾æ¥
- GitHub: https://github.com/copilot-emacs/copilot.el

*** é…ç½®
#+begin_src emacs-lisp
(use-package copilot
  :straight (:host github :repo "copilot-emacs/copilot.el" :files ("*.el"))
  ;; :hook (prog-mode  . copilot-mode)  ; åœ¨ç¼–ç¨‹æ¨¡å¼å’Œ org-mode ä¸‹è‡ªåŠ¨å¯ç”¨
  :config
  ;; ç¦ç”¨ç¼©è¿›è­¦å‘Š
  (setq copilot-disable-predicates 
        '(copilot-hide-completion-on-escape
          copilot-hide-completion-on-comment
          copilot-hide-completion-on-string))
  (setq copilot-indent-offset-warning-disable t)
  ;; æ˜¾ç¤ºè®¾ç½®
  (setq copilot-enable-predicates '(copilot-hide-completion-on-escape))
  (setq copilot-idle-delay 0.5))
#+end_src

*** ä½¿ç”¨æ–¹æ³•
- åœ¨ç¼–ç¨‹æ¨¡å¼ä¸‹è‡ªåŠ¨å¯ç”¨ Copilotï¼Œæ— éœ€æ‰‹åŠ¨å¯åŠ¨
- è¾“å…¥ä»£ç æ—¶è‡ªåŠ¨æ˜¾ç¤º AI è¡¥å…¨å»ºè®®
- æ”¯æŒé€šè¿‡å¿«æ·é”®æ¥å—ã€æ‹’ç»æˆ–åˆ‡æ¢å»ºè®®
- å¯è‡ªå®šä¹‰æ˜¾ç¤ºå’Œè§¦å‘æ¡ä»¶ï¼Œé€‚åº”ä¸åŒç¼–ç¨‹ä¹ æƒ¯

** claude-code-ide
*** ä»‹ç»
claude-code-ide å°† Claude AI é›†æˆåˆ° Emacs ä¸­ï¼Œæä¾›æ™ºèƒ½ä»£ç è¡¥å…¨ã€é‡æ„å’Œå¯¹è¯åŠŸèƒ½ã€‚æ”¯æŒé€šè¿‡ MCP åè®®ä¸ Claude äº¤äº’ã€‚

*** ç›¸å…³é“¾æ¥
- GitHub: https://github.com/manzaltu/claude-code-ide.el

*** é…ç½®
#+begin_src emacs-lisp
(use-package claude-code-ide
  :straight (:type git :host github :repo "manzaltu/claude-code-ide.el")
  :bind ("C-c C-'" . claude-code-ide-menu)
  :config
  (claude-code-ide-emacs-tools-setup))
#+end_src

*** ä½¿ç”¨æ–¹æ³•
- =SPC c a= : å¯åŠ¨ claude-code-ide
- =SPC c t= : åœæ­¢å½“å‰ä»»åŠ¡
- =SPC c r= : æ¢å¤ä»»åŠ¡
- =SPC c c= : ç»§ç»­å¯¹è¯
- =C-c C-'= : æ‰“å¼€ Claude IDE èœå•

  

* å°ç»„ä»¶
** Pomidor ç•ªèŒ„é’Ÿ
*** ä»‹ç»
Pomidor æ˜¯ä¸€ä¸ª Emacs ç•ªèŒ„é’Ÿæ’ä»¶ï¼Œå¸®åŠ©ç”¨æˆ·ä¸“æ³¨å·¥ä½œå’Œç®¡ç†æ—¶é—´ã€‚å®ƒæä¾›å¯è§†åŒ–çš„è®¡æ—¶å™¨å’Œä¼‘æ¯æé†’ï¼Œæ”¯æŒè‡ªå®šä¹‰å·¥ä½œå’Œä¼‘æ¯æ—¶é—´ã€‚
*** ç›¸å…³é“¾æ¥
- GitHub:https://github.com/syohex/emacs-pomidor
*** é…ç½®
#+begin_src emacs-lisp :wrap ep
(use-package pomidor
  :bind (("<f12>" . pomidor))
  :init
  ;; è®¾ç½®ç•ªèŒ„é’Ÿæ—¶é•¿
  (setq pomidor-seconds (* 55 60))          ; 25åˆ†é’Ÿå·¥ä½œæ—¶é—´
  (setq pomidor-break-seconds (* 5 60))     ; 5åˆ†é’ŸçŸ­ä¼‘æ¯
  (setq pomidor-long-break-seconds (* 20 60)) ; 20åˆ†é’Ÿé•¿ä¼‘æ¯
  (setq pomidor-breaks-before-long 3)       ; 4ä¸ªçŸ­ä¼‘æ¯åè¿›å…¥é•¿ä¼‘æ¯
  
  ;; ä½¿ç”¨ emacs state,ä¿æŒåŸå§‹æŒ‰é”®
  (with-eval-after-load 'evil
    (evil-set-initial-state 'pomidor-mode 'emacs))
  
  :hook (pomidor-mode . (lambda ()
                          (display-line-numbers-mode -1)
                          (setq left-fringe-width 0 right-fringe-width 0)
                          (setq left-margin-width 2 right-margin-width 0)
                          (set-window-buffer nil (current-buffer)))))
#+end_src
*** ä½¿ç”¨æ–¹æ³•
- =F12= : å¯åŠ¨/æš‚åœç•ªèŒ„é’Ÿ
- è‡ªåŠ¨æé†’å·¥ä½œå’Œä¼‘æ¯æ—¶é—´
- å¯è‡ªå®šä¹‰æ—¶é—´è®¾ç½®å’Œè¡Œä¸º

* é™„å½•
** åŒ…ç®¡ç†å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥
*** straight.el å‘½ä»¤
- =M-x straight-pull-all= : æ›´æ–°æ‰€æœ‰åŒ…
- =M-x straight-pull-package= : æ›´æ–°å•ä¸ªåŒ…
- =M-x straight-rebuild-all= : é‡å»ºæ‰€æœ‰åŒ…
- =M-x straight-rebuild-package= : é‡å»ºå•ä¸ªåŒ…
- =M-x straight-freeze-versions= : åˆ›å»ºç‰ˆæœ¬é”å®šæ–‡ä»¶
- =M-x straight-thaw-versions= : ä»é”å®šæ–‡ä»¶æ¢å¤ç‰ˆæœ¬
- =M-x straight-check-all= : æ£€æŸ¥æ‰€æœ‰åŒ…çŠ¶æ€
- =M-x straight-check-package= : æ£€æŸ¥å•ä¸ªåŒ…çŠ¶æ€
** é—®é¢˜æ’æŸ¥
*** å¦‚æœæŸä¸ªåŒ…åŠ è½½å¤±è´¥
1. æ£€æŸ¥: =M-x straight-check-package=
2. é‡å»º: =M-x straight-rebuild-package=
3. æŸ¥çœ‹æ—¥å¿—: åˆ‡æ¢åˆ° =*straight-process*= ç¼“å†²åŒº

*** å¦‚æœå¯åŠ¨æ—¶å‡ºé”™
#+begin_src bash
# ä½¿ç”¨ debug æ¨¡å¼å¯åŠ¨
emacs --debug-init
#+end_src

*** é‡ç½®é…ç½®
#+begin_src bash
# åˆ é™¤ straight ç›®å½•é‡æ–°å¼€å§‹
rm -rf ~/.emacs.d/straight/
# é‡å¯ Emacs
#+end_src

** é…ç½®æ–‡ä»¶ä½ç½®
- ä¸»é…ç½®: =~/.emacs.d/config.org=
- åˆå§‹åŒ–: =~/.emacs.d/init.el=
- åŒ…ç›®å½•: =~/.emacs.d/straight/=
- å¤‡ä»½: =~/.emacs.d/config.org.backup-*=
** å¼€å‘å·¥å…·é›†æˆ
æœ¬é…ç½®é›†æˆäº†å¤šç§å¼€å‘å·¥å…·ï¼Œæä¾›å®Œæ•´çš„ IDE ä½“éªŒ:
*** Git ç‰ˆæœ¬æ§åˆ¶
- Magit: å¼ºå¤§çš„ Git ç•Œé¢
- diff-hl: å®æ—¶æ˜¾ç¤ºæ–‡ä»¶å·®å¼‚
- gptel-commit: AI ç”Ÿæˆæäº¤ä¿¡æ¯

*** ç»ˆç«¯å·¥å…·
- eat: ç°ä»£åŒ–ç»ˆç«¯æ¨¡æ‹Ÿå™¨  
- vterm: é«˜æ€§èƒ½ç»ˆç«¯
- eshell: Emacs shell

*** AI è¾…åŠ©
- copilot: GitHub Copilot ä»£ç è¡¥å…¨
- gptel: é€šç”¨ LLM å®¢æˆ·ç«¯
- claude-code-ide: Claude AI é›†æˆ
- mcp: æ¨¡å‹ä¸Šä¸‹æ–‡åè®®

** TODO ä»»åŠ¡åˆ—è¡¨
*** DONE è®¾ç½®pdftoolçš„é¢œè‰²éšç€æ—¶é—´å˜åŒ–æˆmodusé»„å’Œmodusé»‘

*** DONE which-key è®¾ç½®æ ‡ç­¾
ä¸ºå¸¸ç”¨å‘½ä»¤ç»„æ·»åŠ å‹å¥½çš„æ ‡ç­¾æè¿°

*** DONE Git å¿«æ·é”®ä¼˜åŒ–
æ•´ç†å’Œä¼˜åŒ– Git ç›¸å…³çš„é”®ä½ç»‘å®š

*** DONE AI å¿«æ·é”®ç»Ÿä¸€
ç»Ÿä¸€ AI å·¥å…·çš„å¿«æ·é”®å‘½åè§„èŒƒ

*** DONE æ—¶é—´è‡ªåŠ¨è°ƒèŠ‚ä¸»é¢˜
å·²å®ç° modus-themes æ ¹æ®æ—¶é—´è‡ªåŠ¨åˆ‡æ¢

*** DONE è®¾ç½® C-/ toggle eat
å·²å®ç°ç»ˆç«¯å¿«é€Ÿåˆ‡æ¢åŠŸèƒ½

*** TODO å®Œå–„ç±»ä¼¼ org-frog çš„åŠŸèƒ½ï¼Œè®©å…¶æ”¯æŒæ›´å¤šçš„ç¯å¢ƒã€‚å½“\[ \]ä¸­é—´æœ‰æ¢è¡Œçš„æ—¶å€™ä¸å¥½è§¦å‘

*** DONE math-preivew çš„bug,å½“ font-height è®¾ç½®å¤§160æ—¶ï¼Œé¢„è§ˆä¼šåç§»
:LOGBOOK:
CLOCK: [2025-12-23 Tue 12:49]
:END:


#+begin_src emacs-lisp
;; â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
;; 1. general + å®šä¹‰ global-definerï¼ˆå¿…é¡»æœ€å…ˆï¼‰
;; â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
(use-package general
  :demand t
  :config
  (general-create-definer global-definer
    :states '(normal visual)  ; åªåœ¨ normal å’Œ visual æ¨¡å¼
    :keymaps 'override
    :prefix "SPC"))
;; â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
;; 2. å¤šå…‰æ ‡
;; â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
(use-package iedit
  :ensure t
  :init
  (setq iedit-toggle-key-default nil)
  :config
  (define-key iedit-mode-keymap (kbd "M-h") 'iedit-restrict-function)
  (define-key iedit-mode-keymap (kbd "M-i") 'iedit-restrict-current-line))
(use-package evil-multiedit
  :ensure t
  :commands (evil-multiedit-default-keybinds)
  :init
  (evil-multiedit-default-keybinds))
;; â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
;; 3. expand-region
;; â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
(use-package expand-region
  :config
  (defadvice er/prepare-for-more-expansions-internal
      (around helm-ag/prepare-for-more-expansions-internal activate)
    ad-do-it
    (let ((new-msg (concat (car ad-return-value)
                           ", H to highlight in buffers"
                           ", / to search in project, "
                           "e iedit mode in functions"
                           "f to search in files, "
                           "b to search in opened buffers"))
          (new-bindings (cdr ad-return-value)))
      (cl-pushnew
       '("H" (lambda ()
               (interactive)
               (call-interactively 'zilongshanren/highlight-dwim)))
       new-bindings)
      (cl-pushnew
       '("/" (lambda ()
               (interactive)
               (call-interactively 'my/search-project-for-symbol-at-point)))
       new-bindings)
      (cl-pushnew
       '("e" (lambda ()
               (interactive)
               (call-interactively 'evil-multiedit-match-all)))
       new-bindings)
      (cl-pushnew
       '("f" (lambda ()
               (interactive)
               (call-interactively 'my/er-find-file-with-text)))
       new-bindings)
      (cl-pushnew
       '("b" (lambda ()
               (interactive)
               (call-interactively 'my/er-consult-line-with-text)))
       new-bindings)
      (setq ad-return-value (cons new-msg new-bindings)))))


(defun my/er-find-file-with-text ()
  "åœ¨ expand-region ä¸­ä½¿ç”¨é€‰ä¸­çš„æ–‡æœ¬æŸ¥æ‰¾æ–‡ä»¶"
  (interactive)
  (let ((text (when (use-region-p)
               (buffer-substring-no-properties
                (region-beginning) (region-end)))))
    (deactivate-mark)
    (if text
        (find-file (read-file-name 
                   (format "Find file [%s]: " text)
                   nil nil nil text))
      (call-interactively 'find-file))))

(defun my/er-consult-line-with-text ()
  "åœ¨ expand-region ä¸­ä½¿ç”¨é€‰ä¸­çš„æ–‡æœ¬æœç´¢ç¼“å†²åŒº"
  (interactive)
  (let ((text (when (use-region-p)
               (buffer-substring-no-properties
                (region-beginning) (region-end)))))
    (deactivate-mark)
    (if text
        (consult-line text)
      (call-interactively 'consult-line))))

;; â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
;; 4. æœç´¢å‡½æ•°
;; â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
;;;###autoload
(defun my/search-project-for-symbol-at-point ()
  (interactive)
  (if (use-region-p)
      (progn
        (consult-ripgrep (project-root (project-current))
                         (buffer-substring (region-beginning) (region-end))))))
;; â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
;; 5. å…¨å±€å¿«æ·é”®ï¼ˆç°åœ¨ global-definer å·²å®šä¹‰ï¼‰
;; â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
(global-definer
  "h c" 'zilongshanren/clearn-highlight   ; SPC h c
  "h H" 'zilongshanren/highlight-dwim     ; SPC h H
  "v" 'er/expand-region)                   ; SPC v
;; â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
;; 6. å¿«é€Ÿæ›¿æ¢
;; â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
(defun zilongshanren/evil-quick-replace (beg end)
  (interactive "r")
  (when (evil-visual-state-p)
    (evil-exit-visual-state)
    (let ((selection (regexp-quote (buffer-substring-no-properties beg end))))
      (setq command-string (format "%%s /%s//g" selection))
      (minibuffer-with-setup-hook
          (lambda () (backward-char 2))
        (evil-ex command-string)))))
(define-key evil-visual-state-map (kbd "C-r") 'zilongshanren/evil-quick-replace)
;; â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
;; 7. highlight-globalï¼ˆç”¨ straight å®‰è£…ï¼Œæ—  quelpaï¼‰
;; â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
(use-package highlight-global
  :straight (highlight-global
             :type git
             :host github
             :repo "glen-dai/highlight-global")
  :ensure nil
  :commands (highlight-frame-toggle)
  :config
  (progn
    (setq-default highlight-faces
                  '(('hi-red-b . 0)
                    ('hi-aquamarine . 0)
                    ('hi-pink . 0)
                    ('hi-blue-b . 0)))))
;; â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
;; 8. é«˜äº®å‡½æ•° + symbol-overlay
;; â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
(defun zilongshanren/highlight-dwim ()
  (interactive)
  (if (use-region-p)
      (progn
        (highlight-frame-toggle)
        (deactivate-mark))
    (symbol-overlay-put)))
(defun zilongshanren/clearn-highlight ()
  (interactive)
  (clear-highlight-frame)
  (symbol-overlay-remove-all))
(use-package symbol-overlay
  :config
  (define-key symbol-overlay-map (kbd "h") 'nil))
#+end_src

#+begin_src emacs-lisp :wrap ep
(defun my/setup-frame (frame)
  (with-selected-frame frame
    (set-face-attribute 'default nil
                        :font "Maple Mono NF"
                        :height 140)

    ;; Set Chinese font for Han script
    (set-fontset-font t 'han "Noto Serif CJK SC")
    (load-theme 'doom-everforest t)))

(if (daemonp)
    (add-hook 'after-make-frame-functions #'my/setup-frame)
  (my/setup-frame (selected-frame)))
#+end_src

#+begin_src emacs-lisp :wrap ep
(use-package consult-dir
  :defer t
  :bind ((:map vertico-map
          ("C-x C-d" . consult-dir)))
  :config
  (setq consult-dir-default-command #'consult-dir-dired)

  (defun consult-dir--zoxide-dirs ()
    "Return list of zoxide dirs."
    (split-string (shell-command-to-string "zoxide query -l") "\n" t))

  (defvar consult-dir--source-zoxide
    `(:name "zoxide"
      :narrow ?z
      :category file
      :face consult-file
      :history file-name-history
      :enabled ,(lambda () (executable-find "zoxide"))
      :items ,#'consult-dir--zoxide-dirs)
    "zoxide directory source for `consult-dir'.")

  (add-to-list 'consult-dir-sources 'consult-dir--source-zoxide t))
#+end_src

#+begin_src emacs-lisp :wrap ep
(use-package denote
  :config
  ;; Your Denote configuration here
  (setq denote-directory (expand-file-name "~/workspace/notes/")))
#+end_src


#+begin_src emacs-lisp :wrap ep
(use-package consult-notes
  :straight (:type git
             :host github
             :repo "mclear-tools/consult-notes")
  :commands (consult-notes
             consult-notes-search-in-all-notes
             consult-notes-org-roam-find-node
             consult-notes-org-roam-find-node-relation)
  :config
  ;; è®¾ç½®ç¬”è®°ç›®å½•
  (setq consult-notes-file-dir-sources 
        '(("Notes" ?n "~/workspace/notes/")))
  
  ;; å¦‚æœä½¿ç”¨ denote
  (when (locate-library "denote")
    (consult-notes-denote-mode))
  
  ;; åªæœç´¢ denote ç›®å½•ä¸­çš„æ–‡æœ¬æ–‡ä»¶
  (setq consult-notes-denote-files-function 
        (lambda () (denote-directory-files nil t t))))
(use-package grease
  :straight (grease :type git :host github :repo "mwac-dev/grease.el")
  :commands (grease-open grease-toggle grease-here)
  :init
  (setq grease-sort-method 'type
        grease-show-hidden nil
        grease-preview-window-width 0.4))
#+end_src

